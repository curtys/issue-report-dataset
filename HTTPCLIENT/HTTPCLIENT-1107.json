{
    "comments": [
        {
            "author": "Oleg Kalnichevski",
            "body": "Unfortunately a proper solution to this issue will require a fair amount of code refactoring and deprecation of the AuthenticationHandler interface.\n\nOleg ",
            "date": "2011-07-20T15:23:28.988+0000",
            "id": 0
        },
        {
            "author": "David Waite",
            "body": "Oleg, can you give more details on your envisioned approach?\n\nI've been working on this for my own needs, but my approaches keep having issues due to the authentication schemes being split into processChallenge and authenticate, which are called in very different parts of the code. \n\nOne approach I thought of is to create every challenged scheme from the response and attempt to authenticate in order for making the headers out - but this will make an array of AuthState objects, which will break  ClientContext.TARGET_AUTH_STATE (and the proxy equivalent).",
            "date": "2011-08-12T05:58:11.283+0000",
            "id": 1
        },
        {
            "author": "Oleg Kalnichevski",
            "body": "David,\n\nLuckily AuthState is a class and not an interface, so we can simply deprecate the #setAuthScheme(AuthScheme) method in favor of new #setAuthSchemes(List<AuthScheme>) method without breaking API compatibility. Yes, the approach you outlined sounds feasible. Another possibility might be to move all authentication logic into the auth handler. The product of the handler's work would be a Header containing the final auth response to one of the available chanllenges instead of a list of AtuhScheme objects.\n\nI intend to fix this problem the first thing after the coming ALPHA releases of HttpCore 4.2 and HttpAsyncClient and 4.0 are done with, but do feel free to take over.\n\nOleg",
            "date": "2011-08-12T15:01:34.289+0000",
            "id": 2
        },
        {
            "author": "Oleg Kalnichevski",
            "body": "The auth scheme fall-back mechanism should now work as expected. Could you please try out the latest SVN snapshot and let me know the results?\n\nOleg ",
            "date": "2011-10-03T23:58:33.962+0000",
            "id": 3
        },
        {
            "author": "HAOUAS",
            "body": "Hi everyone,\n\nI have the same issue on my program and I am currently testing the Version 4.2 Alpha1.\n\nCould you tell me please if the code sample showed in http://hc.apache.org/httpcomponents-client-ga/ntlm.html \nis still intended to work with the fix ?\n\nthx \n",
            "date": "2011-11-08T10:52:52.010+0000",
            "id": 4
        },
        {
            "author": "Oleg Kalnichevski",
            "body": "> Could you tell me please if the code sample showed in http://hc.apache.org/httpcomponents-client-ga/ntlm.html\n> is still intended to work with the fix ? \n\nYes, it is. \n\nPlease note, though, JIRA is not a bulletin board. It is an issue tracker. Please post all your HttpClient related questions to the user mailing list instead [1].\n\nOleg\n\n[1] http://hc.apache.org/mail-lists.html\n",
            "date": "2011-11-08T11:56:01.364+0000",
            "id": 5
        },
        {
            "author": "Ian Beaumont",
            "body": "I've tested my original problem against Version 4.2 Alpha1 and it appears fixed now.  \nThank you Oleg!",
            "date": "2011-11-08T12:52:46.222+0000",
            "id": 6
        },
        {
            "author": "Oleg Kalnichevski",
            "body": "@Ian\n\nGlad to hear that. Would it be a big deal for you to generate a header wire + context log [1] of the session for me to take a look at, though?\n\nOleg\n\n[1] http://hc.apache.org/httpcomponents-client-ga/logging.html",
            "date": "2011-11-08T12:58:21.446+0000",
            "id": 7
        },
        {
            "author": "Ian Beaumont",
            "body": "Here you go...(let me know if you need something different).\n\nauthSchemes[basic, digest, ntlm, negotiate]\n[DEBUG] PoolingClientConnectionManager - Connection request: [route: {}->http://WIN2008-CAT][total kept alive: 0; route allocated: 0 of 2; total allocated: 0 of 20]\n[DEBUG] PoolingClientConnectionManager - Connection leased: [id: 0][route: {}->http://WIN2008-CAT][total kept alive: 0; route allocated: 1 of 2; total allocated: 1 of 20]\n[DEBUG] DefaultClientConnectionOperator - Connecting to WIN2008-CAT:80\n[DEBUG] RequestAddCookies - CookieSpec selected: best-match\n[DEBUG] RequestAuthCache - Auth cache not set in the context\n[DEBUG] RequestTargetAuthentication - Target auth state: UNCHALLENGED\n[DEBUG] RequestProxyAuthentication - Proxy auth state: UNCHALLENGED\n[DEBUG] DefaultHttpClient - Attempt 1 to execute request\n[DEBUG] DefaultClientConnection - Sending request: GET / HTTP/1.1\n[DEBUG] wire - >> \"GET / HTTP/1.1[\\r][\\n]\"\n[DEBUG] wire - >> \"Host: WIN2008-CAT[\\r][\\n]\"\n[DEBUG] wire - >> \"Connection: Keep-Alive[\\r][\\n]\"\n[DEBUG] wire - >> \"User-Agent: Apache-HttpClient/4.2-alpha1 (java 1.5)[\\r][\\n]\"\n[DEBUG] wire - >> \"[\\r][\\n]\"\n[DEBUG] headers - >> GET / HTTP/1.1\n[DEBUG] headers - >> Host: WIN2008-CAT\n[DEBUG] headers - >> Connection: Keep-Alive\n[DEBUG] headers - >> User-Agent: Apache-HttpClient/4.2-alpha1 (java 1.5)\n[DEBUG] wire - << \"HTTP/1.1 401 Unauthorized[\\r][\\n]\"\n[DEBUG] wire - << \"Content-Type: text/html[\\r][\\n]\"\n[DEBUG] wire - << \"Server: Microsoft-IIS/7.0[\\r][\\n]\"\n[DEBUG] wire - << \"WWW-Authenticate: Negotiate[\\r][\\n]\"\n[DEBUG] wire - << \"WWW-Authenticate: NTLM[\\r][\\n]\"\n[DEBUG] wire - << \"X-Powered-By: ASP.NET[\\r][\\n]\"\n[DEBUG] wire - << \"Date: Tue, 08 Nov 2011 13:01:06 GMT[\\r][\\n]\"\n[DEBUG] wire - << \"Content-Length: 1293[\\r][\\n]\"\n[DEBUG] wire - << \"[\\r][\\n]\"\n[DEBUG] DefaultClientConnection - Receiving response: HTTP/1.1 401 Unauthorized\n[DEBUG] headers - << HTTP/1.1 401 Unauthorized\n[DEBUG] headers - << Content-Type: text/html\n[DEBUG] headers - << Server: Microsoft-IIS/7.0\n[DEBUG] headers - << WWW-Authenticate: Negotiate\n[DEBUG] headers - << WWW-Authenticate: NTLM\n[DEBUG] headers - << X-Powered-By: ASP.NET\n[DEBUG] headers - << Date: Tue, 08 Nov 2011 13:01:06 GMT\n[DEBUG] headers - << Content-Length: 1293\n[DEBUG] DefaultHttpClient - Connection can be kept alive indefinitely\n[DEBUG] DefaultHttpClient - WIN2008-CAT:80 requested authentication\n[DEBUG] TargetAuthenticationStrategy - Authentication schemes in the order of preference: [negotiate, NTLM, Digest, Basic]\n[DEBUG] NegotiateScheme - Received challenge '' from the auth server\n[DEBUG] TargetAuthenticationStrategy - Challenge for Digest authentication scheme not available\n[DEBUG] TargetAuthenticationStrategy - Challenge for Basic authentication scheme not available\n[DEBUG] wire - << \"<!DOCTYPE html PUBLIC \"-//W3C//DTD XHTML 1.0 Strict//EN\" \"http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd\">[\\r][\\n]\"\n[DEBUG] wire - << \"<html xmlns=\"http://www.w3.org/1999/xhtml\">[\\r][\\n]\"\n[DEBUG] wire - << \"<head>[\\r][\\n]\"\n[DEBUG] wire - << \"<meta http-equiv=\"Content-Type\" content=\"text/html; charset=iso-8859-1\"/>[\\r][\\n]\"\n[DEBUG] wire - << \"<title>401 - Unauthorized: Access is denied due to invalid credentials.</title>[\\r][\\n]\"\n[DEBUG] wire - << \"<style type=\"text/css\">[\\r][\\n]\"\n[DEBUG] wire - << \"<!--[\\r][\\n]\"\n[DEBUG] wire - << \"body{margin:0;font-size:.7em;font-family:Verdana, Arial, Helvetica, sans-serif;background:#EEEEEE;}[\\r][\\n]\"\n[DEBUG] wire - << \"fieldset{padding:0 15px 10px 15px;} [\\r][\\n]\"\n[DEBUG] wire - << \"h1{font-size:2.4em;margin:0;color:#FFF;}[\\r][\\n]\"\n[DEBUG] wire - << \"h2{font-size:1.7em;margin:0;color:#CC0000;} [\\r][\\n]\"\n[DEBUG] wire - << \"h3{font-size:1.2em;margin:10px 0 0 0;color:#000000;} [\\r][\\n]\"\n[DEBUG] wire - << \"#header{width:96%;margin:0 0 0 0;padding:6px 2% 6px 2%;font-family:\"trebuchet MS\", Verdana, sans-serif;color:#FFF;[\\r][\\n]\"\n[DEBUG] wire - << \"background-color:#555555;}[\\r][\\n]\"\n[DEBUG] wire - << \"#content{margin:0 0 0 2%;position:relative;}[\\r][\\n]\"\n[DEBUG] wire - << \".content-container{background:#FFF;width:96%;margin-top:8px;padding:10px;position:relative;}[\\r][\\n]\"\n[DEBUG] wire - << \"-->[\\r][\\n]\"\n[DEBUG] wire - << \"</style>[\\r][\\n]\"\n[DEBUG] wire - << \"</head>[\\r][\\n]\"\n[DEBUG] wire - << \"<body>[\\r][\\n]\"\n[DEBUG] wire - << \"<div id=\"header\"><h1>Server Error</h1></div>[\\r][\\n]\"\n[DEBUG] wire - << \"<div id=\"content\">[\\r][\\n]\"\n[DEBUG] wire - << \" <div class=\"content-container\"><fieldset>[\\r][\\n]\"\n[DEBUG] wire - << \"  <h2>401 - Unauthorized: Access is denied due to invalid credentials.</h2>[\\r][\\n]\"\n[DEBUG] wire - << \"  <h3>You do not have permission to view this directory or page using the credentials that you supplied.</h3>[\\r][\\n]\"\n[DEBUG] wire - << \" </fieldset></div>[\\r][\\n]\"\n[DEBUG] wire - << \"</div>[\\r][\\n]\"\n[DEBUG] wire - << \"</body>[\\r][\\n]\"\n[DEBUG] wire - << \"</html>[\\r][\\n]\"\n[DEBUG] RequestAddCookies - CookieSpec selected: best-match\n[DEBUG] RequestAuthCache - Auth cache not set in the context\n[DEBUG] RequestTargetAuthentication - Target auth state: CHALLENGED\n[DEBUG] RequestTargetAuthentication - Generating response to an authentication challenge using Negotiate scheme\n[DEBUG] NegotiateScheme - init WIN2008-CAT\n[WARN] RequestTargetAuthentication - NEGOTIATE authentication error: Invalid name provided (Mechanism level: Could not load configuration file C:\\WINDOWS\\krb5.ini (The system cannot find the file specified))\n[DEBUG] RequestTargetAuthentication - Generating response to an authentication challenge using ntlm scheme\n[DEBUG] RequestProxyAuthentication - Proxy auth state: UNCHALLENGED\n[DEBUG] DefaultHttpClient - Attempt 2 to execute request\n[DEBUG] DefaultClientConnection - Sending request: GET / HTTP/1.1\n[DEBUG] wire - >> \"GET / HTTP/1.1[\\r][\\n]\"\n[DEBUG] wire - >> \"Host: WIN2008-CAT[\\r][\\n]\"\n[DEBUG] wire - >> \"Connection: Keep-Alive[\\r][\\n]\"\n[DEBUG] wire - >> \"User-Agent: Apache-HttpClient/4.2-alpha1 (java 1.5)[\\r][\\n]\"\n[DEBUG] wire - >> \"Authorization: NTLM TlRMTVNTUAABAAAANQIIIAYABgA2AAAAFgAWACAAAABJAEEATgAtAEwAQQBQAFQATwBQADIAUwBXAEcA[\\r][\\n]\"\n[DEBUG] wire - >> \"[\\r][\\n]\"\n[DEBUG] headers - >> GET / HTTP/1.1\n[DEBUG] headers - >> Host: WIN2008-CAT\n[DEBUG] headers - >> Connection: Keep-Alive\n[DEBUG] headers - >> User-Agent: Apache-HttpClient/4.2-alpha1 (java 1.5)\n[DEBUG] headers - >> Authorization: NTLM TlRMTVNTUAABAAAANQIIIAYABgA2AAAAFgAWACAAAABJAEEATgAtAEwAQQBQAFQATwBQADIAUwBXAEcA\n[DEBUG] wire - << \"HTTP/1.1 401 Unauthorized[\\r][\\n]\"\n[DEBUG] wire - << \"Content-Type: text/html[\\r][\\n]\"\n[DEBUG] wire - << \"Server: Microsoft-IIS/7.0[\\r][\\n]\"\n[DEBUG] wire - << \"WWW-Authenticate: NTLM TlRMTVNTUAACAAAABgAGADgAAAA1Aoki96Eu6J7t1joAAAAAAAAAAJgAmAA+AAAABgByFwAAAA9TAFcARwACAAYAUwBXAEcAAQAWAFcASQBOADIAMAAwADgALQBDAEEAVAAEABgAUwBXAEcALgBDAEQAQwAuAFIATwBPAFQAAwAwAFcASQBOADIAMAAwADgALQBDAEEAVAAuAFMAVwBHAC4AQwBEAEMALgBSAE8ATwBUAAUAEABjAGQAYwAuAHIAbwBvAHQABwAIAOKwfHoWnswBAAAAAA==[\\r][\\n]\"\n[DEBUG] wire - << \"WWW-Authenticate: Negotiate[\\r][\\n]\"\n[DEBUG] wire - << \"X-Powered-By: ASP.NET[\\r][\\n]\"\n[DEBUG] wire - << \"Date: Tue, 08 Nov 2011 13:01:06 GMT[\\r][\\n]\"\n[DEBUG] wire - << \"Content-Length: 1293[\\r][\\n]\"\n[DEBUG] wire - << \"[\\r][\\n]\"\n[DEBUG] DefaultClientConnection - Receiving response: HTTP/1.1 401 Unauthorized\n[DEBUG] headers - << HTTP/1.1 401 Unauthorized\n[DEBUG] headers - << Content-Type: text/html\n[DEBUG] headers - << Server: Microsoft-IIS/7.0\n[DEBUG] headers - << WWW-Authenticate: NTLM TlRMTVNTUAACAAAABgAGADgAAAA1Aoki96Eu6J7t1joAAAAAAAAAAJgAmAA+AAAABgByFwAAAA9TAFcARwACAAYAUwBXAEcAAQAWAFcASQBOADIAMAAwADgALQBDAEEAVAAEABgAUwBXAEcALgBDAEQAQwAuAFIATwBPAFQAAwAwAFcASQBOADIAMAAwADgALQBDAEEAVAAuAFMAVwBHAC4AQwBEAEMALgBSAE8ATwBUAAUAEABjAGQAYwAuAHIAbwBvAHQABwAIAOKwfHoWnswBAAAAAA==\n[DEBUG] headers - << WWW-Authenticate: Negotiate\n[DEBUG] headers - << X-Powered-By: ASP.NET\n[DEBUG] headers - << Date: Tue, 08 Nov 2011 13:01:06 GMT\n[DEBUG] headers - << Content-Length: 1293\n[DEBUG] DefaultHttpClient - Connection can be kept alive indefinitely\n[DEBUG] DefaultHttpClient - WIN2008-CAT:80 requested authentication\n[DEBUG] DefaultHttpClient - Authorization challenge processed\n[DEBUG] wire - << \"<!DOCTYPE html PUBLIC \"-//W3C//DTD XHTML 1.0 Strict//EN\" \"http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd\">[\\r][\\n]\"\n[DEBUG] wire - << \"<html xmlns=\"http://www.w3.org/1999/xhtml\">[\\r][\\n]\"\n[DEBUG] wire - << \"<head>[\\r][\\n]\"\n[DEBUG] wire - << \"<meta http-equiv=\"Content-Type\" content=\"text/html; charset=iso-8859-1\"/>[\\r][\\n]\"\n[DEBUG] wire - << \"<title>401 - Unauthorized: Access is denied due to invalid credentials.</title>[\\r][\\n]\"\n[DEBUG] wire - << \"<style type=\"text/css\">[\\r][\\n]\"\n[DEBUG] wire - << \"<!--[\\r][\\n]\"\n[DEBUG] wire - << \"body{margin:0;font-size:.7em;font-family:Verdana, Arial, Helvetica, sans-serif;background:#EEEEEE;}[\\r][\\n]\"\n[DEBUG] wire - << \"fieldset{padding:0 15px 10px 15px;} [\\r][\\n]\"\n[DEBUG] wire - << \"h1{font-size:2.4em;margin:0;color:#FFF;}[\\r][\\n]\"\n[DEBUG] wire - << \"h2{font-size:1.7em;margin:0;color:#CC0000;} [\\r][\\n]\"\n[DEBUG] wire - << \"h3{font-size:1.2em;margin:10px 0 0 0;color:#000000;} [\\r][\\n]\"\n[DEBUG] wire - << \"#header{width:96%;margin:0 0 0 0;padding:6px 2% 6px 2%;font-family:\"trebuchet MS\", Verdana, sans-serif;color:#FFF;[\\r][\\n]\"\n[DEBUG] wire - << \"background-color:#555555;}[\\r][\\n]\"\n[DEBUG] wire - << \"#content{margin:0 0 0 2%;position:relative;}[\\r][\\n]\"\n[DEBUG] wire - << \".content-container{background:#FFF;width:96%;margin-top:8px;padding:10px;position:relative;}[\\r][\\n]\"\n[DEBUG] wire - << \"-->[\\r][\\n]\"\n[DEBUG] wire - << \"</style>[\\r][\\n]\"\n[DEBUG] wire - << \"</head>[\\r][\\n]\"\n[DEBUG] wire - << \"<body>[\\r][\\n]\"\n[DEBUG] wire - << \"<div id=\"header\"><h1>Server Error</h1></div>[\\r][\\n]\"\n[DEBUG] wire - << \"<div id=\"content\">[\\r][\\n]\"\n[DEBUG] wire - << \" <div class=\"content-container\"><fieldset>[\\r][\\n]\"\n[DEBUG] wire - << \"  <h2>401 - Unauthorized: Access is denied due to invalid credentials.</h2>[\\r][\\n]\"\n[DEBUG] wire - << \"  <h3>You do not have permission to view this directory or page using the credentials that you supplied.</h3>[\\r][\\n]\"\n[DEBUG] wire - << \" </fieldset></div>[\\r][\\n]\"\n[DEBUG] wire - << \"</div>[\\r][\\n]\"\n[DEBUG] wire - << \"</body>[\\r][\\n]\"\n[DEBUG] wire - << \"</html>[\\r][\\n]\"\n[DEBUG] RequestAddCookies - CookieSpec selected: best-match\n[DEBUG] RequestAuthCache - Auth cache not set in the context\n[DEBUG] RequestTargetAuthentication - Target auth state: HANDSHAKE\n[DEBUG] RequestProxyAuthentication - Proxy auth state: UNCHALLENGED\n[DEBUG] DefaultHttpClient - Attempt 3 to execute request\n[DEBUG] DefaultClientConnection - Sending request: GET / HTTP/1.1\n[DEBUG] wire - >> \"GET / HTTP/1.1[\\r][\\n]\"\n[DEBUG] wire - >> \"Host: WIN2008-CAT[\\r][\\n]\"\n[DEBUG] wire - >> \"Connection: Keep-Alive[\\r][\\n]\"\n[DEBUG] wire - >> \"User-Agent: Apache-HttpClient/4.2-alpha1 (java 1.5)[\\r][\\n]\"\n[DEBUG] wire - >> \"Authorization: NTLM TlRMTVNTUAADAAAAGAAYAEAAAADEAMQAWAAAAAYABgAcAQAAEgASACIBAAAWABYANAEAAAAAAABKAQAANQIIIKG3pGkmvtI0sFFa6CS+/yvXTfdr4+0L7pYPHxK1BocwDzJXBXTd4mMBAQAAAAAAAMBXzaEWnswB1033a+PtC+4AAAAAAgAGAFMAVwBHAAEAFgBXAEkATgAyADAAMAA4AC0AQwBBAFQABAAYAFMAVwBHAC4AQwBEAEMALgBSAE8ATwBUAAMAMABXAEkATgAyADAAMAA4AC0AQwBBAFQALgBTAFcARwAuAEMARABDAC4AUgBPAE8AVAAFABAAYwBkAGMALgByAG8AbwB0AAcACADisHx6Fp7MAQAAAABTAFcARwBJAEIAZQBhAHUAbQBvAG4AdABJAEEATgAtAEwAQQBQAFQATwBQADIA[\\r][\\n]\"\n[DEBUG] wire - >> \"[\\r][\\n]\"\n[DEBUG] headers - >> GET / HTTP/1.1\n[DEBUG] headers - >> Host: WIN2008-CAT\n[DEBUG] headers - >> Connection: Keep-Alive\n[DEBUG] headers - >> User-Agent: Apache-HttpClient/4.2-alpha1 (java 1.5)\n[DEBUG] headers - >> Authorization: NTLM TlRMTVNTUAADAAAAGAAYAEAAAADEAMQAWAAAAAYABgAcAQAAEgASACIBAAAWABYANAEAAAAAAABKAQAANQIIIKG3pGkmvtI0sFFa6CS+/yvXTfdr4+0L7pYPHxK1BocwDzJXBXTd4mMBAQAAAAAAAMBXzaEWnswB1033a+PtC+4AAAAAAgAGAFMAVwBHAAEAFgBXAEkATgAyADAAMAA4AC0AQwBBAFQABAAYAFMAVwBHAC4AQwBEAEMALgBSAE8ATwBUAAMAMABXAEkATgAyADAAMAA4AC0AQwBBAFQALgBTAFcARwAuAEMARABDAC4AUgBPAE8AVAAFABAAYwBkAGMALgByAG8AbwB0AAcACADisHx6Fp7MAQAAAABTAFcARwBJAEIAZQBhAHUAbQBvAG4AdABJAEEATgAtAEwAQQBQAFQATwBQADIA\n[DEBUG] wire - << \"HTTP/1.1 200 OK[\\r][\\n]\"\n[DEBUG] wire - << \"Content-Type: text/html[\\r][\\n]\"\n[DEBUG] wire - << \"Last-Modified: Thu, 17 Feb 2011 16:49:40 GMT[\\r][\\n]\"\n[DEBUG] wire - << \"Accept-Ranges: bytes[\\r][\\n]\"\n[DEBUG] wire - << \"ETag: \"d9919dabc2cecb1:0\"[\\r][\\n]\"\n[DEBUG] wire - << \"Server: Microsoft-IIS/7.0[\\r][\\n]\"\n[DEBUG] wire - << \"X-Powered-By: ASP.NET[\\r][\\n]\"\n[DEBUG] wire - << \"Date: Tue, 08 Nov 2011 13:01:06 GMT[\\r][\\n]\"\n[DEBUG] wire - << \"Content-Length: 689[\\r][\\n]\"\n[DEBUG] wire - << \"[\\r][\\n]\"\n[DEBUG] DefaultClientConnection - Receiving response: HTTP/1.1 200 OK\n[DEBUG] headers - << HTTP/1.1 200 OK\n[DEBUG] headers - << Content-Type: text/html\n[DEBUG] headers - << Last-Modified: Thu, 17 Feb 2011 16:49:40 GMT\n[DEBUG] headers - << Accept-Ranges: bytes\n[DEBUG] headers - << ETag: \"d9919dabc2cecb1:0\"\n[DEBUG] headers - << Server: Microsoft-IIS/7.0\n[DEBUG] headers - << X-Powered-By: ASP.NET\n[DEBUG] headers - << Date: Tue, 08 Nov 2011 13:01:06 GMT\n[DEBUG] headers - << Content-Length: 689\n[DEBUG] DefaultHttpClient - Connection can be kept alive indefinitely\n[DEBUG] wire - << \"<!DOCTYPE html PUBLIC \"-//W3C//DTD XHTML 1.0 Strict//EN\" \"http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd\">[\\r][\\n]\"\n[DEBUG] wire - << \"<html xmlns=\"http://www.w3.org/1999/xhtml\">[\\r][\\n]\"\n[DEBUG] wire - << \"<head>[\\r][\\n]\"\n[DEBUG] wire - << \"<meta http-equiv=\"Content-Type\" content=\"text/html; charset=iso-8859-1\" />[\\r][\\n]\"\n[DEBUG] wire - << \"<title>IIS7</title>[\\r][\\n]\"\n[DEBUG] wire - << \"<style type=\"text/css\">[\\r][\\n]\"\n[DEBUG] wire - << \"<!--[\\r][\\n]\"\n[DEBUG] wire - << \"body {[\\r][\\n]\"\n[DEBUG] wire - << \"[0x9]color:#000000;[\\r][\\n]\"\n[DEBUG] wire - << \"[0x9]background-color:#B3B3B3;[\\r][\\n]\"\n[DEBUG] wire - << \"[0x9]margin:0;[\\r][\\n]\"\n[DEBUG] wire - << \"}[\\r][\\n]\"\n[DEBUG] wire - << \"[\\r][\\n]\"\n[DEBUG] wire - << \"#container {[\\r][\\n]\"\n[DEBUG] wire - << \"[0x9]margin-left:auto;[\\r][\\n]\"\n[DEBUG] wire - << \"[0x9]margin-right:auto;[\\r][\\n]\"\n[DEBUG] wire - << \"[0x9]text-align:center;[\\r][\\n]\"\n[DEBUG] wire - << \"[0x9]}[\\r][\\n]\"\n[DEBUG] wire - << \"[\\r][\\n]\"\n[DEBUG] wire - << \"a img {[\\r][\\n]\"\n[DEBUG] wire - << \"[0x9]border:none;[\\r][\\n]\"\n[DEBUG] wire - << \"}[\\r][\\n]\"\n[DEBUG] wire - << \"[\\r][\\n]\"\n[DEBUG] wire - << \"-->[\\r][\\n]\"\n[DEBUG] wire - << \"</style>[\\r][\\n]\"\n[DEBUG] wire - << \"</head>[\\r][\\n]\"\n[DEBUG] wire - << \"<body>[\\r][\\n]\"\n[DEBUG] wire - << \"<div id=\"container\">[\\r][\\n]\"\n[DEBUG] wire - << \"<a href=\"http://go.microsoft.com/fwlink/?linkid=66138&amp;clcid=0x409\"><img src=\"welcome.png\" alt=\"IIS7\" width=\"571\" height=\"411\" /></a>[\\r][\\n]\"\ncontent:<!DOCTYPE html PUBLIC \"-//W3C//DTD XHTML 1.0 Strict//EN\" \"http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd\">\n[DEBUG] wire - << \"</div>[\\r][\\n]\"\n<html xmlns=\"http://www.w3.org/1999/xhtml\">\n[DEBUG] wire - << \"</body>[\\r][\\n]\"\n<head>\n[DEBUG] wire - << \"</html>\"\n<meta http-equiv=\"Content-Type\" content=\"text/html; charset=iso-8859-1\" />\n<title>IIS7</title>\n<style type=\"text/css\">\n<!--\nbody {\n\tcolor:#000000;\n\tbackground-color:#B3B3B3;\n\tmargin:0;\n}\n\n[DEBUG] PoolingClientConnectionManager - Connection [id: 0][route: {}->http://WIN2008-CAT][state: XXX/YYYYYYYYYY] can be kept alive indefinitely\n#container {\n\tmargin-left:auto;\n\tmargin-right:auto;\n\ttext-align:center;\n\t}\n\na img {\n\tborder:none;\n}\n\n[DEBUG] PoolingClientConnectionManager - Connection released: [id: 0][route: {}->http://WIN2008-CAT][state: XXX/YYYYYYYYYY][total kept alive: 1; route allocated: 1 of 2; total allocated: 1 of 20]\n-->\n</style>\n</head>\n<body>\n<div id=\"container\">\n<a href=\"http://go.microsoft.com/fwlink/?linkid=66138&amp;clcid=0x409\"><img src=\"welcome.png\" alt=\"IIS7\" width=\"571\" height=\"411\" /></a>\n</div>\n</body>\n</html>\n\n",
            "date": "2011-11-08T13:05:33.539+0000",
            "id": 8
        },
        {
            "author": "Oleg Kalnichevski",
            "body": "@ Ian\n\nGreat! Thank you so much! I just wanted to be sure the log contained enough details about the authentication process, which seems to be the case.\n\n---\n[DEBUG] RequestTargetAuthentication - Generating response to an authentication challenge using Negotiate scheme\n[DEBUG] NegotiateScheme - init WIN2008-CAT\n[WARN] RequestTargetAuthentication - NEGOTIATE authentication error: Invalid name provided (Mechanism level: Could not load configuration file C:\\WINDOWS\\krb5.ini (The system cannot find the file specified))\n[DEBUG] RequestTargetAuthentication - Generating response to an authentication challenge using ntlm scheme \n---\n\nOleg",
            "date": "2011-11-08T13:13:36.799+0000",
            "id": 9
        },
        {
            "author": "Ian Beaumont",
            "body": "It seems I was bit hasty in saying it worked ok.  I've just tried it in a different scenario and it goes into an endless loop of retrying authentication.  \n\nThis seems related to doing a POST rather than a GET.",
            "date": "2012-01-12T12:38:11.585+0000",
            "id": 10
        },
        {
            "author": "Ian Beaumont",
            "body": "See attachments :\npost_endless_authentication_loop.txt\nworking_get_request.txt\n\nfor the debug log of it getting stuck in a loop of constant authenticating with a POST, and also a similar log of it working ok when I make a GET request.",
            "date": "2012-01-12T12:42:44.112+0000",
            "id": 11
        },
        {
            "author": "Oleg Kalnichevski",
            "body": "Ian, are you using 4.2-alpha1 or the latest SVN trunk snapshot? There was a critical bug fix since 4.2-alpha1 (HTTPCLIENT-1142) which resolved similar infinite loop problem?\n\nOleg",
            "date": "2012-01-12T12:54:00.463+0000",
            "id": 12
        },
        {
            "author": "Ian Beaumont",
            "body": "4.2-alpha1 - I'll get the latest snapshot and try that\n\n",
            "date": "2012-01-12T12:59:39.432+0000",
            "id": 13
        },
        {
            "author": "Ian Beaumont",
            "body": "Sorry for the dumb question...is there a latest build of the trunk available (are daily builds available?) or do I need to check it out and build it myself?\n\n",
            "date": "2012-01-12T13:07:40.326+0000",
            "id": 14
        },
        {
            "author": "Oleg Kalnichevski",
            "body": "I just pushed the latest snapshot to the official snapshot repository. This should save you a trouble of having to compile it by yourself.\n\nhttps://repository.apache.org/content/repositories/snapshots/org/apache/httpcomponents/httpclient/4.2-alpha2-SNAPSHOT/\n\nOleg",
            "date": "2012-01-12T13:25:29.133+0000",
            "id": 15
        },
        {
            "author": "Ian Beaumont",
            "body": "Thanks, all working well with the latest snapshot. :-)\n\n",
            "date": "2012-01-12T16:31:38.636+0000",
            "id": 16
        }
    ],
    "component": "HttpClient (classic)",
    "description": "I'm trying to request a page from IIS (6 and 7.5).  If the IIS is configured with providers for \"negotiate\" and \"ntlm\" then the Negotiate authentication is tried and fails, but it does not then try to use the NTLM authentication which is what I require.  If I removed \"negotiate\" as a provider from IIS and just use NTLM then all works well - but this is not a solution as I don't have control of the web servers. \n\nOutput below...\n\n\n[DEBUG] SingleClientConnManager - Get connection for route HttpRoute[{}->http://WIN-HNB91NNAB2G]\n[DEBUG] DefaultClientConnectionOperator - Connecting to WIN-HNB91NNAB2G/147.183.80.134:80\n[DEBUG] RequestAddCookies - CookieSpec selected: best-match\n[DEBUG] DefaultHttpClient - Attempt 1 to execute request\n[DEBUG] DefaultClientConnection - Sending request: GET / HTTP/1.1\n[DEBUG] wire - >> \"GET / HTTP/1.1[\\r][\\n]\"\n[DEBUG] wire - >> \"Host: WIN-HNB91NNAB2G[\\r][\\n]\"\n[DEBUG] wire - >> \"Connection: Keep-Alive[\\r][\\n]\"\n[DEBUG] wire - >> \"User-Agent: Apache-HttpClient/4.1 (java 1.5)[\\r][\\n]\"\n[DEBUG] wire - >> \"[\\r][\\n]\"\n[DEBUG] headers - >> GET / HTTP/1.1\n[DEBUG] headers - >> Host: WIN-HNB91NNAB2G\n[DEBUG] headers - >> Connection: Keep-Alive\n[DEBUG] headers - >> User-Agent: Apache-HttpClient/4.1 (java 1.5)\n[DEBUG] wire - << \"HTTP/1.1 401 Unauthorized[\\r][\\n]\"\n[DEBUG] wire - << \"Content-Type: text/html[\\r][\\n]\"\n[DEBUG] wire - << \"Server: Microsoft-IIS/7.5[\\r][\\n]\"\n[DEBUG] wire - << \"WWW-Authenticate: Negotiate[\\r][\\n]\"\n[DEBUG] wire - << \"WWW-Authenticate: NTLM[\\r][\\n]\"\n[DEBUG] wire - << \"Date: Fri, 15 Jul 2011 12:15:11 GMT[\\r][\\n]\"\n[DEBUG] wire - << \"Content-Length: 58[\\r][\\n]\"\n[DEBUG] wire - << \"[\\r][\\n]\"\n[DEBUG] DefaultClientConnection - Receiving response: HTTP/1.1 401 Unauthorized\n[DEBUG] headers - << HTTP/1.1 401 Unauthorized\n[DEBUG] headers - << Content-Type: text/html\n[DEBUG] headers - << Server: Microsoft-IIS/7.5\n[DEBUG] headers - << WWW-Authenticate: Negotiate\n[DEBUG] headers - << WWW-Authenticate: NTLM\n[DEBUG] headers - << Date: Fri, 15 Jul 2011 12:15:11 GMT\n[DEBUG] headers - << Content-Length: 58\n[DEBUG] DefaultHttpClient - Connection can be kept alive indefinitely\n[DEBUG] DefaultHttpClient - Target requested authentication\n[DEBUG] DefaultTargetAuthenticationHandler - Authentication schemes in the order of preference: [negotiate, NTLM, Digest, Basic]\n[DEBUG] DefaultTargetAuthenticationHandler - negotiate authentication scheme selected\n[DEBUG] NegotiateScheme - Received challenge '' from the auth server\n[DEBUG] DefaultHttpClient - Authorization challenge processed\n[DEBUG] DefaultHttpClient - Authentication scope: NEGOTIATE <any realm>@win-hnb91nnab2g:80\n[DEBUG] DefaultHttpClient - Found credentials\n[DEBUG] wire - << \"You do not have permission to view this directory or page.\"\n[DEBUG] RequestAddCookies - CookieSpec selected: best-match\n[DEBUG] NegotiateScheme - init WIN-HNB91NNAB2G\n[ERROR] RequestTargetAuthentication - Authentication error: Invalid name provided (Mechanism level: Could not load configuration file C:\\WINDOWS\\krb5.ini (The system cannot find the file specified))\n[DEBUG] DefaultHttpClient - Attempt 2 to execute request\n[DEBUG] DefaultClientConnection - Sending request: GET / HTTP/1.1\n[DEBUG] wire - >> \"GET / HTTP/1.1[\\r][\\n]\"\n[DEBUG] wire - >> \"Host: WIN-HNB91NNAB2G[\\r][\\n]\"\n[DEBUG] wire - >> \"Connection: Keep-Alive[\\r][\\n]\"\n[DEBUG] wire - >> \"User-Agent: Apache-HttpClient/4.1 (java 1.5)[\\r][\\n]\"\n[DEBUG] wire - >> \"[\\r][\\n]\"\n[DEBUG] headers - >> GET / HTTP/1.1\n[DEBUG] headers - >> Host: WIN-HNB91NNAB2G\n[DEBUG] headers - >> Connection: Keep-Alive\n[DEBUG] headers - >> User-Agent: Apache-HttpClient/4.1 (java 1.5)\n[DEBUG] wire - << \"HTTP/1.1 401 Unauthorized[\\r][\\n]\"\n[DEBUG] wire - << \"Content-Type: text/html[\\r][\\n]\"\n[DEBUG] wire - << \"Server: Microsoft-IIS/7.5[\\r][\\n]\"\n[DEBUG] wire - << \"WWW-Authenticate: Negotiate[\\r][\\n]\"\n[DEBUG] wire - << \"WWW-Authenticate: NTLM[\\r][\\n]\"\n[DEBUG] wire - << \"Date: Fri, 15 Jul 2011 12:15:11 GMT[\\r][\\n]\"\n[DEBUG] wire - << \"Content-Length: 58[\\r][\\n]\"\n[DEBUG] wire - << \"[\\r][\\n]\"\n[DEBUG] DefaultClientConnection - Receiving response: HTTP/1.1 401 Unauthorized\n[DEBUG] headers - << HTTP/1.1 401 Unauthorized\n[DEBUG] headers - << Content-Type: text/html\n[DEBUG] headers - << Server: Microsoft-IIS/7.5\n[DEBUG] headers - << WWW-Authenticate: Negotiate\n[DEBUG] headers - << WWW-Authenticate: NTLM\n[DEBUG] headers - << Date: Fri, 15 Jul 2011 12:15:11 GMT\n[DEBUG] headers - << Content-Length: 58\n[DEBUG] DefaultHttpClient - Connection can be kept alive indefinitely\n[DEBUG] DefaultHttpClient - Target requested authentication\n[DEBUG] NegotiateScheme - Received challenge '' from the auth server\n[DEBUG] NegotiateScheme - Authentication already attempted\n[DEBUG] DefaultHttpClient - Authorization challenge processed\n[DEBUG] DefaultHttpClient - Authentication scope: NEGOTIATE <any realm>@win-hnb91nnab2g:80\n[DEBUG] DefaultHttpClient - Authentication failed\n[DEBUG] wire - << \"You do not have permission to view this directory or page.\"\ncontent:You do not have permission to view this directory or page.\n[DEBUG] SingleClientConnManager - Releasing connection org.apache.http.impl.conn.SingleClientConnManager$ConnAdapter@17fa65e\n",
    "hasPatch": false,
    "hasScreenshot": false,
    "id": "HTTPCLIENT-1107",
    "issuetypeClassified": "BUG",
    "issuetypeTracker": "BUG",
    "priority": "Major",
    "product": "HTTPCLIENT",
    "project": "HTTPCLIENT",
    "summary": "HttpClient does not retry authentication when multiple challenges are present if the primary one fails",
    "systemSpecification": true,
    "version": "4.1.1"
}