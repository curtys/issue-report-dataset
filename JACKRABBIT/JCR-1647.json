{
    "comments": [
        {
            "author": "Scott",
            "body": "I'm attaching a test program and repository.xml that demonstrate the problem.\n",
            "date": "2008-06-11T14:27:17.450+0000",
            "id": 0
        },
        {
            "author": "Scott",
            "body": "See attached for a patch to UserManagerImpl.java that works around the problem by using a different XPath query.",
            "date": "2008-06-17T16:00:53.519+0000",
            "id": 1
        },
        {
            "author": "Marcel Reutegger",
            "body": "ISO9075 encoded the node name before it is used in the element() name test.\n\nFixed in revision: 669107\n\nThank you for reporting this issue.",
            "date": "2008-06-18T08:22:52.393+0000",
            "id": 2
        }
    ],
    "component": "JCR 2.0",
    "description": "The UserManager method createUser(String userID, String password) throws an exception (javax.jcr.query.InvalidQueryException) if the user name contains a '@' character.\n\nStack trace:\nException in thread \"main\" javax.jcr.query.InvalidQueryException: Lexical error at line 1, column 76.  Encountered: \"@\" (64), after : \"\" for statement: for $v in /jcr:root/rep:security/rep:authorizables/rep:groups//element(test@example.com,rep:Group) return $v: Lexical error at line 1, column 76.  Encountered: \"@\" (64), after : \"\": Lexical error at line 1, column 76.  Encountered: \"@\" (64), after : \"\"\n        at org.apache.jackrabbit.spi.commons.query.xpath.XPathQueryBuilder.<init>(XPathQueryBuilder.java:302)\n        at org.apache.jackrabbit.spi.commons.query.xpath.XPathQueryBuilder.createQuery(XPathQueryBuilder.java:331)\n        at org.apache.jackrabbit.spi.commons.query.xpath.QueryBuilder.createQueryTree(QueryBuilder.java:39)\n        at org.apache.jackrabbit.spi.commons.query.QueryParser.parse(QueryParser.java:57)\n        at org.apache.jackrabbit.core.query.lucene.QueryImpl.<init>(QueryImpl.java:91)\n        at org.apache.jackrabbit.core.query.lucene.SearchIndex.createExecutableQuery(SearchIndex.java:615)\n        at org.apache.jackrabbit.core.query.QueryImpl.init(QueryImpl.java:128)\n        at org.apache.jackrabbit.core.SearchManager.createQuery(SearchManager.java:282)\n        at org.apache.jackrabbit.core.query.QueryManagerImpl.createQuery(QueryManagerImpl.java:102)\n        at org.apache.jackrabbit.core.security.user.IndexNodeResolver.buildQuery(IndexNodeResolver.java:105)\n        at org.apache.jackrabbit.core.security.user.IndexNodeResolver.findNode(IndexNodeResolver.java:50)\n        at org.apache.jackrabbit.core.security.user.UserManagerImpl.getAuthorizable(UserManagerImpl.java:93)\n        at org.apache.jackrabbit.core.security.user.UserManagerImpl.createUser(UserManagerImpl.java:177)\n        at org.apache.jackrabbit.core.security.user.UserManagerImpl.createUser(UserManagerImpl.java:158)\n        at FirstHop.main(FirstHop.java:20)\nCaused by: org.apache.jackrabbit.spi.commons.query.xpath.TokenMgrError: Lexical error at line 1, column 76.  Encountered: \"@\" (64), after : \"\"\n        at org.apache.jackrabbit.spi.commons.query.xpath.XPathTokenManager.getNextToken(XPathTokenManager.java:13263)\n        at org.apache.jackrabbit.spi.commons.query.xpath.XPath.jj_ntk(XPath.java:9187)\n        at org.apache.jackrabbit.spi.commons.query.xpath.XPath.ElementTest(XPath.java:8745)\n        at org.apache.jackrabbit.spi.commons.query.xpath.XPath.KindTest(XPath.java:8120)\n        at org.apache.jackrabbit.spi.commons.query.xpath.XPath.NodeTest(XPath.java:5041)\n        at org.apache.jackrabbit.spi.commons.query.xpath.XPath.AbbrevForwardStep(XPath.java:4891)\n        at org.apache.jackrabbit.spi.commons.query.xpath.XPath.ForwardStep(XPath.java:4747)\n        at org.apache.jackrabbit.spi.commons.query.xpath.XPath.AxisStep(XPath.java:4692)\n        at org.apache.jackrabbit.spi.commons.query.xpath.XPath.StepExpr(XPath.java:4597)\n        at org.apache.jackrabbit.spi.commons.query.xpath.XPath.RelativePathExpr(XPath.java:4547)\n        at org.apache.jackrabbit.spi.commons.query.xpath.XPath.PathExpr(XPath.java:4396)\n        at org.apache.jackrabbit.spi.commons.query.xpath.XPath.ValueExpr(XPath.java:4125)\n        at org.apache.jackrabbit.spi.commons.query.xpath.XPath.UnaryExpr(XPath.java:4032)\n        at org.apache.jackrabbit.spi.commons.query.xpath.XPath.CastExpr(XPath.java:3935)\n        at org.apache.jackrabbit.spi.commons.query.xpath.XPath.CastableExpr(XPath.java:3898)\n        at org.apache.jackrabbit.spi.commons.query.xpath.XPath.TreatExpr(XPath.java:3861)\n        at org.apache.jackrabbit.spi.commons.query.xpath.XPath.InstanceofExpr(XPath.java:3824)\n        at org.apache.jackrabbit.spi.commons.query.xpath.XPath.IntersectExceptExpr(XPath.java:3748)\n        at org.apache.jackrabbit.spi.commons.query.xpath.XPath.UnionExpr(XPath.java:3672)\n        at org.apache.jackrabbit.spi.commons.query.xpath.XPath.MultiplicativeExpr(XPath.java:3586)\n        at org.apache.jackrabbit.spi.commons.query.xpath.XPath.AdditiveExpr(XPath.java:3510)\n        at org.apache.jackrabbit.spi.commons.query.xpath.XPath.RangeExpr(XPath.java:3451)\n        at org.apache.jackrabbit.spi.commons.query.xpath.XPath.ComparisonExpr(XPath.java:3353)\n        at org.apache.jackrabbit.spi.commons.query.xpath.XPath.AndExpr(XPath.java:3290)\n        at org.apache.jackrabbit.spi.commons.query.xpath.XPath.OrExpr(XPath.java:3227)\n        at org.apache.jackrabbit.spi.commons.query.xpath.XPath.ExprSingle(XPath.java:2214)\n        at org.apache.jackrabbit.spi.commons.query.xpath.XPath.ForClause(XPath.java:2337)\n        at org.apache.jackrabbit.spi.commons.query.xpath.XPath.FLWORExpr(XPath.java:2233)\n        at org.apache.jackrabbit.spi.commons.query.xpath.XPath.ExprSingle(XPath.java:2133)\n        at org.apache.jackrabbit.spi.commons.query.xpath.XPath.Expr(XPath.java:2094)\n        at org.apache.jackrabbit.spi.commons.query.xpath.XPath.QueryBody(XPath.java:2066)\n        at org.apache.jackrabbit.spi.commons.query.xpath.XPath.MainModule(XPath.java:512)\n        at org.apache.jackrabbit.spi.commons.query.xpath.XPath.Module(XPath.java:387)\n        at org.apache.jackrabbit.spi.commons.query.xpath.XPath.QueryList(XPath.java:151)\n        at org.apache.jackrabbit.spi.commons.query.xpath.XPath.XPath2(XPath.java:118)\n        at org.apache.jackrabbit.spi.commons.query.xpath.XPathQueryBuilder.<init>(XPathQueryBuilder.java:295)\n        ... 14 more\norg.apache.jackrabbit.spi.commons.query.xpath.TokenMgrError: Lexical error at line 1, column 76.  Encountered: \"@\" (64), after : \"\"\n        at org.apache.jackrabbit.spi.commons.query.xpath.XPathTokenManager.getNextToken(XPathTokenManager.java:13263)\n        at org.apache.jackrabbit.spi.commons.query.xpath.XPath.jj_ntk(XPath.java:9187)\n        at org.apache.jackrabbit.spi.commons.query.xpath.XPath.ElementTest(XPath.java:8745)\n        at org.apache.jackrabbit.spi.commons.query.xpath.XPath.KindTest(XPath.java:8120)\n        at org.apache.jackrabbit.spi.commons.query.xpath.XPath.NodeTest(XPath.java:5041)\n        at org.apache.jackrabbit.spi.commons.query.xpath.XPath.AbbrevForwardStep(XPath.java:4891)\n        at org.apache.jackrabbit.spi.commons.query.xpath.XPath.ForwardStep(XPath.java:4747)\n        at org.apache.jackrabbit.spi.commons.query.xpath.XPath.AxisStep(XPath.java:4692)\n        at org.apache.jackrabbit.spi.commons.query.xpath.XPath.StepExpr(XPath.java:4597)\n        at org.apache.jackrabbit.spi.commons.query.xpath.XPath.RelativePathExpr(XPath.java:4547)\n        at org.apache.jackrabbit.spi.commons.query.xpath.XPath.PathExpr(XPath.java:4396)\n        at org.apache.jackrabbit.spi.commons.query.xpath.XPath.ValueExpr(XPath.java:4125)\n        at org.apache.jackrabbit.spi.commons.query.xpath.XPath.UnaryExpr(XPath.java:4032)\n        at org.apache.jackrabbit.spi.commons.query.xpath.XPath.CastExpr(XPath.java:3935)\n        at org.apache.jackrabbit.spi.commons.query.xpath.XPath.CastableExpr(XPath.java:3898)\n        at org.apache.jackrabbit.spi.commons.query.xpath.XPath.TreatExpr(XPath.java:3861)\n        at org.apache.jackrabbit.spi.commons.query.xpath.XPath.InstanceofExpr(XPath.java:3824)\n        at org.apache.jackrabbit.spi.commons.query.xpath.XPath.IntersectExceptExpr(XPath.java:3748)\n        at org.apache.jackrabbit.spi.commons.query.xpath.XPath.UnionExpr(XPath.java:3672)\n        at org.apache.jackrabbit.spi.commons.query.xpath.XPath.MultiplicativeExpr(XPath.java:3586)\n        at org.apache.jackrabbit.spi.commons.query.xpath.XPath.AdditiveExpr(XPath.java:3510)\n        at org.apache.jackrabbit.spi.commons.query.xpath.XPath.RangeExpr(XPath.java:3451)\n        at org.apache.jackrabbit.spi.commons.query.xpath.XPath.ComparisonExpr(XPath.java:3353)\n        at org.apache.jackrabbit.spi.commons.query.xpath.XPath.AndExpr(XPath.java:3290)\n        at org.apache.jackrabbit.spi.commons.query.xpath.XPath.OrExpr(XPath.java:3227)\n        at org.apache.jackrabbit.spi.commons.query.xpath.XPath.ExprSingle(XPath.java:2214)\n        at org.apache.jackrabbit.spi.commons.query.xpath.XPath.ForClause(XPath.java:2337)\n        at org.apache.jackrabbit.spi.commons.query.xpath.XPath.FLWORExpr(XPath.java:2233)\n        at org.apache.jackrabbit.spi.commons.query.xpath.XPath.ExprSingle(XPath.java:2133)\n        at org.apache.jackrabbit.spi.commons.query.xpath.XPath.Expr(XPath.java:2094)\n        at org.apache.jackrabbit.spi.commons.query.xpath.XPath.QueryBody(XPath.java:2066)\n        at org.apache.jackrabbit.spi.commons.query.xpath.XPath.MainModule(XPath.java:512)\n        at org.apache.jackrabbit.spi.commons.query.xpath.XPath.Module(XPath.java:387)\n        at org.apache.jackrabbit.spi.commons.query.xpath.XPath.QueryList(XPath.java:151)\n        at org.apache.jackrabbit.spi.commons.query.xpath.XPath.XPath2(XPath.java:118)\n        at org.apache.jackrabbit.spi.commons.query.xpath.XPathQueryBuilder.<init>(XPathQueryBuilder.java:295)\n        at org.apache.jackrabbit.spi.commons.query.xpath.XPathQueryBuilder.createQuery(XPathQueryBuilder.java:331)\n        at org.apache.jackrabbit.spi.commons.query.xpath.QueryBuilder.createQueryTree(QueryBuilder.java:39)\n        at org.apache.jackrabbit.spi.commons.query.QueryParser.parse(QueryParser.java:57)\n        at org.apache.jackrabbit.core.query.lucene.QueryImpl.<init>(QueryImpl.java:91)\n        at org.apache.jackrabbit.core.query.lucene.SearchIndex.createExecutableQuery(SearchIndex.java:615)\n        at org.apache.jackrabbit.core.query.QueryImpl.init(QueryImpl.java:128)\n        at org.apache.jackrabbit.core.SearchManager.createQuery(SearchManager.java:282)\n        at org.apache.jackrabbit.core.query.QueryManagerImpl.createQuery(QueryManagerImpl.java:102)\n        at org.apache.jackrabbit.core.security.user.IndexNodeResolver.buildQuery(IndexNodeResolver.java:105)\n        at org.apache.jackrabbit.core.security.user.IndexNodeResolver.findNode(IndexNodeResolver.java:50)\n        at org.apache.jackrabbit.core.security.user.UserManagerImpl.getAuthorizable(UserManagerImpl.java:93)\n        at org.apache.jackrabbit.core.security.user.UserManagerImpl.createUser(UserManagerImpl.java:177)\n        at org.apache.jackrabbit.core.security.user.UserManagerImpl.createUser(UserManagerImpl.java:158)\n        at FirstHop.main(FirstHop.java:20)\n\n",
    "hasPatch": true,
    "hasScreenshot": false,
    "id": "JCR-1647",
    "issuetypeClassified": "BUG",
    "issuetypeTracker": "BUG",
    "priority": "Major",
    "product": "JACKRABBIT",
    "project": "JACKRABBIT",
    "summary": "UserManager throws javax.jcr.query.InvalidQueryException on createUser",
    "systemSpecification": true,
    "version": "1.5"
}