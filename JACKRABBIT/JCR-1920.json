{
    "comments": [
        {
            "author": "Alexander Klimetschek",
            "body": "The error message \"com.sun.security.auth.module.LdapLoginModule does not support 'userProvider\" is coming from Sun's LdapLoginModule. Maybe there is a typo in the configuration file, ie. a superfluuous single quote before \"userProvider\". Or the configuration of the login module changed with a new JVM version...",
            "date": "2009-01-05T17:06:44.490+0000",
            "id": 0
        },
        {
            "author": "David Izatt",
            "body": "Thanks for your help.  I have followed your suggestions and verified that the configuration file looks consistent with Sun's documentation for their LdapLoginModule I found here:  http://java.sun.com/javase/6/docs/jre/api/security/jaas/spec/com/sun/security/auth/module/LdapLoginModule.html\nI am using a virtual machine and was also able to verify that the JVM version I have installed did not change between the two projects of different Jackrabbit versions.  I didn't see any typos and the pasted part of the configuration that I included looks ok to me.  Are their any other possibilities that may exist?   Thanks for your time.",
            "date": "2009-01-05T21:12:47.515+0000",
            "id": 1
        },
        {
            "author": "Jukka Zitting",
            "body": "It looks like this is a quite serious backwards compatibility problem in 1.5.0. The JCR-1462 change assumed that all <param/> elements refer to bean properties of the configured object, but this is actually not true for the LoginModule configuration element. As a quick fix we should probably disable the JCR-1462 validation of the LoginModule element.\n\nRaising priority to Critical and scheduling for 1.5.1.\n\n",
            "date": "2009-01-05T21:49:24.136+0000",
            "id": 2
        },
        {
            "author": "Alexander Klimetschek",
            "body": "> As a quick fix we should probably disable the JCR-1462 validation of the LoginModule element. \n\nYou are right. Didn't see the message coming actualy from the config code [1]. BTW, one should also fix the error message which misses the end of the old log message before the change:  + \"'; the setting is ignored.\"\n\nhttp://svn.apache.org/viewvc/jackrabbit/trunk/jackrabbit-core/src/main/java/org/apache/jackrabbit/core/config/BeanConfig.java?p2=%2Fjackrabbit%2Ftrunk%2Fjackrabbit-core%2Fsrc%2Fmain%2Fjava%2Forg%2Fapache%2Fjackrabbit%2Fcore%2Fconfig%2FBeanConfig.java&p1=%2Fjackrabbit%2Ftrunk%2Fjackrabbit-core%2Fsrc%2Fmain%2Fjava%2Forg%2Fapache%2Fjackrabbit%2Fcore%2Fconfig%2FBeanConfig.java&r1=640880&r2=640879&view=diff&pathrev=640880",
            "date": "2009-01-05T22:12:12.432+0000",
            "id": 3
        },
        {
            "author": "Thomas Mueller",
            "body": "What about adding a 'lenient' field to BeanConfig?\nThe LoginModule would enable lenient processing, meaning\nunknown settings are ignored. By default unknown settings\nwill still throw an exception. ",
            "date": "2009-01-06T08:45:09.674+0000",
            "id": 4
        },
        {
            "author": "Jukka Zitting",
            "body": "The attached patch implements a \"validate\" flag in BeanConfig (\"lenient\" would have required a negated if condition). It's true by default, but I'm explicitly setting it to false for all instances that can potentially have parameters that are not bean properties.",
            "date": "2009-01-06T10:53:59.430+0000",
            "id": 5
        },
        {
            "author": "Alexander Klimetschek",
            "body": "+1 for the patch",
            "date": "2009-01-06T11:22:36.349+0000",
            "id": 6
        },
        {
            "author": "Thomas Mueller",
            "body": "Javadocs: \"directly rough the\" should be \"directly through the\"\n\nIs disabling validation really required for SearchConfig? You wrote 'SearchIndex uses getParameters()' but I couldn't find it (maybe I am using the wrong versions, 1.4 and 1.6?)",
            "date": "2009-01-06T11:38:29.207+0000",
            "id": 7
        },
        {
            "author": "Jukka Zitting",
            "body": "Thanks for catching the typo.\n\nIt's actually in the SearchManager class, see line 224 [1].\n\n[1] http://fisheye6.atlassian.com/browse/jackrabbit/trunk/jackrabbit-core/src/main/java/org/apache/jackrabbit/core/SearchManager.java?r=688207#l224\n",
            "date": "2009-01-06T12:54:49.184+0000",
            "id": 8
        },
        {
            "author": "Jukka Zitting",
            "body": "Committed the patch (with updates suggested by Thomas) in revision 731934.",
            "date": "2009-01-06T13:13:51.634+0000",
            "id": 9
        },
        {
            "author": "Thomas Mueller",
            "body": "Thanks Jukka! I agree we shouldn't enable validation for the SearchIndex module in 1.5.1. I have opened a new bug, JCR-1922, to fix this in 1.6.",
            "date": "2009-01-06T13:44:55.447+0000",
            "id": 10
        },
        {
            "author": "David Izatt",
            "body": "Thanks for your help everyone.  Quick response!",
            "date": "2009-01-06T15:28:52.583+0000",
            "id": 11
        },
        {
            "author": "Jukka Zitting",
            "body": "Merged to the 1.5 branch in revision 731981.",
            "date": "2009-01-06T15:54:14.142+0000",
            "id": 12
        }
    ],
    "component": "jackrabbit-core, security",
    "description": "Upgrading Jackrabbit from 1.4.5 to 1.5 has created an LDAP exception.  The configuration file which has not changed (except for the adding the new SimpleSecurityManager as required) is the default with the following substituted for the LoginModule:\n\n        <LoginModule class=\"com.sun.security.auth.module.LdapLoginModule\">\n            <param name=\"userProvider\" value=\"ldap://localhost/ou=people,dc=example,dc=com\" />\n            <param name=\"userFilter\" value=\"(&amp;(uid={USERNAME})(objectClass=inetOrgPerson))\" />\n            <param name=\"authzIdentity\" value=\"{USERNAME}\" />\n            <param name=\"debug\" value=\"true\" />\n        </LoginModule>\n\nThis configuration worked correctly and I was able to authenticate properly with Jackrabbit 1.4.5\nThe same configuration with 1.5 throws the following exception:\n\njavax.jcr.LoginException: com.sun.security.auth.module.LdapLoginModule does not support 'userProvider: com.sun.security.auth.module.LdapLoginModule does not support 'userProvider: com.sun.security.auth.module.LdapLoginModule does not support 'userProvider\n        at org.apache.jackrabbit.core.RepositoryImpl.login(RepositoryImpl.java:1414)\n        at org.apache.jackrabbit.jca.JCAManagedConnectionFactory.openSession(JCAManagedConnectionFactory.java:140)\n        at org.apache.jackrabbit.jca.JCAManagedConnectionFactory.createManagedConnection(JCAManagedConnectionFactory.java:176)\n        at org.apache.jackrabbit.jca.JCAManagedConnectionFactory.createManagedConnection(JCAManagedConnectionFactory.java:168)\n        at com.sun.enterprise.resource.ConnectorAllocator.createResource(ConnectorAllocator.java:136)\n        at com.sun.enterprise.resource.AbstractResourcePool.createSingleResource(AbstractResourcePool.java:891)\n        at com.sun.enterprise.resource.AbstractResourcePool.createResourceAndAddToPool(AbstractResourcePool.java:1752)\n        at com.sun.enterprise.resource.AbstractResourcePool.createResources(AbstractResourcePool.java:917)\n        at com.sun.enterprise.resource.AbstractResourcePool.initPool(AbstractResourcePool.java:225)\n        at com.sun.enterprise.resource.AbstractResourcePool.internalGetResource(AbstractResourcePool.java:516)\n        at com.sun.enterprise.resource.AbstractResourcePool.getResource(AbstractResourcePool.java:443)\n        at com.sun.enterprise.resource.PoolManagerImpl.getResourceFromPool(PoolManagerImpl.java:248)\n        at com.sun.enterprise.resource.PoolManagerImpl.getResource(PoolManagerImpl.java:176)\n        at com.sun.enterprise.connectors.ConnectionManagerImpl.internalGetConnection(ConnectionManagerImpl.java:337)\n        at com.sun.enterprise.connectors.ConnectionManagerImpl.allocateConnection(ConnectionManagerImpl.java:189)\n        at com.sun.enterprise.connectors.ConnectionManagerImpl.allocateConnection(ConnectionManagerImpl.java:165)\n        at com.sun.enterprise.connectors.ConnectionManagerImpl.allocateConnection(ConnectionManagerImpl.java:158)\n        at org.apache.jackrabbit.jca.JCARepositoryHandle.login(JCARepositoryHandle.java:98)\n        at org.apache.jackrabbit.jca.JCARepositoryHandle.login(JCARepositoryHandle.java:89)\n        at org.apache.jackrabbit.jca.JCARepositoryHandle.login(JCARepositoryHandle.java:73)\n        at com.threesl.Sapphire.CradleJCR.login(CradleJCR.java:44)   \n\n try {\n            InitialContext ctx = new InitialContext();\n            repository = (Repository) ctx.lookup(\"jcr/repository\");\n            session = repository.login(credentials);\n        } catch (Exception e) {\n\n        at com.threesl.Sapphire.CradleWS.doLogin(CradleWS.java:68)\n        at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)\n        at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:39)\n        at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:25)\n        at java.lang.reflect.Method.invoke(Method.java:597)\n        at com.sun.jersey.impl.model.method.dispatch.EntityParamDispatchProvider$TypeOutInvoker._dispatch(EntityParamDispatchProvider.java:136)\n        at com.sun.jersey.impl.model.method.dispatch.ResourceJavaMethodDispatcher.dispatch(ResourceJavaMethodDispatcher.java:85)\n        at com.sun.jersey.impl.uri.rules.HttpMethodRule.accept(HttpMethodRule.java:123)\n        at com.sun.jersey.impl.uri.rules.RightHandPathRule.accept(RightHandPathRule.java:111)\n        at com.sun.jersey.impl.uri.rules.ResourceClassRule.accept(ResourceClassRule.java:71)\n        at com.sun.jersey.impl.uri.rules.RightHandPathRule.accept(RightHandPathRule.java:111)\n        at com.sun.jersey.impl.uri.rules.RootResourceClassesRule.accept(RootResourceClassesRule.java:63)\n        at com.sun.jersey.impl.application.WebApplicationImpl.handleRequest(WebApplicationImpl.java:722)\n        at com.sun.jersey.impl.application.WebApplicationImpl.handleRequest(WebApplicationImpl.java:692)\n        at com.sun.jersey.spi.container.servlet.ServletContainer.service(ServletContainer.java:344)\n        at javax.servlet.http.HttpServlet.service(HttpServlet.java:831)\n        at org.apache.catalina.core.ApplicationFilterChain.servletService(ApplicationFilterChain.java:411)\n        at org.apache.catalina.core.StandardWrapperValve.invoke(StandardWrapperValve.java:290)\n        at org.apache.catalina.core.StandardContextValve.invokeInternal(StandardContextValve.java:271)\n        at org.apache.catalina.core.StandardContextValve.invoke(StandardContextValve.java:202)\n        at org.apache.catalina.core.StandardPipeline.doInvoke(StandardPipeline.java:632)\n        at org.apache.catalina.core.StandardPipeline.doInvoke(StandardPipeline.java:577)\n        at com.sun.enterprise.web.WebPipeline.invoke(WebPipeline.java:94)\n        at org.apache.catalina.core.StandardHostValve.invoke(StandardHostValve.java:206)\n        at org.apache.catalina.core.StandardPipeline.doInvoke(StandardPipeline.java:632)\n        at org.apache.catalina.core.StandardPipeline.doInvoke(StandardPipeline.java:577)\n        at org.apache.catalina.core.StandardPipeline.invoke(StandardPipeline.java:571)\n        at org.apache.catalina.core.ContainerBase.invoke(ContainerBase.java:1080)\n        at org.apache.catalina.core.StandardEngineValve.invoke(StandardEngineValve.java:150)\n        at org.apache.catalina.core.StandardPipeline.doInvoke(StandardPipeline.java:632)\n        at org.apache.catalina.core.StandardPipeline.doInvoke(StandardPipeline.java:577)\n        at org.apache.catalina.core.StandardPipeline.invoke(StandardPipeline.java:571)\n        at org.apache.catalina.core.ContainerBase.invoke(ContainerBase.java:1080)\n        at org.apache.coyote.tomcat5.CoyoteAdapter.service(CoyoteAdapter.java:272)\n        at com.sun.enterprise.web.connector.grizzly.DefaultProcessorTask.invokeAdapter(DefaultProcessorTask.java:637)\n        at com.sun.enterprise.web.connector.grizzly.DefaultProcessorTask.doProcess(DefaultProcessorTask.java:568)\n        at com.sun.enterprise.web.connector.grizzly.DefaultProcessorTask.process(DefaultProcessorTask.java:813)\n        at com.sun.enterprise.web.connector.grizzly.DefaultReadTask.executeProcessorTask(DefaultReadTask.java:341)\n        at com.sun.enterprise.web.connector.grizzly.DefaultReadTask.doTask(DefaultReadTask.java:263)\n        at com.sun.enterprise.web.connector.grizzly.DefaultReadTask.doTask(DefaultReadTask.java:214)\n        at com.sun.enterprise.web.connector.grizzly.TaskBase.run(TaskBase.java:265)\n        at com.sun.enterprise.web.connector.grizzly.ssl.SSLWorkerThread.run(SSLWorkerThread.java:106)\nCaused by: javax.security.auth.login.LoginException: com.sun.security.auth.module.LdapLoginModule does not support 'userProvider\n        at org.apache.jackrabbit.core.security.authentication.LocalAuthContext.login(LocalAuthContext.java:68)\n        at org.apache.jackrabbit.core.RepositoryImpl.login(RepositoryImpl.java:1407)\n        ... 62 more\njavax.security.auth.login.LoginException: com.sun.security.auth.module.LdapLoginModule does not support 'userProvider\n        at org.apache.jackrabbit.core.security.authentication.LocalAuthContext.login(LocalAuthContext.java:68)\n        at org.apache.jackrabbit.core.RepositoryImpl.login(RepositoryImpl.java:1407)\n        at org.apache.jackrabbit.jca.JCAManagedConnectionFactory.openSession(JCAManagedConnectionFactory.java:140)\n        at org.apache.jackrabbit.jca.JCAManagedConnectionFactory.createManagedConnection(JCAManagedConnectionFactory.java:176)\n        at org.apache.jackrabbit.jca.JCAManagedConnectionFactory.createManagedConnection(JCAManagedConnectionFactory.java:168)\n        at com.sun.enterprise.resource.ConnectorAllocator.createResource(ConnectorAllocator.java:136)\n        at com.sun.enterprise.resource.AbstractResourcePool.createSingleResource(AbstractResourcePool.java:891)\n        at com.sun.enterprise.resource.AbstractResourcePool.createResourceAndAddToPool(AbstractResourcePool.java:1752)\n        at com.sun.enterprise.resource.AbstractResourcePool.createResources(AbstractResourcePool.java:917)\n        at com.sun.enterprise.resource.AbstractResourcePool.initPool(AbstractResourcePool.java:225)\n        at com.sun.enterprise.resource.AbstractResourcePool.internalGetResource(AbstractResourcePool.java:516)\n        at com.sun.enterprise.resource.AbstractResourcePool.getResource(AbstractResourcePool.java:443)\n        at com.sun.enterprise.resource.PoolManagerImpl.getResourceFromPool(PoolManagerImpl.java:248)\n        at com.sun.enterprise.resource.PoolManagerImpl.getResource(PoolManagerImpl.java:176)\n        at com.sun.enterprise.connectors.ConnectionManagerImpl.internalGetConnection(ConnectionManagerImpl.java:337)\n        at com.sun.enterprise.connectors.ConnectionManagerImpl.allocateConnection(ConnectionManagerImpl.java:189)\n        at com.sun.enterprise.connectors.ConnectionManagerImpl.allocateConnection(ConnectionManagerImpl.java:165)\n        at com.sun.enterprise.connectors.ConnectionManagerImpl.allocateConnection(ConnectionManagerImpl.java:158)\n        at org.apache.jackrabbit.jca.JCARepositoryHandle.login(JCARepositoryHandle.java:98)\n        at org.apache.jackrabbit.jca.JCARepositoryHandle.login(JCARepositoryHandle.java:89)\n        at org.apache.jackrabbit.jca.JCARepositoryHandle.login(JCARepositoryHandle.java:73)\n        at com.threesl.Sapphire.CradleJCR.login(CradleJCR.java:44)\n        at com.threesl.Sapphire.CradleWS.doLogin(CradleWS.java:68)\n        at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)\n        at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:39)\n        at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:25)\n        at java.lang.reflect.Method.invoke(Method.java:597)\n        at com.sun.jersey.impl.model.method.dispatch.EntityParamDispatchProvider$TypeOutInvoker._dispatch(EntityParamDispatchProvider.java:136)\n        at com.sun.jersey.impl.model.method.dispatch.ResourceJavaMethodDispatcher.dispatch(ResourceJavaMethodDispatcher.java:85)\n        at com.sun.jersey.impl.uri.rules.HttpMethodRule.accept(HttpMethodRule.java:123)\n        at com.sun.jersey.impl.uri.rules.RightHandPathRule.accept(RightHandPathRule.java:111)\n        at com.sun.jersey.impl.uri.rules.ResourceClassRule.accept(ResourceClassRule.java:71)\n        at com.sun.jersey.impl.uri.rules.RightHandPathRule.accept(RightHandPathRule.java:111)\n        at com.sun.jersey.impl.uri.rules.RootResourceClassesRule.accept(RootResourceClassesRule.java:63)\n        at com.sun.jersey.impl.application.WebApplicationImpl.handleRequest(WebApplicationImpl.java:722)\n        at com.sun.jersey.impl.application.WebApplicationImpl.handleRequest(WebApplicationImpl.java:692)\n        at com.sun.jersey.spi.container.servlet.ServletContainer.service(ServletContainer.java:344)\n        at javax.servlet.http.HttpServlet.service(HttpServlet.java:831)\n        at org.apache.catalina.core.ApplicationFilterChain.servletService(ApplicationFilterChain.java:411)\n        at org.apache.catalina.core.StandardWrapperValve.invoke(StandardWrapperValve.java:290)\n        at org.apache.catalina.core.StandardContextValve.invokeInternal(StandardContextValve.java:271)\n        at org.apache.catalina.core.StandardContextValve.invoke(StandardContextValve.java:202)\n        at org.apache.catalina.core.StandardPipeline.doInvoke(StandardPipeline.java:632)\n        at org.apache.catalina.core.StandardPipeline.doInvoke(StandardPipeline.java:577)\n        at com.sun.enterprise.web.WebPipeline.invoke(WebPipeline.java:94)\n        at org.apache.catalina.core.StandardHostValve.invoke(StandardHostValve.java:206)\n        at org.apache.catalina.core.StandardPipeline.doInvoke(StandardPipeline.java:632)\n        at org.apache.catalina.core.StandardPipeline.doInvoke(StandardPipeline.java:577)\n        at org.apache.catalina.core.StandardPipeline.invoke(StandardPipeline.java:571)\n        at org.apache.catalina.core.ContainerBase.invoke(ContainerBase.java:1080)\n        at org.apache.catalina.core.StandardEngineValve.invoke(StandardEngineValve.java:150)\n        at org.apache.catalina.core.StandardPipeline.doInvoke(StandardPipeline.java:632)\n        at org.apache.catalina.core.StandardPipeline.doInvoke(StandardPipeline.java:577)\n        at org.apache.catalina.core.StandardPipeline.invoke(StandardPipeline.java:571)\n        at org.apache.catalina.core.ContainerBase.invoke(ContainerBase.java:1080)\n        at org.apache.coyote.tomcat5.CoyoteAdapter.service(CoyoteAdapter.java:272)\n        at com.sun.enterprise.web.connector.grizzly.DefaultProcessorTask.invokeAdapter(DefaultProcessorTask.java:637)\n        at com.sun.enterprise.web.connector.grizzly.DefaultProcessorTask.doProcess(DefaultProcessorTask.java:568)\n        at com.sun.enterprise.web.connector.grizzly.DefaultProcessorTask.process(DefaultProcessorTask.java:813)\n        at com.sun.enterprise.web.connector.grizzly.DefaultReadTask.executeProcessorTask(DefaultReadTask.java:341)\n        at com.sun.enterprise.web.connector.grizzly.DefaultReadTask.doTask(DefaultReadTask.java:263)\n        at com.sun.enterprise.web.connector.grizzly.DefaultReadTask.doTask(DefaultReadTask.java:214)\n        at com.sun.enterprise.web.connector.grizzly.TaskBase.run(TaskBase.java:265)\n        at com.sun.enterprise.web.connector.grizzly.ssl.SSLWorkerThread.run(SSLWorkerThread.java:106)\nRAR5117 : Failed to obtain/create connection from connection pool [ jackrabbit-connection-pool ]. Reason : Failed to create session: com.sun.security.auth.module.LdapLoginModule does not support 'userProvider: com.sun.security.auth.module.LdapLoginModule does not support 'userProvider\n\n",
    "hasPatch": true,
    "hasScreenshot": false,
    "id": "JCR-1920",
    "issuetypeClassified": "BUG",
    "issuetypeTracker": "BUG",
    "priority": "Critical",
    "product": "JACKRABBIT",
    "project": "JACKRABBIT",
    "summary": "Custom LoginModule configurations broken in 1.5.0",
    "systemSpecification": true,
    "version": "1.5"
}