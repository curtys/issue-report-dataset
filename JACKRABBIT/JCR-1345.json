{
    "comments": [
        {
            "author": "Jim Cross",
            "body": "Just spotted the bug. In DavResourceImpl:\n\nstatusCode = (error instanceof RepositoryException)\n  ? new JcrDavException((RepositoryException)o).getErrorCode()\n  : DavServletResponse.SC_INTERNAL_SERVER_ERROR;\n\nshould be\n\nstatusCode = (error instanceof RepositoryException)\n  ? new JcrDavException((RepositoryException)error).getErrorCode()\n  : DavServletResponse.SC_INTERNAL_SERVER_ERROR;\n\nUnfortunately I can't contribute from work, but hopefully this will give you the chance to patch it quickly.\n\nThanks,\n\nJim",
            "date": "2008-01-25T10:50:54.237+0000",
            "id": 0
        },
        {
            "author": "angela",
            "body": "oh. thanks a lot!\n\ni will fix it immediately.\n\nbtw: as far as i know the DAV:auto-version property is present upon PROPFIND, but \nobvious PROPPATCH on it should only be allowed if the new value can be properly handled. This is currently not the case.\nTherefore either PROPPATCH should disallow modifying the property OR the resources should properly behave to a other value.\n\nIn any case the value of the DAV:auto-version  should be checked for validity.\nI will open another issue for that.",
            "date": "2008-01-25T11:31:16.112+0000",
            "id": 1
        },
        {
            "author": "angela",
            "body": "applied fix with rev. 615194  \n\ni didn't run litmus and didn't perform any extensive tests, but quickly modified props (one valid and one that fails) with DavExplorer. that seemed ok now.\n\nthanks again for finding the bug (and the resolution).\nangela\n",
            "date": "2008-01-25T12:02:53.273+0000",
            "id": 2
        },
        {
            "author": "Jim Cross",
            "body": "Thanks Angela\n\nI guess the reason there isn't a check for valid auto-version values is that auto-versioning isn't supported (according to the comment in VersionControlledResourceImpl). I just drove myself mad trying to figure out why a PROPPATCH on auto-version wasn't reflected when I reloaded the resource in DAV Explorer..until I found that comment in VersionControlledResourceImpl.initProperties()\n\nI might have a crack at implementing auto-versioning myself, as I need a high-performance solution, and making 3 calls to put a versioned resource every time will be too expensive.",
            "date": "2008-01-25T15:24:04.230+0000",
            "id": 3
        },
        {
            "author": "angela",
            "body": "i created an issue for the DAV:auto-versioning -> JCR-1348\n\n-> see there for further comments.",
            "date": "2008-01-25T16:01:52.920+0000",
            "id": 4
        },
        {
            "author": "Jukka Zitting",
            "body": "Merged to the 1.4 branch in revision 618604.",
            "date": "2008-02-05T10:37:09.761+0000",
            "id": 5
        }
    ],
    "component": "jackrabbit-jcr-server",
    "description": "When issuing PROPPATCH commands, a ClassCastException is raised.\n\ne.g. \n\nPROPPATCH /jackrabbit-webapp-1.4/repository/default/test/test_file_v.txt HTTP/1.1\nHost: localhost:9000\nConnection: TE\nTE: trailers, deflate, gzip, compress\nUser-Agent: UCI DAV Explorer/0.91 RPT-HTTPClient/0.3-3E\nTranslate: f\nAuthorization: Basic Y3Jvc3NqYTp0ZXN0\nAccept-Encoding: deflate, gzip, x-gzip, compress, x-compress\nContent-type: text/xml\nContent-length: 170\n\n<A:propertyupdate xmlns:A=\"DAV:\">\n<A:set>\n<A:prop>\n<A:auto-version>checkout-checkin</A:auto-version>\n</A:prop>\n</A:set>\n</A:propertyupdate>\n\n\nresults in\n\n\n\n24.01.2008 15:38:34 *ERROR* [Webdav]: Servlet.service() for servlet Webdav threw\n exception (StandardWrapperValve.java, line 257)\njava.lang.ClassCastException: org.apache.jackrabbit.webdav.property.DefaultDavPr\noperty\n        at org.apache.jackrabbit.webdav.simple.DavResourceImpl.alterProperties(D\navResourceImpl.java:456)\n        at org.apache.jackrabbit.webdav.server.AbstractWebdavServlet.doPropPatch\n(AbstractWebdavServlet.java:457)\n        at org.apache.jackrabbit.webdav.server.AbstractWebdavServlet.execute(Abs\ntractWebdavServlet.java:234)\n        at org.apache.jackrabbit.webdav.server.AbstractWebdavServlet.service(Abs\ntractWebdavServlet.java:192)\n        at javax.servlet.http.HttpServlet.service(HttpServlet.java:803)\n        at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(Appl\nicationFilterChain.java:269)\n        at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationF\nilterChain.java:188)\n        at org.apache.catalina.core.StandardWrapperValve.invoke(StandardWrapperV\nalve.java:210)\n        at org.apache.catalina.core.StandardContextValve.invoke(StandardContextV\nalve.java:174)\n        at org.apache.catalina.core.StandardHostValve.invoke(StandardHostValve.j\nava:127)\n        at org.apache.catalina.valves.ErrorReportValve.invoke(ErrorReportValve.j\nava:117)\n        at org.apache.catalina.core.StandardEngineValve.invoke(StandardEngineVal\nve.java:108)\n        at org.apache.catalina.connector.CoyoteAdapter.service(CoyoteAdapter.jav\na:151)\n        at org.apache.coyote.http11.Http11Processor.process(Http11Processor.java\n:870)\n        at org.apache.coyote.http11.Http11BaseProtocol$Http11ConnectionHandler.p\nrocessConnection(Http11BaseProtocol.java:665)\n        at org.apache.tomcat.util.net.PoolTcpEndpoint.processSocket(PoolTcpEndpo\nint.java:528)\n        at org.apache.tomcat.util.net.LeaderFollowerWorkerThread.runIt(LeaderFol\nlowerWorkerThread.java:81)\n        at org.apache.tomcat.util.threads.ThreadPool$ControlRunnable.run(ThreadP\nool.java:685)\n        at java.lang.Thread.run(Thread.java:595)\n24.01.2008 15:38:34 *ERROR* [Webdav]: Servlet.service() for servlet Webdav threw\n exception (SLF4JLocationAwareLog.java, line 174)\njava.lang.ClassCastException: org.apache.jackrabbit.webdav.property.DefaultDavPr\noperty\n        at org.apache.jackrabbit.webdav.simple.DavResourceImpl.alterProperties(D\navResourceImpl.java:456)\n        at org.apache.jackrabbit.webdav.server.AbstractWebdavServlet.doPropPatch\n(AbstractWebdavServlet.java:457)\n        at org.apache.jackrabbit.webdav.server.AbstractWebdavServlet.execute(Abs\ntractWebdavServlet.java:234)\n        at org.apache.jackrabbit.webdav.server.AbstractWebdavServlet.service(Abs\ntractWebdavServlet.java:192)\n        at javax.servlet.http.HttpServlet.service(HttpServlet.java:803)\n        at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(Appl\nicationFilterChain.java:269)\n        at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationF\nilterChain.java:188)\n        at org.apache.catalina.core.StandardWrapperValve.invoke(StandardWrapperV\nalve.java:210)\n        at org.apache.catalina.core.StandardContextValve.invoke(StandardContextV\nalve.java:174)\n        at org.apache.catalina.core.StandardHostValve.invoke(StandardHostValve.j\nava:127)\n        at org.apache.catalina.valves.ErrorReportValve.invoke(ErrorReportValve.j\nava:117)\n        at org.apache.catalina.core.StandardEngineValve.invoke(StandardEngineVal\nve.java:108)\n        at org.apache.catalina.connector.CoyoteAdapter.service(CoyoteAdapter.jav\na:151)\n        at org.apache.coyote.http11.Http11Processor.process(Http11Processor.java\n:870)\n        at org.apache.coyote.http11.Http11BaseProtocol$Http11ConnectionHandler.p\nrocessConnection(Http11BaseProtocol.java:665)\n        at org.apache.tomcat.util.net.PoolTcpEndpoint.processSocket(PoolTcpEndpo\nint.java:528)\n        at org.apache.tomcat.util.net.LeaderFollowerWorkerThread.runIt(LeaderFol\nlowerWorkerThread.java:81)\n        at org.apache.tomcat.util.threads.ThreadPool$ControlRunnable.run(ThreadP\nool.java:685)\n        at java.lang.Thread.run(Thread.java:595)\n24.01.2008 15:53:54 *ERROR* [Webdav]: Servlet.service() for servlet Webdav threw\n exception (StandardWrapperValve.java, line 257)\njava.lang.ClassCastException: org.apache.jackrabbit.webdav.property.DefaultDavPr\noperty\n        at org.apache.jackrabbit.webdav.simple.DavResourceImpl.alterProperties(D\navResourceImpl.java:456)\n        at org.apache.jackrabbit.webdav.server.AbstractWebdavServlet.doPropPatch\n(AbstractWebdavServlet.java:457)\n        at org.apache.jackrabbit.webdav.server.AbstractWebdavServlet.execute(Abs\ntractWebdavServlet.java:234)\n        at org.apache.jackrabbit.webdav.server.AbstractWebdavServlet.service(Abs\ntractWebdavServlet.java:192)\n        at javax.servlet.http.HttpServlet.service(HttpServlet.java:803)\n        at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(Appl\nicationFilterChain.java:269)\n        at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationF\nilterChain.java:188)\n        at org.apache.catalina.core.StandardWrapperValve.invoke(StandardWrapperV\nalve.java:210)\n        at org.apache.catalina.core.StandardContextValve.invoke(StandardContextV\nalve.java:174)\n        at org.apache.catalina.core.StandardHostValve.invoke(StandardHostValve.j\nava:127)\n        at org.apache.catalina.valves.ErrorReportValve.invoke(ErrorReportValve.j\nava:117)\n        at org.apache.catalina.core.StandardEngineValve.invoke(StandardEngineVal\nve.java:108)\n        at org.apache.catalina.connector.CoyoteAdapter.service(CoyoteAdapter.jav\na:151)\n        at org.apache.coyote.http11.Http11Processor.process(Http11Processor.java\n:870)\n        at org.apache.coyote.http11.Http11BaseProtocol$Http11ConnectionHandler.p\nrocessConnection(Http11BaseProtocol.java:665)\n        at org.apache.tomcat.util.net.PoolTcpEndpoint.processSocket(PoolTcpEndpo\nint.java:528)\n        at org.apache.tomcat.util.net.LeaderFollowerWorkerThread.runIt(LeaderFol\nlowerWorkerThread.java:81)\n        at org.apache.tomcat.util.threads.ThreadPool$ControlRunnable.run(ThreadP\nool.java:685)\n        at java.lang.Thread.run(Thread.java:595)\n24.01.2008 15:53:54 *ERROR* [Webdav]: Servlet.service() for servlet Webdav threw\n exception (SLF4JLocationAwareLog.java, line 174)\njava.lang.ClassCastException: org.apache.jackrabbit.webdav.property.DefaultDavPr\noperty\n        at org.apache.jackrabbit.webdav.simple.DavResourceImpl.alterProperties(D\navResourceImpl.java:456)\n        at org.apache.jackrabbit.webdav.server.AbstractWebdavServlet.doPropPatch\n(AbstractWebdavServlet.java:457)\n        at org.apache.jackrabbit.webdav.server.AbstractWebdavServlet.execute(Abs\ntractWebdavServlet.java:234)\n        at org.apache.jackrabbit.webdav.server.AbstractWebdavServlet.service(Abs\ntractWebdavServlet.java:192)\n        at javax.servlet.http.HttpServlet.service(HttpServlet.java:803)\n        at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(Appl\nicationFilterChain.java:269)\n        at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationF\nilterChain.java:188)\n        at org.apache.catalina.core.StandardWrapperValve.invoke(StandardWrapperV\nalve.java:210)\n        at org.apache.catalina.core.StandardContextValve.invoke(StandardContextV\nalve.java:174)\n        at org.apache.catalina.core.StandardHostValve.invoke(StandardHostValve.j\nava:127)\n        at org.apache.catalina.valves.ErrorReportValve.invoke(ErrorReportValve.j\nava:117)\n        at org.apache.catalina.core.StandardEngineValve.invoke(StandardEngineVal\nve.java:108)\n        at org.apache.catalina.connector.CoyoteAdapter.service(CoyoteAdapter.jav\na:151)\n        at org.apache.coyote.http11.Http11Processor.process(Http11Processor.java\n:870)\n        at org.apache.coyote.http11.Http11BaseProtocol$Http11ConnectionHandler.p\nrocessConnection(Http11BaseProtocol.java:665)\n        at org.apache.tomcat.util.net.PoolTcpEndpoint.processSocket(PoolTcpEndpo\nint.java:528)\n        at org.apache.tomcat.util.net.LeaderFollowerWorkerThread.runIt(LeaderFol\nlowerWorkerThread.java:81)\n        at org.apache.tomcat.util.threads.ThreadPool$ControlRunnable.run(ThreadP\nool.java:685)\n        at java.lang.Thread.run(Thread.java:595) ",
    "hasPatch": false,
    "hasScreenshot": false,
    "id": "JCR-1345",
    "issuetypeClassified": "BUG",
    "issuetypeTracker": "BUG",
    "priority": "Major",
    "product": "JACKRABBIT",
    "project": "JACKRABBIT",
    "summary": "ClassCastException when updating properties using WebDAV",
    "systemSpecification": true,
    "version": "1.4"
}