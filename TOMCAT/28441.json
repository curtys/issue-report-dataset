{
    "comments": [
        {
            "author": null,
            "body": "DataSourceRealm is not supported in admin webapp currently.  Only\nUserDatabaseRealm, JNDIRealm, JDBCRealm, and MemoryRealm are supported.  I'll go\nahead and add DataSourceRealm to admin, hence changing it to enhancement.\nRegarding context datasources, it works fine for me.  Can you attach the full\nserver.xml?  Probably something wrong with your DataSource definition.",
            "date": "20040416T22:48:51",
            "id": 0
        },
        {
            "author": null,
            "body": "Full server.xml\n\n<Server port=\"8005\" shutdown=\"SHUTDOWN\" debug=\"0\">\n\t<Listener className=\"org.apache.catalina.mbeans.ServerLifecycleListener\"\ndebug=\"0\"/>\n\t<Listener\nclassName=\"org.apache.catalina.mbeans.GlobalResourcesLifecycleListener\" debug=\"0\"/>\n\t<!-- Global JNDI resources -->\n\t<GlobalNamingResources>\n\t\t<!-- Editable user database that can also be used by\n         UserDatabaseRealm to authenticate users -->\n\t\t<Resource name=\"UserDatabase\" auth=\"Container\"\ntype=\"org.apache.catalina.UserDatabase\" description=\"User database that can be\nupdated and saved\">\n    </Resource>\n\t\t<ResourceParams name=\"UserDatabase\">\n\t\t\t<parameter>\n\t\t\t\t<name>factory</name>\n\t\t\t\t<value>org.apache.catalina.users.MemoryUserDatabaseFactory</value>\n\t\t\t</parameter>\n\t\t\t<parameter>\n\t\t\t\t<name>pathname</name>\n\t\t\t\t<value>conf/tomcat-users.xml</value>\n\t\t\t</parameter>\n\t\t</ResourceParams>\n\t\t<!-- mysql database -->\n\t\t<Resource name=\"jdbc/accountingDB\" auth=\"Container\" type=\"javax.sql.DataSource\"/>\n\t\t<ResourceParams name=\"jdbc/accountingDB\">\n\t\t\t<parameter>\n\t\t\t\t<name>factory</name>\n\t\t\t\t<value>org.apache.commons.dbcp.BasicDataSourceFactory</value>\n\t\t\t</parameter>\n\t\t\t<parameter>\n\t\t\t\t<name>dataSourceName</name>\n\t\t\t\t<value>java:comp/env/jdbc/accountingDB</value>\n\t\t\t</parameter>\n\t\t\t<parameter>\n\t\t\t\t<name>defaultAutoCommit</name>\n\t\t\t\t<value>false</value>\n\t\t\t</parameter>\n\t\t\t<parameter>\n\t\t\t\t<name>maxActive</name>\n\t\t\t\t<value>100</value>\n\t\t\t</parameter>\n\t\t\t<parameter>\n\t\t\t\t<name>maxIdle</name>\n\t\t\t\t<value>30</value>\n\t\t\t</parameter>\n\t\t\t<parameter>\n\t\t\t\t<name>maxWait</name>\n\t\t\t\t<value>10000</value>\n\t\t\t</parameter>\n\t\t\t<!-- MySQL dB username and password for dB connections  -->\n\t\t\t<parameter>\n\t\t\t\t<name>username</name>\n\t\t\t\t<value>dummy</value>\n\t\t\t</parameter>\n\t\t\t<parameter>\n\t\t\t\t<name>password</name>\n\t\t\t\t<value>dummy</value>\n\t\t\t</parameter>\n\t\t\t<!-- Class name for the official MySQL Connector/J driver -->\n\t\t\t<parameter>\n\t\t\t\t<name>driverClassName</name>\n\t\t\t\t<value>com.mysql.jdbc.Driver</value>\n\t\t\t</parameter>\n\t\t\t<parameter>\n\t\t\t\t<name>url</name>\n\t\t\t\t<value>jdbc:mysql://localhost:3306/accounting?autoReconnect=true</value>\n\t\t\t</parameter>\n\t\t</ResourceParams>\n\t</GlobalNamingResources>\n\t<!-- Define the Tomcat Stand-Alone Service -->\n\t<Service name=\"Catalina\">\n\t\t<!-- Define a non-SSL Coyote HTTP/1.1 Connector on port 8080 -->\n\t\t<Connector port=\"80\" maxThreads=\"150\" minSpareThreads=\"25\"\nmaxSpareThreads=\"75\" enableLookups=\"false\" redirectPort=\"8443\" acceptCount=\"100\"\ndebug=\"0\" connectionTimeout=\"20000\" disableUploadTimeout=\"true\"/>\n\t\t<!-- Define a Coyote/JK2 AJP 1.3 Connector on port 8009 -->\n\t\t<Connector port=\"8009\" enableLookups=\"false\" redirectPort=\"8443\" debug=\"0\"\nprotocol=\"AJP/1.3\"/>\n\t\t<!-- Define the top level container in our container hierarchy -->\n\t\t<Engine name=\"Catalina\" defaultHost=\"localhost\" debug=\"0\">\n\t\t\t<!-- Global logger unless overridden at lower levels -->\n\t\t\t<Logger className=\"org.apache.catalina.logger.FileLogger\"\nprefix=\"catalina_log.\" suffix=\".txt\" timestamp=\"true\"/>\n\t\t\t<Realm className=\"org.apache.catalina.realm.UserDatabaseRealm\" debug=\"0\"\nresourceName=\"UserDatabase\"/>\n\t\t\t<Host name=\"localhost\" debug=\"0\" appBase=\"webapps\" unpackWARs=\"true\"\nautoDeploy=\"true\" xmlValidation=\"false\" xmlNamespaceAware=\"false\">\n\t\t\t\t<!-- PB -->\n\t\t\t\t<Valve className=\"org.apache.catalina.valves.AccessLogValve\"\ndirectory=\"logs\" prefix=\"localhost_access_log.\" suffix=\".txt\" pattern=\"common\"\nresolveHosts=\"false\"/>\n\t\t\t\t<!-- PB -->\n\t\t\t\t<Logger className=\"org.apache.catalina.logger.FileLogger\" directory=\"logs\"\nprefix=\"localhost_log.\" suffix=\".txt\" timestamp=\"true\"/>\n\t\t\t\t<!-- Tomcat Root Context -->\n\t\t\t\t<Context path=\"\" docBase=\"ROOT\" debug=\"0\"/>\n\t\t\t\t<Context path=\"/accounting\" docbase=\"accounting\">\n\t\t\t\t\t<Realm className=\"org.apache.catalina.realm.DataSourceRealm\" debug=\"99\"\ndataSourceName=\"jdbc/accountingDB\" digest=\"md5\" userTable=\"employee\"\nuserNameCol=\"employee_id\" userCredCol=\"password\" userRoleTable=\"role\"\nroleNameCol=\"role\"/>\n\t\t\t\t\t<Logger className=\"org.apache.catalina.logger.FileLogger\" directory=\"logs\"\nprefix=\"accounting.log\" suffix=\".txt\" timestamp=\"true\"/>\n\t\t\t\t</Context>\n\t\t\t</Host>\n\t\t</Engine>\n\t</Service>\n</Server>",
            "date": "20040417T07:30:21",
            "id": 1
        },
        {
            "author": null,
            "body": "Added DataSourceRealm support in admin.  The fix is in cvs and should be\navailable in the next release.",
            "date": "20040419T21:54:36",
            "id": 2
        }
    ],
    "component": "Webapps:Administration",
    "description": "I have a context called \"accounting\" with the following entry in server.xml:\n\n<Context path=\"/accounting\" docbase=\"accounting\">\n<Realm className=\"org.apache.catalina.realm.DataSourceRealm\" debug=\"99\"   \ndataSourceName=\"jdbc/accountingDB\" digest=\"md5\" userTable=\"employee\"\nuserNameCol=\"employee_id\" userCredCol=\"password\" userRoleTable=\"role\"\nroleNameCol=\"role\"/>\n<Logger className=\"org.apache.catalina.logger.FileLogger\" directory=\"logs\"\nprefix=\"accounting.log\" suffix=\".txt\" timestamp=\"true\"/>\n</Context>\n\nThe entire application works well. But if i try to use the Tomcat Administrator \nfor editing the DataSources or Realms of this context i get an HTTP 500 error.\nThe \"jdbc/accountingDB\" ressource is defined in GlobalNamingResources. Editing\nthis works well.\n\nThe errors are: For editing the contexts DataSources: \n\njavax.servlet.ServletException: Exception retrieving attribute 'driverClassName'\n\torg.apache.jasper.runtime.PageContextImpl.doHandlePageException(PageContextImpl.java:867)\n\torg.apache.jasper.runtime.PageContextImpl.handlePageException(PageContextImpl.java:800)\n\tadmin.resources.listDataSources_jsp._jspService(listDataSources_jsp.java:429)\n\torg.apache.jasper.runtime.HttpJspBase.service(HttpJspBase.java:133)\n\tjavax.servlet.http.HttpServlet.service(HttpServlet.java:856)\n\torg.apache.struts.action.RequestProcessor.doForward(RequestProcessor.java:1069)\n\torg.apache.struts.action.RequestProcessor.processForwardConfig(RequestProcessor.java:455)\n\torg.apache.struts.action.RequestProcessor.process(RequestProcessor.java:279)\n\torg.apache.struts.action.ActionServlet.process(ActionServlet.java:1482)\n\torg.apache.struts.action.ActionServlet.doGet(ActionServlet.java:507)\n\tjavax.servlet.http.HttpServlet.service(HttpServlet.java:743)\n\tjavax.servlet.http.HttpServlet.service(HttpServlet.java:856)\n\torg.apache.struts.action.RequestProcessor.doForward(RequestProcessor.java:1069)\n\torg.apache.struts.action.RequestProcessor.processForwardConfig(RequestProcessor.java:455)\n\torg.apache.struts.action.RequestProcessor.process(RequestProcessor.java:279)\n\torg.apache.struts.action.ActionServlet.process(ActionServlet.java:1482)\n\torg.apache.struts.action.ActionServlet.doGet(ActionServlet.java:507)\n\tjavax.servlet.http.HttpServlet.service(HttpServlet.java:743)\n\tjavax.servlet.http.HttpServlet.service(HttpServlet.java:856)\n\n\nFor editing the contexts realms: \n\nHTTP Status 500 - Error retrieving attribute className\n\ntype Status report\n\nmessage Error retrieving attribute className\n\ndescription The server encountered an internal error (Error retrieving attribute\nclassName) that prevented it from fulfilling this request.\nApache Tomcat/5.0.18",
    "hasPatch": false,
    "hasScreenshot": false,
    "id": "28441",
    "issuetypeClassified": "RFE",
    "issuetypeTracker": "RFE",
    "priority": "P3 enhancement",
    "product": "Tomcat 5",
    "project": "TOMCAT",
    "summary": "HTTP 500 editing Context",
    "systemSpecification": true,
    "version": "5.0.18"
}