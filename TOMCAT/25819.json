{
    "comments": [
        {
            "author": null,
            "body": "For now, the security manager support in TC 5 has been developed and tested with\nthe HTTP connector. The AJP connector may need additional permissions to work\nfor the time being (volunteers needed to add the missing PAs).",
            "date": "20031231T17:36:33",
            "id": 0
        },
        {
            "author": null,
            "body": "A missing doPrivileged block is missing and the real exception is hidden for a\nreason I can't explain (I don't know how jk works...I will take a look). Just\nedit your catalina.properties and clean the following two properties:\n\npackage.access=\npackage.definition=\n\nor just remove org.apache.tomcat. \n\nIt should work.\n\n-- Jeanfrancois",
            "date": "20040105T15:09:40",
            "id": 1
        },
        {
            "author": null,
            "body": "Based on the description of the bug, I believe that the patch I've checked in \nwill fix the problem.  However, it will be a couple of days before I can free \nup a server to test Tomcat 5/Apache, so I can't really test it.  \n\nI'd appreciate it if someone could test the Nightly so I could know if I could \nmark this as FIXED.",
            "date": "20040106T04:41:50",
            "id": 2
        },
        {
            "author": null,
            "body": "I got a chance to take-down one of my servers sooner than I thought :).\n\nThis is fixed now in the CVS, and will appear in 5.0.17.",
            "date": "20040107T05:36:51",
            "id": 3
        }
    ],
    "component": "Connector:Coyote",
    "description": "Exception on first http request. (Low priority)\n    If I push the \"reload button\" the html page is OK.\n    If I send more request this Exception never happen.\n    \n    In attachment:\n    1) Stack trace\n    2) Piece on source in stack trace\n\"it.rgi.webapp.admin.htmlwriter.HtmlWriter.printConclusione(HtmlWriter.java:194)\"\n    3) My catalina.policy (Enabled!)\n\n    thank you,\n    bye.\n\n\n############################################################################################################\n############################################################################################################\n\njava.lang.NoClassDefFoundError: org/apache/tomcat/util/buf/C2BConverter\n\tat org.apache.jk.server.JkCoyoteHandler.appendHead(JkCoyoteHandler.java:333)\n\tat org.apache.jk.server.JkCoyoteHandler.action(JkCoyoteHandler.java:402)\n\tat org.apache.coyote.Response.action(Response.java:226)\n\tat org.apache.coyote.Response.sendHeaders(Response.java:418)\n\tat org.apache.jk.server.JkCoyoteHandler.doWrite(JkCoyoteHandler.java:240)\n\tat org.apache.coyote.Response.doWrite(Response.java:586)\n\tat org.apache.coyote.tomcat5.OutputBuffer.realWriteBytes(OutputBuffer.java:405)\n\tat org.apache.tomcat.util.buf.ByteChunk.flushBuffer(ByteChunk.java:428)\n\tat org.apache.tomcat.util.buf.ByteChunk.append(ByteChunk.java:348)\n\tat org.apache.coyote.tomcat5.OutputBuffer.writeBytes(OutputBuffer.java:438)\n\tat org.apache.coyote.tomcat5.OutputBuffer.write(OutputBuffer.java:425)\n\tat org.apache.coyote.tomcat5.CoyoteOutputStream.write(CoyoteOutputStream.java:108)\n\tat java.io.PrintStream.write(Unknown Source)\n\tat sun.nio.cs.StreamEncoder$CharsetSE.writeBytes(Unknown Source)\n\tat sun.nio.cs.StreamEncoder$CharsetSE.implFlushBuffer(Unknown Source)\n\tat sun.nio.cs.StreamEncoder.flushBuffer(Unknown Source)\n\tat java.io.OutputStreamWriter.flushBuffer(Unknown Source)\n\tat java.io.PrintStream.write(Unknown Source)\n\tat java.io.PrintStream.print(Unknown Source)\n\tat java.io.PrintStream.println(Unknown Source)\n\tat it.rgi.webapp.admin.htmlwriter.HtmlWriter.printConclusione(HtmlWriter.java:194)\n\tat it.rgi.webapp.admin.utility.RgiWebAdminLogin.doLogout(RgiWebAdminLogin.java:231)\n\tat\nit.rgi.webapp.admin.utility.RgiWebAdminLogin.testIfAuthenticationRequiredAdSendLoginPage(RgiWebAdminLogin.java:152)\n\tat it.rgi.webapp.admin.ServletAdmin.doGet(ServletAdmin.java:109)\n\tat javax.servlet.http.HttpServlet.service(HttpServlet.java:743)\n\tat javax.servlet.http.HttpServlet.service(HttpServlet.java:856)\n\tat sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)\n\tat sun.reflect.NativeMethodAccessorImpl.invoke(Unknown Source)\n\tat sun.reflect.DelegatingMethodAccessorImpl.invoke(Unknown Source)\n\tat java.lang.reflect.Method.invoke(Unknown Source)\n\tat org.apache.catalina.security.SecurityUtil$1.run(SecurityUtil.java:284)\n\tat java.security.AccessController.doPrivileged(Native Method)\n\tat javax.security.auth.Subject.doAsPrivileged(Unknown Source)\n\tat org.apache.catalina.security.SecurityUtil.execute(SecurityUtil.java:306)\n\tat org.apache.catalina.security.SecurityUtil.doAsPrivilege(SecurityUtil.java:200)\n\tat\norg.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:278)\n\tat\norg.apache.catalina.core.ApplicationFilterChain.access$000(ApplicationFilterChain.java:97)\n\tat\norg.apache.catalina.core.ApplicationFilterChain$1.run(ApplicationFilterChain.java:187)\n\tat java.security.AccessController.doPrivileged(Native Method)\n\tat\norg.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:183)\n\tat\norg.apache.catalina.core.StandardWrapperValve.invoke(StandardWrapperValve.java:256)\n\tat\norg.apache.catalina.core.StandardValveContext.invokeNext(StandardValveContext.java:151)\n\tat org.apache.catalina.core.StandardPipeline.invoke(StandardPipeline.java:564)\n\tat\norg.apache.catalina.core.StandardContextValve.invokeInternal(StandardContextValve.java:245)\n\tat\norg.apache.catalina.core.StandardContextValve.invoke(StandardContextValve.java:199)\n\tat\norg.apache.catalina.core.StandardValveContext.invokeNext(StandardValveContext.java:151)\n\tat org.apache.catalina.core.StandardPipeline.invoke(StandardPipeline.java:564)\n\tat org.apache.catalina.core.StandardHostValve.invoke(StandardHostValve.java:195)\n\tat\norg.apache.catalina.core.StandardValveContext.invokeNext(StandardValveContext.java:151)\n\tat org.apache.catalina.valves.ErrorReportValve.invoke(ErrorReportValve.java:164)\n\tat\norg.apache.catalina.core.StandardValveContext.invokeNext(StandardValveContext.java:149)\n\tat org.apache.catalina.core.StandardPipeline.invoke(StandardPipeline.java:564)\n\tat\norg.apache.catalina.core.StandardEngineValve.invoke(StandardEngineValve.java:156)\n\tat\norg.apache.catalina.core.StandardValveContext.invokeNext(StandardValveContext.java:151)\n\tat org.apache.catalina.core.StandardPipeline.invoke(StandardPipeline.java:564)\n\tat org.apache.catalina.core.ContainerBase.invoke(ContainerBase.java:972)\n\tat org.apache.coyote.tomcat5.CoyoteAdapter.service(CoyoteAdapter.java:211)\n\tat org.apache.jk.server.JkCoyoteHandler.invoke(JkCoyoteHandler.java:309)\n\tat org.apache.jk.common.HandlerRequest.invoke(HandlerRequest.java:387)\n\tat org.apache.jk.common.ChannelSocket.invoke(ChannelSocket.java:673)\n\tat org.apache.jk.common.ChannelSocket.processConnection(ChannelSocket.java:615)\n\tat org.apache.jk.common.SocketConnection.runIt(ChannelSocket.java:786)\n\tat\norg.apache.tomcat.util.threads.ThreadPool$ControlRunnable.run(ThreadPool.java:677)\n\tat java.lang.Thread.run(Unknown Source)\n\n\n\n############################################################################################################\n############################################################################################################\n\npackage it.rgi.webapp.admin.htmlwriter;\n\n ......\n\npublic class HtmlWriter {\n\npublic static void printConclusione(...) throws IOException {\n    final PrintStream out = new PrintStream(response.getOutputStream());\n    ....\n    out.println(\"<TR><TD nowrap width=\\\"100%\\\"><Font \"+FSTYLE_NORMAL+\">\"+CR);\n/*LINE 194 */ out.println(\"&nbsp; <A\nHREF=\\\"javascript:window.resizeTo(800,720);\\\"><IMG\nsrc=\\\"\"+RgiIcon.URLNAME+\"?duke\\\" ALIGN=\\\"bottom\\\" BORDER=0 ALT=\\\"Resize browser\nto 800x720 pixel.\\\"></A> 100% pure Java technology.\");\n    out.println(\"&nbsp; Copyright \u00a9 2001 <B>RGI SpA</B>\");\n    ....\n    } // printConclusione\n    \n.......\n\n############################################################################################################\n############################################################################################################\n\n// ============================================================================\n// catalina.corepolicy - Security Policy Permissions for Tomcat 5\n//\n// This file contains a default set of security policies to be enforced (by the\n// JVM) when Catalina is executed with the \"-security\" option.  In addition\n// to the permissions granted here, the following additional permissions are\n// granted to the codebase specific to each web application:\n//\n// * Read access to the document root directory\n//\n// $Id: catalina.policy,v 1.10 2003/09/10 18:47:18 remm Exp $\n// ============================================================================\n\n\n// ========== SYSTEM CODE PERMISSIONS =========================================\n\n\n// These permissions apply to javac\ngrant codeBase \"file:${java.home}/lib/-\" {\n        permission java.security.AllPermission;\n};\n\n// These permissions apply to all shared system extensions\ngrant codeBase \"file:${java.home}/jre/lib/ext/-\" {\n        permission java.security.AllPermission;\n};\n\n// These permissions apply to javac when ${java.home] points at $JAVA_HOME/jre\ngrant codeBase \"file:${java.home}/../lib/-\" {\n        permission java.security.AllPermission;\n};\n\n// These permissions apply to all shared system extensions when\n// ${java.home} points at $JAVA_HOME/jre\ngrant codeBase \"file:${java.home}/lib/ext/-\" {\n        permission java.security.AllPermission;\n};\n\n\n// ========== CATALINA CODE PERMISSIONS =======================================\n\n\n// These permissions apply to the launcher code\ngrant codeBase \"file:${catalina.home}/bin/commons-launcher.jar\" {\n        permission java.security.AllPermission;\n};\n\n// These permissions apply to the daemon code\ngrant codeBase \"file:${catalina.home}/bin/commons-daemon.jar\" {\n        permission java.security.AllPermission;\n};\n\n// These permissions apply to the commons-logging API\ngrant codeBase \"file:${catalina.home}/bin/commons-logging-api.jar\" {\n        permission java.security.AllPermission;\n};\n\n// These permissions apply to the server startup code\ngrant codeBase \"file:${catalina.home}/bin/bootstrap.jar\" {\n        permission java.security.AllPermission;\n};\n\n// These permissions apply to the servlet API classes\n// and those that are shared across all class loaders\n// located in the \"common\" directory\ngrant codeBase \"file:${catalina.home}/common/-\" {\n        permission java.security.AllPermission;\n};\n\n// These permissions apply to the container's core code, plus any additional\n// libraries installed in the \"server\" directory\ngrant codeBase \"file:${catalina.home}/server/-\" {\n        permission java.security.AllPermission;\n};\n\n// ========== WEB APPLICATION PERMISSIONS =====================================\n\n\n// These permissions are granted by default to all web applications\n// In addition, a web application will be given a read FilePermission\n// and JndiPermission for all files and directories in its document root.\ngrant { \n    // Required for JNDI lookup of named JDBC DataSource's and\n    // javamail named MimePart DataSource used to send mail\n    permission java.util.PropertyPermission \"java.home\", \"read\";\n    permission java.util.PropertyPermission \"java.naming.*\", \"read\";\n    permission java.util.PropertyPermission \"javax.sql.*\", \"read\";\n\n    // OS Specific properties to allow read access\n    permission java.util.PropertyPermission \"os.name\", \"read\";\n    permission java.util.PropertyPermission \"os.version\", \"read\";\n    permission java.util.PropertyPermission \"os.arch\", \"read\";\n    permission java.util.PropertyPermission \"file.separator\", \"read\";\n    permission java.util.PropertyPermission \"path.separator\", \"read\";\n    permission java.util.PropertyPermission \"line.separator\", \"read\";\n\n    // JVM properties to allow read access\n    permission java.util.PropertyPermission \"java.version\", \"read\";\n    permission java.util.PropertyPermission \"java.vendor\", \"read\";\n    permission java.util.PropertyPermission \"java.vendor.url\", \"read\";\n    permission java.util.PropertyPermission \"java.class.version\", \"read\";\n\tpermission java.util.PropertyPermission \"java.specification.version\", \"read\";\n\tpermission java.util.PropertyPermission \"java.specification.vendor\", \"read\";\n\tpermission java.util.PropertyPermission \"java.specification.name\", \"read\";\n\n\tpermission java.util.PropertyPermission \"java.vm.specification.version\", \"read\";\n\tpermission java.util.PropertyPermission \"java.vm.specification.vendor\", \"read\";\n\tpermission java.util.PropertyPermission \"java.vm.specification.name\", \"read\";\n\tpermission java.util.PropertyPermission \"java.vm.version\", \"read\";\n\tpermission java.util.PropertyPermission \"java.vm.vendor\", \"read\";\n\tpermission java.util.PropertyPermission \"java.vm.name\", \"read\";\n\n    // Required for OpenJMX\n    permission java.lang.RuntimePermission \"getAttribute\";\n\n\t// Allow read of JAXP compliant XML parser debug\n\tpermission java.util.PropertyPermission \"jaxp.debug\", \"read\";\n\n    // Precompiled JSPs need access to this package.\n    permission java.lang.RuntimePermission\n\"accessClassInPackage.org.apache.jasper.runtime\";\n    permission java.lang.RuntimePermission\n\"accessClassInPackage.org.apache.jasper.runtime.*\";\n    \n};\n\n\n// You can assign additional permissions to particular web applications by\n// adding additional \"grant\" entries here, based on the code base for that\n// application, /WEB-INF/classes/, or /WEB-INF/lib/ jar files.\n//\n// Different permissions can be granted to JSP pages, classes loaded from\n// the /WEB-INF/classes/ directory, all jar files in the /WEB-INF/lib/\n// directory, or even to individual jar files in the /WEB-INF/lib/ directory.\n//\n// For instance, assume that the standard \"examples\" application\n// included a JDBC driver that needed to establish a network connection to the\n// corresponding database and used the scrape taglib to get the weather from\n// the NOAA web server.  You might create a \"grant\" entries like this:\n//\n// The permissions granted to the context root directory apply to JSP pages.\n// grant codeBase \"file:${catalina.home}/webapps/examples/-\" {\n//      permission java.net.SocketPermission \"dbhost.mycompany.com:5432\", \"connect\";\n//      permission java.net.SocketPermission \"*.noaa.gov:80\", \"connect\";\n// };\n//\n// The permissions granted to the context WEB-INF/classes directory\n// grant codeBase \"file:${catalina.home}/webapps/examples/WEB-INF/classes/-\" {\n// };\n//\n// The permission granted to your JDBC driver\n// grant codeBase\n\"jar:file:${catalina.home}/webapps/examples/WEB-INF/lib/driver.jar!/-\" {\n//      permission java.net.SocketPermission \"dbhost.mycompany.com:5432\", \"connect\";\n// };\n// The permission granted to the scrape taglib\n// grant codeBase\n\"jar:file:${catalina.home}/webapps/examples/WEB-INF/lib/scrape.jar!/-\" {\n//      permission java.net.SocketPermission \"*.noaa.gov:80\", \"connect\";\n// };\n\n// ##################### AGGIUNTE MANUALI EFFETTUATE DA BONINO DARIO\n#####################\n\n// These permissions apply to the servlet API classes and those that are shared\nacross\n// all class loaders located in the \"RGI/lib/common\" OR \"RGI/lib/shared\" directory\ngrant codeBase \"file:${catalina.home}/RGI/lib/-\" {\n    permission java.security.AllPermission;\n    };\n\n// Web applications permission, J2EE Specification 1.4\n// Minimum set of permissions that Web Components components can expect. \ngrant {\n\tpermission java.lang.RuntimePermission  \"loadLibrary.*\";\n\tpermission java.lang.RuntimePermission  \"queuePrintJob\";\n\tpermission java.net.SocketPermission    \"*\", \"connect\";\n\tpermission java.io.FilePermission       \"<<ALL FILES>>\", \"read,write\";\n\tpermission java.util.PropertyPermission \"*\", \"read\";\n    };\n\n// RGI JBasis and PassCompagnia requirements\ngrant {\n    permission java.util.PropertyPermission \"user.language\", \"write\"; //\nOPTIONAL, per poter cambiare i \"Regional Settings\"\n    permission java.net.SocketPermission \"*:1024-65535\", \"connect,accept,listen\";\n    // permission java.lang.RuntimePermission \"accessDeclaredMembers\"; // REFLECTION\n    // permission java.security.AllPermission; // DEBUG\n    };\n\n\n\n############################################################################################################\n############################################################################################################",
    "hasPatch": false,
    "hasScreenshot": false,
    "id": "25819",
    "issuetypeClassified": "OTHER",
    "issuetypeTracker": "BUG",
    "priority": "P3 minor",
    "product": "Tomcat 5",
    "project": "TOMCAT",
    "summary": "java.lang.NoClassDefFoundError: org/apache/tomcat/util/buf/C2BConverter",
    "systemSpecification": true,
    "version": "5.0.16"
}