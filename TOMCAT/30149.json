{
    "comments": [
        {
            "author": null,
            "body": "I traced the problem to CallMethodRule class, where callMethodN was invoked \ntwice.  With the following change, Tomcat works fine with context-param.  I \nalso tested this change with jsp tck.  I will appreciate it if someone could \nreview and apply it.\n\nIndex: CallMethodRule.java\n===================================================================\nRCS file: /home/cvspublic/jakarta-tomcat-\nconnectors/util/java/org/apache/tomcat/util/digester/CallMethodRule.java,v\nretrieving revision 1.1\ndiff -u -r1.1 CallMethodRule.java\n--- CallMethodRule.java 26 Jun 2004 17:41:30 -0000      1.1\n+++ CallMethodRule.java 22 Jul 2004 19:24:05 -0000\n@@ -572,7 +572,6 @@\n             sb.append(\")\");\n             digester.log.debug(sb.toString());\n         }\n-        IntrospectionUtils.callMethodN(target, methodName, paramValues, \nparamTypes);\n         Object result = IntrospectionUtils.callMethodN(target, methodName,\n                 paramValues, paramTypes);\n         processMethodCallResult(result);\n",
            "date": "20040722T19:39:06",
            "id": 0
        },
        {
            "author": null,
            "body": "Fixed by applying Cheng's patch.",
            "date": "20040723T15:59:36",
            "id": 1
        }
    ],
    "component": "Catalina",
    "description": "It appears any wars with context-param failed to\ndeploy.  When parsing web.xml, context-param elements are parsed and added\nto map twice for some reason, and thus cause the second adding to throw\nIllegalArgumentException.\n\nI instrumented\napache/jakarta-tomcat-\ncatalina/catalina/src/share/org/apache/catalina/core/StandardContext.java\naddParameter method\n\nHere it shows context-param was added twice:\n\nINFO: Installing web application at context path /jsp-examples from URL\nfile:/.../jakarta-tomcat-5/webapps/jsp-examples\n### name=webmaster value=myaddress@mycompany.com\n### map={}\n### value=null\n### to add ok\n### name=webmaster value=myaddress@mycompany.com\n### map={webmaster=myaddress@mycompany.com}\n### value=myaddress@mycompany.com\n### to throw\n\nTo repruduce it, just add to jsp-examples/web-inf/web.xml:\n\n    <context-param>\n      <param-name>webmaster</param-name>\n      <param-value>myaddress@mycompany.com</param-value>\n      <description>\n        The EMAIL address of the administrator to whom questions\n        and comments about this application should be addressed.\n      </description>\n    </context-param>\n\nStack trace from catalina.log:\nJul 15, 2004 9:54:37 PM org.apache.tomcat.util.digester.Digester endElement\nSEVERE: End event threw exception\njava.lang.reflect.InvocationTargetException\n        at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)\n        at sun.reflect.NativeMethodAccessorImpl.invoke\n(NativeMethodAccessorImpl.java:39)\n        at sun.reflect.DelegatingMethodAccessorImpl.invoke\n(DelegatingMethodAccessorImpl.java:25)\n        at java.lang.reflect.Method.invoke(Method.java:324)\n        at org.apache.tomcat.util.IntrospectionUtils.callMethodN\n(IntrospectionUtils.java:907)\n        at org.apache.tomcat.util.digester.CallMethodRule.end\n(CallMethodRule.java:576)\n        at org.apache.tomcat.util.digester.Rule.end(Rule.java:228)\n        at org.apache.tomcat.util.digester.Digester.endElement\n(Digester.java:1057)\n        at org.apache.crimson.parser.Parser2.maybeElement(Parser2.java:1720)\n        at org.apache.crimson.parser.Parser2.content(Parser2.java:1963)\n        at org.apache.crimson.parser.Parser2.maybeElement(Parser2.java:1691)\n        at org.apache.crimson.parser.Parser2.parseInternal(Parser2.java:667)\n        at org.apache.crimson.parser.Parser2.parse(Parser2.java:337)\n        at org.apache.crimson.parser.XMLReaderImpl.parse(XMLReaderImpl.java:448)\n        at org.apache.tomcat.util.digester.Digester.parse(Digester.java:1561)\n        at org.apache.catalina.startup.ContextConfig.applicationConfig\n(ContextConfig.java:234)\n        at org.apache.catalina.startup.ContextConfig.start\n(ContextConfig.java:557)\n        at org.apache.catalina.startup.ContextConfig.lifecycleEvent\n(ContextConfig.java:187)\n        at org.apache.catalina.util.LifecycleSupport.fireLifecycleEvent\n(LifecycleSupport.java:119)\n        at org.apache.catalina.core.StandardContext.start\n(StandardContext.java:4285)\n        at org.apache.catalina.core.ContainerBase.addChildInternal\n(ContainerBase.java:755)\n        at org.apache.catalina.core.ContainerBase.addChild\n(ContainerBase.java:739)\n        at org.apache.catalina.core.StandardHost.addChild(StandardHost.java:595)\n        at org.apache.catalina.core.StandardHostDeployer.install\n(StandardHostDeployer.java:276)\n        at org.apache.catalina.core.StandardHost.install(StandardHost.java:832)\n        at org.apache.catalina.startup.HostConfig.deployWARs\n(HostConfig.java:584)\n        at org.apache.catalina.startup.HostConfig.deployApps\n(HostConfig.java:398)\n        at org.apache.catalina.startup.HostConfig.check(HostConfig.java:997)\n        at org.apache.catalina.startup.HostConfig.lifecycleEvent\n(HostConfig.java:298)\n        at org.apache.catalina.util.LifecycleSupport.fireLifecycleEvent\n(LifecycleSupport.java:119)\n        at org.apache.catalina.core.StandardHost.backgroundProcess\n(StandardHost.java:800)\n        at \norg.apache.catalina.core.ContainerBase$ContainerBackgroundProcessor.processChild\nren(ContainerBase.java:1511)\n        at \norg.apache.catalina.core.ContainerBase$ContainerBackgroundProcessor.processChild\nren(ContainerBase.java:1520)\n        at \norg.apache.catalina.core.ContainerBase$ContainerBackgroundProcessor.run\n(ContainerBase.java:1500)\n        at java.lang.Thread.run(Thread.java:534)\nCaused by: java.lang.IllegalArgumentException: Duplicate context initialization \nparameter webmaster\n        at org.apache.catalina.core.StandardContext.addParameter\n(StandardContext.java:2116)\n        ... 35 more\nJul 15, 2004 9:54:37 PM org.apache.catalina.startup.ContextConfig \napplicationConfig\nSEVERE: Parse error in application web.xml\njava.lang.IllegalArgumentException: Duplicate context initialization parameter \nwebmaster\n        at org.apache.tomcat.util.digester.Digester.createSAXException\n(Digester.java:2740)\n        at org.apache.tomcat.util.digester.Digester.createSAXException\n(Digester.java:2766)\n        at org.apache.tomcat.util.digester.Digester.endElement\n(Digester.java:1060)\n        at org.apache.crimson.parser.Parser2.maybeElement(Parser2.java:1720)",
    "hasPatch": false,
    "hasScreenshot": false,
    "id": "30149",
    "issuetypeClassified": "BUG",
    "issuetypeTracker": "BUG",
    "priority": "P3 normal",
    "product": "Tomcat 5",
    "project": "TOMCAT",
    "summary": "IllegalArgumentException when using context-param in web.xml",
    "systemSpecification": false,
    "version": "Nightly Build"
}