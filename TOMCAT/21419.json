{
    "comments": [
        {
            "author": null,
            "body": "Jacob, if you could try to substantiate your reports, that would be great. This\ndoesn't help anyone.\nAFAIK, there has never been any getHost method inside StandardHost, and there\nhasn't been any change between the StdHost from 5.0.3 and the StdHost from CVS\nHEAD. I would appreciate if you could debug a bit your setup, which most of the\ntime is not exactly clean.",
            "date": "20030708T21:17:23",
            "id": 0
        },
        {
            "author": null,
            "body": "Hi Remy,\n\nI don't have the slightest clue of where to look in Tomcat.  Here is what I know\n(and thought was clear in the initial report)...\n\n1.  The problem didn't happen when using any previous version of Tomcat.  That\nis, everything works just fine from version 5.0.3 all the way back to all recent\nversions of 4.1.xx.\n\n2.  The only thing that changed was pointing CATALINA_HOME to the latest version\nof Tomcat built from CVS rather than some other version of Tomcat.  Really,\ntruly, not one other thing is different.  Not a single change was made to the\napplication; only the value of CATALINA_HOME in the batch script is different.\n\nGiven these premises, the conclusion follows that the problem is not my app, but\nsomething in Tomcat. If that conclusion is just way out of line, please describe\nyour reasoning.\n\nI'm not saying that the issue is necessarily StandardHost.  What I'm saying is,\nthat is what the stack trace says.  There is also a NullPointerException further\ndown the stack trace.  There's a lot of runtime reflection going on there and\nwhat is being reported is probably obscuring the real issue.  What I was hoping\nwas that the stack trace would be more clear to you than to me and that it would\nprovide a clue to the real source of the issue.\n\nFor your information, here is what the \"run-tomcat\" batch script looks like...\n\n@echo off\nset CATALINA_HOME=C:\\Java\\Apache\\Jakarta\\tomcat-5-20030708\nset\nCATALINA_BASE=D:\\myclasses\\Repository\\Enhydra\\XMLC_DSF_2003-05-19-2\\xmlc\\examples\\tomcat\\build\n\nrem remove the log files\ndel /Q %CATALINA_BASE%\\logs\\*\n\n%CATALINA_HOME%\\bin\\catalina.bat run\n\n\nPretty simple stuff.  Again, the only difference between when things work and\nwhen things don't is the value of CATALINA_HOME above.  Specifically, if I\nchange it to \"C:\\Java\\Apache\\Jakarta\\tomcat-5.0.3\", then Tomcat starts up just fine.\n\nYour criticism of my bug reports notwithstanding, most all of my bug reports\nhave lead to important modifications allowing Tomcat to work properly where it\nmay not have if not for my report because you wouldn't be aware of the issue if\nnot for the report.  So, I'll try to improve the reports but remember, I'm an\ninterested Tomcat user, but not a Tomcat developer.  Please keep expectations in\nline with that fact.\n\nLet me know if you require any other specific types of information to make it\neasier to fix this issue.  I can provide instructions on reproducing the\nproblem, but that would require you to grab the latest source of XMLC.  I'm not\nsure if you are willing to do that or not.  If so, let me know and I'll provide\nstep-by-step instructions.\n\nJake",
            "date": "20030708T23:54:22",
            "id": 1
        },
        {
            "author": null,
            "body": "If something really bad happens during init (which doesn't happen in practice),\nthen the server instance is null, and you should get a NPE.\nThere's of course no call to any getHost( method (do a grep if you don't believe\nme) anywhere in the source - and there never was one -, except on the request\nmethod.\nDon't worry, if this bug is real, it seems obvious enough, and other people will\nreport it.\n\nCan't you really fix that kind of thing ?\nlog4j:WARN No appenders could be found for logger\n(org.apache.catalina.startup.Embedded).\nlog4j:WARN Please initialize the log4j system properly.",
            "date": "20030709T07:05:21",
            "id": 2
        },
        {
            "author": null,
            "body": "Same problem, here is a small patch from me.\n\nWORKS FOR ME\n\nIndex: SetDocBaseRule.java\n===================================================================\nRCS file: /home/cvspublic/jakarta-tomcat-\ncatalina/catalina/src/share/org/apache/catalina/startup/SetDocBaseRule.java,v\nretrieving revision 1.1\ndiff -u -w -b -r1.1 SetDocBaseRule.java\n--- SetDocBaseRule.java 24 Jun 2003 22:37:05 -0000      1.1\n+++ SetDocBaseRule.java 9 Jul 2003 11:24:21 -0000\n@@ -118,8 +118,13 @@\n\n         Context child = (Context) digester.peek(0);\n         Deployer parent = (Deployer) digester.peek(1);\n+        Host host = null;\n+        if (!( parent instanceof StandardHost ))  {\n         Method method = parent.getClass().getMethod(\"getHost\", null);\n-        Host host = (Host) method.invoke(parent, null);\n+          host = (Host) method.invoke(parent, null);\n+        } else\n+          host = (Host)parent;\n+\n         String appBase = host.getAppBase();\n\n         if (!(host instanceof StandardHost)) {\n",
            "date": "20030709T11:29:46",
            "id": 3
        },
        {
            "author": null,
            "body": "Sounds convincing enough to me ;-) It seems you made a mistake trying to reopen\nthe bug.\nThis doesn't happen in normal mode for me however. how do you reproduce it ?\n\nAbout the patch: Maybe it could be cleaner, I'll see what I can do. The addition\nof a method somewhere could be needed.\n",
            "date": "20030709T11:51:58",
            "id": 4
        },
        {
            "author": null,
            "body": "Sorry, can't reproduce it in the quick. Seen this exception on my 2 development machines and on my dev-server,after patching SetDocBaseRule to check if its get a StandardHost or other thing, it's work for me. My Setup,dev-server: 1 host + 3 aliases, standalone tomcatdev-machines: 1 host, localhost only",
            "date": "20030709T12:17:48",
            "id": 5
        },
        {
            "author": null,
            "body": "I'm glad someone else is seeing this.  I tried reproducing it by just running\n\"$CATALINA_HOME/bin/catalina.bat run\", but I didn't see the error occur there.\n\nHere is how you can reproduce it for yourself:\n\n1.  Grab the latest XMLC CVS.  See instructions here:\nhttp://forge.objectweb.org/cvs/?group_id=49\n\n2.  cd to the root of the build and follow short instructions in the \"README\". \nXMLC should now be built.\n\n3.  cd to $XMLC_ROOT/examples/tomcat.  Copy \"build.properties.examples\" to\n\"build.properties\" and modify the path to \"tomcat.home\".  Now run \"ant\".  This\nwill build the examples and set up an environment for a custom CATALINA_BASE and\nuse the value you defined for tomcat.home for CATALINA_HOME.  Convenience\nscripts \"run-tomcat.bat\" and \"run-tomcat.sh\" will be generated for you.\n\n4.  run the appropriate script for your platform.  I run \"run-tomcat.bat\" on my\nwin2k platform.  You should now witness the stack trace that I reported if you\nare using the latest Tomcat5 CVS.  To test with another version of tomcat,\nmodify the tomcat.home property in build.properties to, say..., tomcat-5.0.3 and\nre-run \"ant\".  The scripts will be re-generated for you pointing to the\nappropriate CATALINA_HOME.  You should not witness the stack trace using\ntomcat-5.0.3.\n\n5.  If you care to view the application running under this custom CATALINA_BASE,\npoint your browser to:\nhttp://localhost:8081/xmlc/\n\nHopefully those instructions are clear enough.  Let me know if you have\ndifficulties.\n\n\nBTW, regarding your comments...\n\n>Can't you really fix that kind of thing ?\n>log4j:WARN No appenders could be found for logger\n>(org.apache.catalina.startup.Embedded).\n>log4j:WARN Please initialize the log4j system properly.\n\nThat started happening in recent Tomcat5 builds.  It doesn't occur when using\nTomcat-4.1.xx and actually didn't occur in early builds of Tomcat5 (sorry, not\nsure when exactly it started).  I suspect the reason it is happening has more to\ndo with commons-logging than Log4j.  I put log4j-1.2.8.jar in\nCATALINA_HOME/common/lib as a standard practice.  Since commons-logging sees\nLog4j in its classpath, it uses it.  The app in question actually uses no\nlogging whatsoever so this message is coming from something in Tomcat itself (or\nits 3rd party libraries) and not the example application.  If you are asking me\nto  track down the issue in commons-logging, you are barking up the wrong tree.\n I have nothing to do with commons-logging and, personally, I feel it has caused\nway more pain and suffering than it is worth.  The class loading tricks it uses\nto proxy other logging api's fails in lots of situations and is incredibly hard\nto debug.  If it were up to me, I'd drop commons-logging like a bad habit and\njust use Log4j directly.  I know that won't happen, though, so I'm not going to\npress the issue.  I can make Log4j work just fine for me in apps using Log4j\ndirectly so the Log4j warning message in question is pretty innocuous to me. \nI'm not sure if the interaction is adversly affecting Tomcat5 logging when\ncommons-logging finds Log4j in its classpath or not?  As such, I'm not very\nworried about it.  If you want to report a bug I'm all for it, but the only\npeople who will be able to fix it are either Tomcat guys like yourself or\ncommons-logging guys.  I don't think many people at Log4j will have much\ninterest or be able to help in any way other than maybe Yoav Shapira who has\nmore hands-on experience with commons-logging as well as being a Log4j developer.\n\nJake\n\n",
            "date": "20030709T13:15:15",
            "id": 6
        },
        {
            "author": null,
            "body": "Ok, I reproduced it. You only need to have a Context element defined in server.xml.\nSo since this is not the preferred way in TC 5, I forgot to test it. Torsten's\npatch is correct, and I'll apply it. Thanks for the patch.\n\nJacob: Thanks for reporting the issue. About the log4j problem: I did change\nthings in the webapp classloader, but not in the main common classloader.",
            "date": "20030709T18:21:28",
            "id": 7
        }
    ],
    "component": "Catalina",
    "description": "Using the latest CVS build from today (2003/07/08), starting Tomcat5 using\n\"catalina.bat run\" (under Win2k) and using a custom CATALINA_BASE results in the\nfollowing error on startup.  This worked just fine with Tomcat-5.0.3....\n\n\nD:\\myclasses\\Repository\\Enhydra\\XMLC_DSF_2003-05-19-2\\xmlc\\examples\\tomcat>run-tomcat\nUsing CATALINA_BASE:  \nD:\\myclasses\\Repository\\Enhydra\\XMLC_DSF_2003-05-19-2\\xmlc\\examples\\tomcat\\build\nUsing CATALINA_HOME:   C:\\Java\\Apache\\Jakarta\\tomcat-5-20030708\nUsing CATALINA_TMPDIR:\nD:\\myclasses\\Repository\\Enhydra\\XMLC_DSF_2003-05-19-2\\xmlc\\examples\\tomcat\\build\\temp\nUsing JAVA_HOME:       C:\\j2sdk1.4.1_02\nlog4j:WARN No appenders could be found for logger\n(org.apache.catalina.startup.Embedded).\nlog4j:WARN Please initialize the log4j system properly.\nCatalina.start: java.lang.NoSuchMethodException:\norg.apache.catalina.core.StandardHost.getHost()\njava.lang.NoSuchMethodException: org.apache.catalina.core.StandardHost.getHost()\n        at\norg.apache.commons.digester.Digester.createSAXException(Digester.java:2540)\n        at\norg.apache.commons.digester.Digester.createSAXException(Digester.java:2566)\n        at org.apache.commons.digester.Digester.startElement(Digester.java:1276)\n        at org.apache.xerces.parsers.AbstractSAXParser.startElement(Unknown Source)\n        at\norg.apache.xerces.impl.XMLDocumentFragmentScannerImpl.scanStartElement(Unknown\nSource)\n        at\norg.apache.xerces.impl.XMLDocumentFragmentScannerImpl$FragmentContentDispatcher.dispatch(Unknown\nSource)\n        at\norg.apache.xerces.impl.XMLDocumentFragmentScannerImpl.scanDocument(Unknown Source)\n        at org.apache.xerces.parsers.XML11Configuration.parse(Unknown Source)\n        at org.apache.xerces.parsers.DTDConfiguration.parse(Unknown Source)\n        at org.apache.xerces.parsers.XMLParser.parse(Unknown Source)\n        at org.apache.xerces.parsers.AbstractSAXParser.parse(Unknown Source)\n        at org.apache.commons.digester.Digester.parse(Digester.java:1548)\n        at org.apache.catalina.startup.Catalina.load(Catalina.java:511)\n        at org.apache.catalina.startup.Catalina.load(Catalina.java:549)\n        at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)\n        at\nsun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:39)\n        at\nsun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:25)\n        at java.lang.reflect.Method.invoke(Method.java:324)\n        at org.apache.catalina.startup.Bootstrap.load(Bootstrap.java:260)\n        at org.apache.catalina.startup.Bootstrap.main(Bootstrap.java:393)\nCatalina.start: java.lang.NoSuchMethodException:\norg.apache.catalina.core.StandardHost.getHost()\njava.lang.NoSuchMethodException: org.apache.catalina.core.StandardHost.getHost()\n        at\norg.apache.commons.digester.Digester.createSAXException(Digester.java:2540)\n        at\norg.apache.commons.digester.Digester.createSAXException(Digester.java:2566)\n        at org.apache.commons.digester.Digester.startElement(Digester.java:1276)\n        at org.apache.xerces.parsers.AbstractSAXParser.startElement(Unknown Source)\n        at\norg.apache.xerces.impl.XMLDocumentFragmentScannerImpl.scanStartElement(Unknown\nSource)\n        at\norg.apache.xerces.impl.XMLDocumentFragmentScannerImpl$FragmentContentDispatcher.dispatch(Unknown\nSource)\n        at\norg.apache.xerces.impl.XMLDocumentFragmentScannerImpl.scanDocument(Unknown Source)\n        at org.apache.xerces.parsers.XML11Configuration.parse(Unknown Source)\n        at org.apache.xerces.parsers.DTDConfiguration.parse(Unknown Source)\n        at org.apache.xerces.parsers.XMLParser.parse(Unknown Source)\n        at org.apache.xerces.parsers.AbstractSAXParser.parse(Unknown Source)\n        at org.apache.commons.digester.Digester.parse(Digester.java:1548)\n        at org.apache.catalina.startup.Catalina.load(Catalina.java:511)\n        at org.apache.catalina.startup.Catalina.start(Catalina.java:569)\n        at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)\n        at\nsun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:39)\n        at\nsun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:25)\n        at java.lang.reflect.Method.invoke(Method.java:324)\n        at org.apache.catalina.startup.Bootstrap.start(Bootstrap.java:297)\n        at org.apache.catalina.startup.Bootstrap.main(Bootstrap.java:394)\njava.lang.reflect.InvocationTargetException\n        at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)\n        at\nsun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:39)\n        at\nsun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:25)\n        at java.lang.reflect.Method.invoke(Method.java:324)\n        at org.apache.catalina.startup.Bootstrap.start(Bootstrap.java:297)\n        at org.apache.catalina.startup.Bootstrap.main(Bootstrap.java:394)\nCaused by: java.lang.NullPointerException\n        at org.apache.catalina.startup.Catalina.await(Catalina.java:633)\n        at org.apache.catalina.startup.Catalina.start(Catalina.java:595)\n        ... 6 more\n\n\nAfter this, Tomcat just exists the JVM.  What changed between Tomcat-5.0.3 and\nthe current CVS to cause this error?\n\nJake",
    "hasPatch": false,
    "hasScreenshot": false,
    "id": "21419",
    "issuetypeClassified": "BUG",
    "issuetypeTracker": "BUG",
    "priority": "P3 major",
    "product": "Tomcat 5",
    "project": "TOMCAT",
    "summary": "error on startup - java.lang.NoSuchMethodException: org.apache.catalina.core.StandardHost.getHost()",
    "systemSpecification": true,
    "version": "Nightly Build"
}