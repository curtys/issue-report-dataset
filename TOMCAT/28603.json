{
    "comments": [
        {
            "author": null,
            "body": "Fixed by removing empty .java file (that was generated by \"new\nFileOutputStream()\") if parser/validator/generator throws exception.",
            "date": "20040427T18:15:53",
            "id": 0
        },
        {
            "author": null,
            "body": "I must say this still does not work for me in Tomcat 5.0.24. I am attaching an\napplication which reproduces this issue. To reproduce:\n\n1. Unzip the attached testApp.zip\n2. Modify the build.properties file from testApp.zip to point to a Tomcat 5.0.24\ninstallation\n3. In the root directory of this test application, run Ant twice (I am using Ant\n1.6.1). The first time you run Ant, a compilation error is reported, but the\nsecond time it is not and build succeeds.\n\nThanks for looking at this.\n",
            "date": "20040506T12:59:10",
            "id": 1
        },
        {
            "author": null,
            "body": "Created attachment 11444\nThe test application which reproduces this issue.",
            "date": "20040506T13:00:06",
            "id": 2
        },
        {
            "author": null,
            "body": "Hmm, this works for me (on UNIX).\n\nDo you see an empty JSP_jsp.java file being generated in your project's \"build\"\ndirectory? Such a file used to be generated, but my fix should have deleted it\n(using File.delete()).",
            "date": "20040506T22:44:13",
            "id": 3
        },
        {
            "author": null,
            "body": "Ok, I'll look at this over the weekend and debug it on my side.",
            "date": "20040507T16:38:18",
            "id": 4
        },
        {
            "author": null,
            "body": "I found out where the problem is: When the file is deleted, the outputstream\nthat writes this file is still open, so the delete operation fails on Windows.\nThe stream is closed too late. I will attach a patch that fixes this on my machine.\n\n",
            "date": "20040510T14:01:27",
            "id": 5
        },
        {
            "author": null,
            "body": "Created attachment 11489\nPatch that works for me.",
            "date": "20040510T14:02:38",
            "id": 6
        },
        {
            "author": null,
            "body": "Created attachment 11499\nSet 'writer' to NULL, so it won't be closed again in finally",
            "date": "20040510T16:27:28",
            "id": 7
        },
        {
            "author": null,
            "body": "Thanks for investigating, Petr!\n\nI've applied your patch, which I slightly modified by setting 'writer' to NULL\nafter closing it in the exception handling code you added, so that it won't be\nclosed again in the finally.\n\nModified patch attached.",
            "date": "20040510T16:28:58",
            "id": 8
        },
        {
            "author": null,
            "body": "Thanks!",
            "date": "20040510T17:54:17",
            "id": 9
        }
    ],
    "component": "Jasper",
    "description": "1. Set up an application with an Ant script to compile JSPs as recommended at\nhttp://jakarta.apache.org/tomcat/tomcat-5.0-doc/jasper-howto.html\n2. Write a JSP which contains erroneous text such that the first phase (JSP ->\nJava translation) fails e.g. by including <jsp:include x=\"50\"/> in the page.\n3. Compile the application using the Ant script - a Jasper exception will be\nreported.\n4. Compile the application again - build will succeed despite the error.",
    "hasPatch": true,
    "hasScreenshot": false,
    "id": "28603",
    "issuetypeClassified": "BUG",
    "issuetypeTracker": "BUG",
    "priority": "P3 normal",
    "product": "Tomcat 5",
    "project": "TOMCAT",
    "summary": "JspC Ant task does not detect errors on a second compile",
    "systemSpecification": true,
    "version": "5.0.19"
}