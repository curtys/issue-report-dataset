{
    "comments": [
        {
            "author": "igor@mir2.org",
            "body": "Created attachment 203660\nfix and cleanup\n\nPatch to cleanup goto generation while fixing 100% bogus assertion.",
            "date": "20051119T22:54:51",
            "id": 0
        },
        {
            "author": "igor@mir2.org",
            "body": "I committed the fix",
            "date": "20051120T00:46:44",
            "id": 1
        }
    ],
    "component": "Core",
    "description": "User-Agent:       Mozilla/4.0 (compatible; MSIE 6.0; Windows NT 5.1; Texas Instruments; SV1; .NET CLR 1.1.4322)\nBuild Identifier: rhino 1.6R2\n\nI have some very large scripts which result in the traceback below.  I have not been able to create a small test case.  However, if I\u2019m reading the code for recordJump() and increaseICodeCapasity() correctly, recordJump() should be calling increaseICodeCapasity with deltaCapacity + 1 rather than just deltaCapacity:\n\n\u00b7         increaseICodeCapasity() asserts that itsICodeTop + delta > itsData.itsICode.length, but \n\n\u00b7         recordJump() calls increaseICodeCapasity() with a delta that is with respect to (itsICodeTop + 1)\n\n\nMaking the change below prevents the assertion for me, but I can\u2019t say if this is an appropriate patch.  From original recordJump:\n\n        int deltaCapacity = offsetSite + 2 - itsData.itsICode.length;\n        if (deltaCapacity > 0) {\n            increaseICodeCapasity(deltaCapacity);\n        }\n\n \n\nI changed this to:\n\n        int deltaCapacity = offsetSite + 2 - itsData.itsICode.length;\n        if (deltaCapacity > 0) {\n            increaseICodeCapasity(deltaCapacity + 1);\n        }\n\n \n\n\n\nReproducible: Always\n\nSteps to Reproduce:\n1. run rhino in interprested mode on the wrong size scripts\n2.\n3.\n\nActual Results:  \nI get the following assertion violation from the interpreter: \n\njava.lang.IllegalStateException: FAILED ASSERTION\n\n        at org.mozilla.javascript.Kit.codeBug(Kit.java:477)\n\n        at org.mozilla.javascript.Interpreter.increaseICodeCapasity(Interpreter.java:1707)\n\n        at org.mozilla.javascript.Interpreter.recordJump(Interpreter.java:1529)\n\n        at org.mozilla.javascript.Interpreter.addGoto(Interpreter.java:1459)\n\n        at org.mozilla.javascript.Interpreter.visitStatement(Interpreter.java:722)\n\n        at org.mozilla.javascript.Interpreter.visitStatement(Interpreter.java:655)\n\n        at org.mozilla.javascript.Interpreter.visitStatement(Interpreter.java:655)\n\n        at org.mozilla.javascript.Interpreter.generateICodeFromTree(Interpreter.java:505)\n\n        at org.mozilla.javascript.Interpreter.generateFunctionICode(Interpreter.java:496)\n\n        at org.mozilla.javascript.Interpreter.generateNestedFunctions(Interpreter.java:580)\n\n        at org.mozilla.javascript.Interpreter.generateICodeFromTree(Interpreter.java:501)\n\n        at org.mozilla.javascript.Interpreter.compile(Interpreter.java:458)\n\n        at org.mozilla.javascript.Context.compileImpl(Context.java:2213)\n\n        at org.mozilla.javascript.Context.compileReader(Context.java:1246)\n\n        at org.mozilla.javascript.Context.compileReader(Context.java:1218)\n\n        at org.mozilla.javascript.Context.evaluateReader(Context.java:1160)\n\n        at config.Shell.evaluateReader(Shell.java:556)\n\n        at config.Shell.processFile(Shell.java:387)\n\n        at config.Shell.load(Shell.java:865)\n\n        at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)\n\n        at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:39)\n\n        at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:25)\n\n        at java.lang.reflect.Method.invoke(Method.java:585)\n\n        at org.mozilla.javascript.MemberBox.invoke(MemberBox.java:142)\n\n        at org.mozilla.javascript.FunctionObject.call(FunctionObject.java:405)\n\n        at org.mozilla.javascript.Interpreter.interpretLoop(Interpreter.java:3084)\n\n        at org.mozilla.javascript.Interpreter.interpret(Interpreter.java:2250)\n\n        at org.mozilla.javascript.InterpretedFunction.exec(InterpretedFunction.java:163)\n\n        at org.mozilla.javascript.Context.evaluateReader(Context.java:1163)\n\n        at config.Shell.evaluateReader(Shell.java:556)\n\n        at config.Shell.processFile(Shell.java:387)\n\n        at config.Shell.load(Shell.java:865)\n\n        at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)\n\n        at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:39)\n\n        at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:25)\n\n        at java.lang.reflect.Method.invoke(Method.java:585)\n\n        at org.mozilla.javascript.MemberBox.invoke(MemberBox.java:142)\n\n        at org.mozilla.javascript.FunctionObject.call(FunctionObject.java:405)\n\n        at org.mozilla.javascript.Interpreter.interpretLoop(Interpreter.java:3084)\n\n        at org.mozilla.javascript.Interpreter.interpret(Interpreter.java:2250)\n\n        at org.mozilla.javascript.InterpretedFunction.call(InterpretedFunction.java:149)\n\n        at org.mozilla.javascript.ContextFactory.doTopCall(ContextFactory.java:337)\n\n        at org.mozilla.javascript.ScriptRuntime.doTopCall(ScriptRuntime.java:2755)\n\n        at org.mozilla.javascript.InterpretedFunction.exec(InterpretedFunction.java:160)\n\n        at org.mozilla.javascript.Context.evaluateReader(Context.java:1163)\n\n        at config.Shell.evaluateReader(Shell.java:556)\n\n        at config.Shell.processFile(Shell.java:387)\n\n        at config.Shell.exec(Shell.java:537)\n\n        at config.Shell.main(Shell.java:1004)",
    "hasPatch": true,
    "hasScreenshot": false,
    "id": "316993",
    "issuetypeClassified": "BUG",
    "issuetypeTracker": "BUG",
    "priority": "-- normal",
    "product": "Rhino",
    "project": "RHINO",
    "summary": "bad(?) assertion in rhino 1.6R2 Interpreter.java",
    "systemSpecification": false,
    "version": "other"
}