{
    "comments": [
        {
            "author": "selckin",
            "body": "ant output",
            "date": "2011-04-14T07:49:23.722+0000",
            "id": 0
        },
        {
            "author": "Robert Muir",
            "body": "Thanks for reporting this, I can reproduce on windows also, looks serious.\n\nMight be triggered by the fact we recently started randomizing skipinterval?\n\nNote, the test will NOT fail if you try the \"repro\" line!!!\nYou have to do 'ant test -Dtests.seed=-6595054217575280191:5576532348905930588'\n\nI don't know if this causes a timing issue or what, but it works for me too:\n\n{noformat}\n    [junit] Testsuite: org.apache.lucene.index.TestOmitTf\n    [junit] Testcase: testMixedMerge(org.apache.lucene.index.TestOmitTf):       Caused an ERROR\n    [junit] CheckIndex failed\n    [junit] java.lang.RuntimeException: CheckIndex failed\n    [junit]     at org.apache.lucene.util._TestUtil.checkIndex(_TestUtil.java:152)\n    [junit]     at org.apache.lucene.util._TestUtil.checkIndex(_TestUtil.java:138)\n    [junit]     at org.apache.lucene.index.TestOmitTf.testMixedMerge(TestOmitTf.java:155)\n    [junit]     at org.apache.lucene.util.LuceneTestCase$LuceneTestCaseRunner.runChild(LuceneTestCase.java:1232)\n    [junit]     at org.apache.lucene.util.LuceneTestCase$LuceneTestCaseRunner.runChild(LuceneTestCase.java:1160)\n    [junit]\n    [junit]\n    [junit] Tests run: 5, Failures: 0, Errors: 1, Time elapsed: 0.284 sec\n    [junit]\n    [junit] ------------- Standard Output ---------------\n    [junit] CheckIndex failed\n    [junit] Segments file=segments_1 numSegments=1 version=FORMAT_4_0 [Lucene 4.0]\n    [junit]   1 of 1: name=_12 docCount=60\n    [junit]     codec=SegmentCodecs [codecs=[MockRandom, MockVariableIntBlock(baseBlockSize=112)], provider=RandomCodecProvider: {f1=MockRandom, f2=MockVariable\nIntBlock(baseBlockSize=112)}]\n    [junit]     compound=false\n    [junit]     hasProx=false\n    [junit]     numFiles=16\n    [junit]     size (MB)=0,01\n    [junit]     diagnostics = {optimize=true, mergeFactor=2, os.version=6.0, os=Windows Vista, lucene.version=4.0-SNAPSHOT, source=merge, os.arch=x86, java.vers\nion=1.6.0_23, java.vendor=Sun Microsystems Inc.}\n    [junit]     no deletions\n    [junit]     test: open reader.........OK\n    [junit]     test: fields..............OK [2 fields]\n    [junit]     test: field norms.........OK [2 fields]\n    [junit]     test: terms, freq, prox...ERROR: java.io.IOException: Read past EOF\n    [junit] java.io.IOException: Read past EOF\n    [junit]     at org.apache.lucene.store.RAMInputStream.switchCurrentBuffer(RAMInputStream.java:90)\n    [junit]     at org.apache.lucene.store.RAMInputStream.readByte(RAMInputStream.java:63)\n    [junit]     at org.apache.lucene.store.MockIndexInputWrapper.readByte(MockIndexInputWrapper.java:105)\n    [junit]     at org.apache.lucene.store.DataInput.readVInt(DataInput.java:94)\n    [junit]     at org.apache.lucene.index.codecs.sep.SepSkipListReader.readSkipData(SepSkipListReader.java:188)\n    [junit]     at org.apache.lucene.index.codecs.MultiLevelSkipListReader.loadNextSkip(MultiLevelSkipListReader.java:142)\n    [junit]     at org.apache.lucene.index.codecs.MultiLevelSkipListReader.skipTo(MultiLevelSkipListReader.java:112)\n    [junit]     at org.apache.lucene.index.codecs.sep.SepPostingsReaderImpl$SepDocsEnum.advance(SepPostingsReaderImpl.java:454)\n    [junit]     at org.apache.lucene.index.CheckIndex.testTermIndex(CheckIndex.java:782)\n{noformat}",
            "date": "2011-04-14T08:22:08.645+0000",
            "id": 1
        },
        {
            "author": "Michael McCandless",
            "body": "Nice find!!\n\nThis seems to fail for me consistently:\n{noformat}\nant test-core -Dtestcase=TestOmitTf -Dtestmethod=testMixedMerge -Dtests.seed=-6440890546631805798:9110494168610462642\n{noformat}\n\nI'll hunt...",
            "date": "2011-04-14T08:29:36.749+0000",
            "id": 2
        },
        {
            "author": "Michael McCandless",
            "body": "I found the issue: it's because a FieldInfo got into a bad state where omitTF was true but storesPayloads was also true.  Plus, that the sep codec's skip data reader was \"tricked\" by this bad state.\n\nStandardCodec is not affected, and 3.x is not affected.  Still, for 3.x I'll backport making sure FieldInfo always clears storesPayloads if omitTF is true.",
            "date": "2011-04-14T09:26:33.622+0000",
            "id": 3
        },
        {
            "author": "Michael McCandless",
            "body": "Patch.\n\nI added asserts that trip when FieldInfo illegally has omitTFAP true,\nand storePayloads also true.  I fixed three places where this was able\nto occur: merging, flushing and on loading a preflex index.\n\nI'll commit shortly.\n",
            "date": "2011-04-14T09:53:27.062+0000",
            "id": 4
        },
        {
            "author": "Simon Willnauer",
            "body": "patch looks good mike!\n\nsimon",
            "date": "2011-04-14T10:05:53.437+0000",
            "id": 5
        },
        {
            "author": "Michael McCandless",
            "body": "Thanks selckin!",
            "date": "2011-04-14T10:55:34.333+0000",
            "id": 6
        }
    ],
    "component": "",
    "description": "Version: trunk r1091638\n\nant test -Dtests.seed=-6595054217575280191:5576532348905930588\n\n\n    [junit] ------------- Standard Error -----------------\n    [junit] WARNING: test method: 'testDeMorgan' left thread running: Thread[NRT search threads-1691-thread-2,5,main]\n    [junit] RESOURCE LEAK: test method: 'testDeMorgan' left 1 thread(s) running\n    [junit] NOTE: reproduce with: ant test -Dtestcase=TestBooleanQuery -Dtestmethod=testDeMorgan -Dtests.seed=-6595054217575280191:5576532348905930588\n    [junit] ------------- ---------------- ---------------\n    [junit] Testsuite: org.apache.lucene.index.TestNorms\n    [junit] Tests run: 2, Failures: 0, Errors: 0, Time elapsed: 5.064 sec\n    [junit] \n    [junit] Testsuite: org.apache.lucene.index.TestOmitTf\n    [junit] Testcase: testMixedMerge(org.apache.lucene.index.TestOmitTf):\tCaused an ERROR\n    [junit] CheckIndex failed\n    [junit] java.lang.RuntimeException: CheckIndex failed\n    [junit] \tat org.apache.lucene.util._TestUtil.checkIndex(_TestUtil.java:152)\n    [junit] \tat org.apache.lucene.util._TestUtil.checkIndex(_TestUtil.java:138)\n    [junit] \tat org.apache.lucene.index.TestOmitTf.testMixedMerge(TestOmitTf.java:155)\n    [junit] \tat org.apache.lucene.util.LuceneTestCase$LuceneTestCaseRunner.runChild(LuceneTestCase.java:1232)\n    [junit] \tat org.apache.lucene.util.LuceneTestCase$LuceneTestCaseRunner.runChild(LuceneTestCase.java:1160)\n    [junit] \n    [junit] \n    [junit] Tests run: 5, Failures: 0, Errors: 1, Time elapsed: 0.851 sec\n    [junit] \n    [junit] ------------- Standard Output ---------------\n    [junit] CheckIndex failed\n    [junit] Segments file=segments_1 numSegments=1 version=FORMAT_4_0 [Lucene 4.0]\n    [junit]   1 of 1: name=_12 docCount=60\n    [junit]     codec=SegmentCodecs [codecs=[MockRandom, MockVariableIntBlock(baseBlockSize=112)], provider=RandomCodecProvider: {f1=MockRandom, f2=MockVariableIntBlock(baseBlockSize=112)}]\n    [junit]     compound=false\n    [junit]     hasProx=false\n    [junit]     numFiles=16\n    [junit]     size (MB)=0,01\n    [junit]     diagnostics = {optimize=true, mergeFactor=2, os.version=2.6.37-gentoo, os=Linux, lucene.version=4.0-SNAPSHOT, source=merge, os.arch=amd64, java.version=1.6.0_24, java.vendor=Sun Microsystems Inc.}\n    [junit]     no deletions\n    [junit]     test: open reader.........OK\n    [junit]     test: fields..............OK [2 fields]\n    [junit]     test: field norms.........OK [2 fields]\n    [junit]     test: terms, freq, prox...ERROR: java.io.IOException: Read past EOF\n    [junit] java.io.IOException: Read past EOF\n    [junit] \tat org.apache.lucene.store.RAMInputStream.switchCurrentBuffer(RAMInputStream.java:90)\n    [junit] \tat org.apache.lucene.store.RAMInputStream.readByte(RAMInputStream.java:63)\n    [junit] \tat org.apache.lucene.store.MockIndexInputWrapper.readByte(MockIndexInputWrapper.java:105)\n    [junit] \tat org.apache.lucene.store.DataInput.readVInt(DataInput.java:94)\n    [junit] \tat org.apache.lucene.index.codecs.sep.SepSkipListReader.readSkipData(SepSkipListReader.java:188)\n    [junit] \tat org.apache.lucene.index.codecs.MultiLevelSkipListReader.loadNextSkip(MultiLevelSkipListReader.java:142)\n    [junit] \tat org.apache.lucene.index.codecs.MultiLevelSkipListReader.skipTo(MultiLevelSkipListReader.java:112)\n    [junit] \tat org.apache.lucene.index.codecs.sep.SepPostingsReaderImpl$SepDocsEnum.advance(SepPostingsReaderImpl.java:454)\n    [junit] \tat org.apache.lucene.index.CheckIndex.testTermIndex(CheckIndex.java:782)\n    [junit] \tat org.apache.lucene.index.CheckIndex.checkIndex(CheckIndex.java:495)\n    [junit] \tat org.apache.lucene.util._TestUtil.checkIndex(_TestUtil.java:148)\n    [junit] \tat org.apache.lucene.util._TestUtil.checkIndex(_TestUtil.java:138)\n    [junit] \tat org.apache.lucene.index.TestOmitTf.testMixedMerge(TestOmitTf.java:155)\n    [junit] \tat sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)\n    [junit] \tat sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:39)\n    [junit] \tat sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:25)\n    [junit] \tat java.lang.reflect.Method.invoke(Method.java:597)\n    [junit] \tat org.junit.runners.model.FrameworkMethod$1.runReflectiveCall(FrameworkMethod.java:44)\n    [junit] \tat org.junit.internal.runners.model.ReflectiveCallable.run(ReflectiveCallable.java:15)\n    [junit] \tat org.junit.runners.model.FrameworkMethod.invokeExplosively(FrameworkMethod.java:41)\n    [junit] \tat org.junit.internal.runners.statements.InvokeMethod.evaluate(InvokeMethod.java:20)\n    [junit] \tat org.junit.rules.TestWatchman$1.evaluate(TestWatchman.java:48)\n    [junit] \tat org.junit.internal.runners.statements.RunBefores.evaluate(RunBefores.java:28)\n    [junit] \tat org.junit.internal.runners.statements.RunAfters.evaluate(RunAfters.java:31)\n    [junit] \tat org.junit.runners.BlockJUnit4ClassRunner.runChild(BlockJUnit4ClassRunner.java:76)\n    [junit] \tat org.apache.lucene.util.LuceneTestCase$LuceneTestCaseRunner.runChild(LuceneTestCase.java:1232)\n    [junit] \tat org.apache.lucene.util.LuceneTestCase$LuceneTestCaseRunner.runChild(LuceneTestCase.java:1160)\n    [junit] \tat org.junit.runners.ParentRunner$3.run(ParentRunner.java:193)\n    [junit] \tat org.junit.runners.ParentRunner$1.schedule(ParentRunner.java:52)\n    [junit] \tat org.junit.runners.ParentRunner.runChildren(ParentRunner.java:191)\n    [junit] \tat org.junit.runners.ParentRunner.access$000(ParentRunner.java:42)\n    [junit] \tat org.junit.runners.ParentRunner$2.evaluate(ParentRunner.java:184)\n    [junit] \tat org.junit.internal.runners.statements.RunBefores.evaluate(RunBefores.java:28)\n    [junit] \tat org.junit.internal.runners.statements.RunAfters.evaluate(RunAfters.java:31)\n    [junit] \tat org.junit.runners.ParentRunner.run(ParentRunner.java:236)\n    [junit] \tat junit.framework.JUnit4TestAdapter.run(JUnit4TestAdapter.java:39)\n    [junit] \tat org.apache.tools.ant.taskdefs.optional.junit.JUnitTestRunner.run(JUnitTestRunner.java:422)\n    [junit] \tat org.apache.tools.ant.taskdefs.optional.junit.JUnitTestRunner.launch(JUnitTestRunner.java:931)\n    [junit] \tat org.apache.tools.ant.taskdefs.optional.junit.JUnitTestRunner.main(JUnitTestRunner.java:758)\n    [junit]     test: stored fields.......OK [60 total field count; avg 1 fields per doc]\n    [junit]     test: term vectors........OK [120 total vector count; avg 2 term/freq vector fields per doc]\n    [junit] FAILED\n    [junit]     WARNING: fixIndex() would remove reference to this segment; full exception:\n    [junit] java.lang.RuntimeException: Term Index test failed\n    [junit] \tat org.apache.lucene.index.CheckIndex.checkIndex(CheckIndex.java:508)\n    [junit] \tat org.apache.lucene.util._TestUtil.checkIndex(_TestUtil.java:148)\n    [junit] \tat org.apache.lucene.util._TestUtil.checkIndex(_TestUtil.java:138)\n    [junit] \tat org.apache.lucene.index.TestOmitTf.testMixedMerge(TestOmitTf.java:155)\n    [junit] \tat sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)\n    [junit] \tat sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:39)\n    [junit] \tat sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:25)\n    [junit] \tat java.lang.reflect.Method.invoke(Method.java:597)\n    [junit] \tat org.junit.runners.model.FrameworkMethod$1.runReflectiveCall(FrameworkMethod.java:44)\n    [junit] \tat org.junit.internal.runners.model.ReflectiveCallable.run(ReflectiveCallable.java:15)\n    [junit] \tat org.junit.runners.model.FrameworkMethod.invokeExplosively(FrameworkMethod.java:41)\n    [junit] \tat org.junit.internal.runners.statements.InvokeMethod.evaluate(InvokeMethod.java:20)\n    [junit] \tat org.junit.rules.TestWatchman$1.evaluate(TestWatchman.java:48)\n    [junit] \tat org.junit.internal.runners.statements.RunBefores.evaluate(RunBefores.java:28)\n    [junit] \tat org.junit.internal.runners.statements.RunAfters.evaluate(RunAfters.java:31)\n    [junit] \tat org.junit.runners.BlockJUnit4ClassRunner.runChild(BlockJUnit4ClassRunner.java:76)\n    [junit] \tat org.apache.lucene.util.LuceneTestCase$LuceneTestCaseRunner.runChild(LuceneTestCase.java:1232)\n    [junit] \tat org.apache.lucene.util.LuceneTestCase$LuceneTestCaseRunner.runChild(LuceneTestCase.java:1160)\n    [junit] \tat org.junit.runners.ParentRunner$3.run(ParentRunner.java:193)\n    [junit] \tat org.junit.runners.ParentRunner$1.schedule(ParentRunner.java:52)\n    [junit] \tat org.junit.runners.ParentRunner.runChildren(ParentRunner.java:191)\n    [junit] \tat org.junit.runners.ParentRunner.access$000(ParentRunner.java:42)\n    [junit] \tat org.junit.runners.ParentRunner$2.evaluate(ParentRunner.java:184)\n    [junit] \tat org.junit.internal.runners.statements.RunBefores.evaluate(RunBefores.java:28)\n    [junit] \tat org.junit.internal.runners.statements.RunAfters.evaluate(RunAfters.java:31)\n    [junit] \tat org.junit.runners.ParentRunner.run(ParentRunner.java:236)\n    [junit] \tat junit.framework.JUnit4TestAdapter.run(JUnit4TestAdapter.java:39)\n    [junit] \tat org.apache.tools.ant.taskdefs.optional.junit.JUnitTestRunner.run(JUnitTestRunner.java:422)\n    [junit] \tat org.apache.tools.ant.taskdefs.optional.junit.JUnitTestRunner.launch(JUnitTestRunner.java:931)\n    [junit] \tat org.apache.tools.ant.taskdefs.optional.junit.JUnitTestRunner.main(JUnitTestRunner.java:758)\n    [junit] \n    [junit] WARNING: 1 broken segments (containing 60 documents) detected\n    [junit] \n    [junit] ------------- ---------------- ---------------\n    [junit] ------------- Standard Error -----------------\n    [junit] NOTE: reproduce with: ant test -Dtestcase=TestOmitTf -Dtestmethod=testMixedMerge -Dtests.seed=-6595054217575280191:5576532348905930588\n    [junit] NOTE: test params are: codec=RandomCodecProvider: {noTf=MockSep, tf=Standard, f1=MockRandom, f2=MockVariableIntBlock(baseBlockSize=112)}, locale=cs_CZ, timezone=Chile/Continental\n    [junit] NOTE: all tests run in this JVM:\n    [junit] [TestAssertions, TestCachingTokenFilter, TestDocument, TestDirectoryReader, TestFlex, TestIndexWriterConfig, TestIndexWriterMerging, TestIndexWriterOnJRECrash, TestMultiReader, TestNewestSegment, TestNorms, TestOmitTf]\n    [junit] NOTE: Linux 2.6.37-gentoo amd64/Sun Microsystems Inc. 1.6.0_24 (64-bit)/cpus=8,threads=1,free=94021800,total=126484480\n    [junit] ------------- ---------------- ---------------",
    "hasPatch": true,
    "hasScreenshot": false,
    "id": "LUCENE-3027",
    "issuetypeClassified": "BUG",
    "issuetypeTracker": "BUG",
    "priority": "Major",
    "product": "LUCENE",
    "project": "LUCENE",
    "summary": "TestOmitTf.testMixedMerge random seed failure",
    "systemSpecification": true,
    "version": ""
}