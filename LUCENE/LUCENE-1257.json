{
    "comments": [
        {
            "author": "C\u00e9dric Champeau",
            "body": "Patch against the trunk",
            "date": "2008-04-02T08:29:43.832+0000",
            "id": 0
        },
        {
            "author": "Uwe Schindler",
            "body": "This patch is bit outdated.\n\nI will try to fix a lot of these things. Simple are:\n\n- remove new NumberSubType(value) and replace by value (autoboxing), which is faster, because allocation overhead removed\n- replace StringBuffer by StringBuilder globally (it is never used in more than one thread)\n\nAddition of generics is little more work, I started in other issues (NumericRangeQuery, AttributeSource).",
            "date": "2009-10-01T13:29:21.467+0000",
            "id": 1
        },
        {
            "author": "Uwe Schindler",
            "body": "A first patch that replaces StringBuffer -> StringBuilder almost everywhere (created using find/grep/sed). Some classes were left out (auto-generated classes by JavaCC).\n\nThere are still some special cases in contrib: some public/protected methods use StringBuffer as param/return type. These should be reverted - or break backwards in 3.0? Any comments?",
            "date": "2009-10-01T22:22:57.266+0000",
            "id": 2
        },
        {
            "author": "Uwe Schindler",
            "body": "Updated patch. It removes some replacements in snowball and other contribs, where StringBuffer appears in public API.\n\nAll other occurences should be correctly replaced (mostly toString() impls).\n\nI will commit this soon, too, as the patch may get outdated very fast.",
            "date": "2009-10-02T21:46:11.342+0000",
            "id": 3
        },
        {
            "author": "Uwe Schindler",
            "body": "Small fix in highlighter public API.",
            "date": "2009-10-02T22:06:08.075+0000",
            "id": 4
        },
        {
            "author": "Uwe Schindler",
            "body": "StringBuffer changes committed revision: 821185\n\nI hope nobody has merge problems now... I keep this issue open as umbrella for further Java 1.5 changes.",
            "date": "2009-10-02T22:11:52.413+0000",
            "id": 5
        },
        {
            "author": "Mark Miller",
            "body": "bq. There are still some special cases in contrib: some public/protected methods use StringBuffer as param/return type. These should be reverted - or break backwards in 3.0? Any comments?\n\nI vote to move to StringBuilder anyway if its in Contrib. Though probably not with Snowball, since we don't really write/maintain that code.",
            "date": "2009-10-02T22:15:59.457+0000",
            "id": 6
        },
        {
            "author": "Uwe Schindler",
            "body": "I already committed tha non-public-API changes. Maybe we add the other StringBuilders in contrib on separate issues. For highlighter I modified the public API of TextFragment to use CharSequence and deprecated the StringBuffer ctor. Maybe we can do this like this elsewhere, too.",
            "date": "2009-10-02T22:22:43.972+0000",
            "id": 7
        },
        {
            "author": "Karl Wettin",
            "body": "bq. I vote to move to StringBuilder anyway if its in Contrib. Though probably not with Snowball, since we don't really write/maintain that code.\n\nActually I patched the Snowball stemmer code to get ridth of the use of reflection. So what we use is an altered version of their code. I tried to get Dr Porter to commit those changes for years but it's still the same. Based on this I think we could just keep going with our own stuff in there as long we keep a record of what we have done in case we want to merge with their trunk. ",
            "date": "2009-10-02T22:23:21.883+0000",
            "id": 8
        },
        {
            "author": "Uwe Schindler",
            "body": "Generification of Document. It makes now clear what getFields() returns really. This was very bad documented. Now its a List<Fieldable>.",
            "date": "2009-10-02T23:21:41.303+0000",
            "id": 9
        },
        {
            "author": "Mark Miller",
            "body": "{quote}Actually I patched the Snowball stemmer code to get ridth of the use of reflection. So what we use is an altered version of their code. I tried to get Dr Porter to commit those changes for years but it's still the same. Based on this I think we could just keep going with our own stuff in there as long we keep a record of what we have done in case we want to merge with their trunk. {quote}\n\nOkay - lets do it then. Testing the English version, its actually almost twice as fast with a StringBuilder.\n\nI bet it would be almost twice as fast or better again if we could get rid of that nasty reflection ...\n\n*edit*\n\nWait ... do you mean you got rid of some of the reflection or did we lose your changes? I'm seeing some nasty slow reflection in there still ...\n\n*edit*\n\nerr... looks like perhaps its only hit once though and then reused.. maybe not so nasty. My first time looking at this code, so I'm sure you can clear it up ...",
            "date": "2009-10-03T00:27:34.221+0000",
            "id": 10
        },
        {
            "author": "Uwe Schindler",
            "body": "bq. Generification of Document. It makes now clear what getFields() returns really. This was very bad documented. Now its a List<Fieldable>. \n\nCommitted revision: 821277",
            "date": "2009-10-03T09:17:37.387+0000",
            "id": 11
        },
        {
            "author": "Timo Nentwig",
            "body": "Somewhat off-topic but in the course of porting to Java 5 I would suggest IndexWriter etc. to implement java.io.Closeable.",
            "date": "2009-10-03T09:34:34.534+0000",
            "id": 12
        },
        {
            "author": "Uwe Schindler",
            "body": "Good idea!",
            "date": "2009-10-03T09:42:54.853+0000",
            "id": 13
        },
        {
            "author": "Paul Elschot",
            "body": "For the record, there is still some usage of StringBuffer in contrib/surround. Fortunately not in public API, only internal, and in some protected method parameters.",
            "date": "2009-10-03T09:52:25.142+0000",
            "id": 14
        },
        {
            "author": "Uwe Schindler",
            "body": "I know, protected is also public from the API side (one could subclass and use one of the protected methods), because of that I left it out for the beginning. This is why you should always think about making as most as possible (package-)private.",
            "date": "2009-10-03T10:26:31.633+0000",
            "id": 15
        },
        {
            "author": "Paul Elschot",
            "body": "StringBuffer to StringBuilder patch for conrib/surround",
            "date": "2009-10-03T11:08:28.222+0000",
            "id": 16
        },
        {
            "author": "Paul Elschot",
            "body": "I would not expect that the protected methods in contrib/surround that are affected by this patch are actually overridden by other code. So formally this is an API change, but I don't think it is worth mentioning in other places than here.",
            "date": "2009-10-03T11:13:56.781+0000",
            "id": 17
        },
        {
            "author": "Uwe Schindler",
            "body": "Lets add a changes.txt entry in contrib about a BW break.",
            "date": "2009-10-03T11:26:36.451+0000",
            "id": 18
        },
        {
            "author": "Uwe Schindler",
            "body": "patch with changes.txt",
            "date": "2009-10-03T11:33:56.479+0000",
            "id": 19
        },
        {
            "author": "Karl Wettin",
            "body": "bq. Wait ... do you mean you got rid of some of the reflection or did we lose your changes? I'm seeing some nasty slow reflection in there still ...\n\nMy changes was to the abstract Snowball stemmer class. I simply added an abstract method and got rid of the reflection in the Lucene filter. \n\nOne could argue that we should update the Snowball compiler rather than updating the Java code it renders. But honestly I think we should just update the rendered code and then report any improvement found to the Snowball ml and keep track of it in the package readme.\n\nbq. err... looks like perhaps its only hit once though and then reused.. maybe not so nasty. My first time looking at this code, so I'm sure you can clear it up ...\n\nIt could still be rather expensive per stem at query time. I vote for getting rid of it if we can. I'll throw an eye at it.",
            "date": "2009-10-03T11:46:51.479+0000",
            "id": 20
        },
        {
            "author": "Karl Wettin",
            "body": "bq. Generification of Document. It makes now clear what getFields() returns really. This was very bad documented. Now its a List<Fieldable>.\n\nThis broke InstantiatedIndex in the trunk. Patch and commit is on the way.",
            "date": "2009-10-03T13:09:32.806+0000",
            "id": 21
        },
        {
            "author": "Uwe Schindler",
            "body": "how that?",
            "date": "2009-10-03T13:13:35.292+0000",
            "id": 22
        },
        {
            "author": "Karl Wettin",
            "body": "Generified ShingleMatrixFilter",
            "date": "2009-10-03T13:14:03.677+0000",
            "id": 23
        },
        {
            "author": "Karl Wettin",
            "body": "bq. Generified ShingleMatrixFilter\n\nCommitted in rev 821311",
            "date": "2009-10-03T13:17:59.540+0000",
            "id": 24
        },
        {
            "author": "Karl Wettin",
            "body": "bq. how that?\n\nIt asserted that a Document contained a List<Field> rather than List<Fieldable> in ctor(IndexReader) , which I actually think is true at that point using that code.\n",
            "date": "2009-10-03T13:19:54.861+0000",
            "id": 25
        },
        {
            "author": "Karl Wettin",
            "body": "Fix for InstantiadexIndex compile error caused by code committed in revision 821277\nList<Fieldable> rather than List<Field>",
            "date": "2009-10-03T13:21:38.918+0000",
            "id": 26
        },
        {
            "author": "Karl Wettin",
            "body": "bq. Fix for InstantiadexIndex compile error caused by code committed in revision 821277\n\nCommitted in rev 821315",
            "date": "2009-10-03T13:24:11.000+0000",
            "id": 27
        },
        {
            "author": "Uwe Schindler",
            "body": "Ah ok, the list is Fieldable. That was exactly the problem with Document, it was not documented, what was inside :-(\n\nJust commit it.",
            "date": "2009-10-03T13:24:13.805+0000",
            "id": 28
        },
        {
            "author": "Robert Muir",
            "body": "changes o.a.l.messages (back) to varargs syntax to match the java 5 MessageFormat and removes ugly Object[] {} wrappers.\n",
            "date": "2009-10-03T15:14:22.269+0000",
            "id": 29
        },
        {
            "author": "Uwe Schindler",
            "body": "Committed Revision: 821443 (Change some occurrences of StringBuffer in public/protected APIs of contrib/surround to StringBuilder)",
            "date": "2009-10-03T23:12:57.433+0000",
            "id": 30
        },
        {
            "author": "Uwe Schindler",
            "body": "Committed revision: 821447 (o.a.l.messages vararg conversion)",
            "date": "2009-10-03T23:37:13.753+0000",
            "id": 31
        },
        {
            "author": "Paul Elschot",
            "body": "Uwe, thanks for adding the changes.txt entry and committing the contrib/surround StringBuffer to StringBuilder patch.",
            "date": "2009-10-04T09:53:47.187+0000",
            "id": 32
        },
        {
            "author": "Karl Wettin",
            "body": "bq. err... looks like perhaps its only hit once though and then reused.. maybe not so nasty. My first time looking at this code, so I'm sure you can clear it up ...\n\nMark, are you referring to the reflection in Among? Those are pretty tough to get rid of.\n\nI think we should replace the StringBuffers in the stemmers if nobody else minds. But I think we should do that in another issue. I also found a bit of ASL headers in some of the classes. Suppose they have been added automatically at some point. These classes are all BSD.",
            "date": "2009-10-05T09:58:11.774+0000",
            "id": 33
        },
        {
            "author": "Earwin Burrfoot",
            "body": "Not sure if that's the right issue, but still.\n\nAmongst other stuff Java5 introduced for-each loops, which can replace lots of for/while constructs with more readable ones.\nShould I post the patch with all such loops converted?",
            "date": "2009-10-07T14:58:20.806+0000",
            "id": 34
        },
        {
            "author": "Earwin Burrfoot",
            "body": "Also, we can remove tons of boxing/unboxing, auto(-un-)boxing calls the very same valueOf(), nnnValue() methods for us.",
            "date": "2009-10-07T15:02:14.508+0000",
            "id": 35
        },
        {
            "author": "Timo Nentwig",
            "body": "eclipse has a code cleanup tool that can easily do all this automatically. It can also make all possible fields/variables final, something I would like to recommend as well.",
            "date": "2009-10-10T07:56:15.085+0000",
            "id": 36
        },
        {
            "author": "Karthik K",
            "body": "* DisjunctionMaxQuery.java - some of the casts are not necessary now that the members are made type-safe. ",
            "date": "2009-10-16T18:42:26.091+0000",
            "id": 37
        },
        {
            "author": "Uwe Schindler",
            "body": "Committed revision: 826035",
            "date": "2009-10-16T18:54:24.634+0000",
            "id": 38
        },
        {
            "author": "Karthik K",
            "body": "* BooleanFilter ( internal data structures conformed to generics ) ",
            "date": "2009-10-17T06:52:08.585+0000",
            "id": 39
        },
        {
            "author": "Karthik K",
            "body": "Generify signatures. ",
            "date": "2009-10-17T07:11:22.519+0000",
            "id": 40
        },
        {
            "author": "Uwe Schindler",
            "body": "I am working on it, I already fixed the missing SegmentInfo clone cast. Was there any other change in the SegmentInfo patch?",
            "date": "2009-10-17T08:07:56.501+0000",
            "id": 41
        },
        {
            "author": "Uwe Schindler",
            "body": "again we have the date sorting bug in JIRA because of am/pm. Can someone change JIRA to use ISO 8601 datstamps in its filelist and everywhere? krrrrrrrrrr.\n\nKay kay: please wait one hour with posting more patches, otherwise I will loose track.",
            "date": "2009-10-17T08:38:22.360+0000",
            "id": 42
        },
        {
            "author": "Uwe Schindler",
            "body": "Committed:\n   LUCENE-1257-SegmentInfos.patch 2009-10-17 12:59 AM Kay Kay 6 kB \n   LUCENE-1257-BufferedDeletes_DocumentsWriter.patch 2009-10-17 12:44 AM Kay Kay 5 kB \n   LUCENE-1257-NormalizeCharMap.patch 2009-10-17 12:15 AM Kay Kay 1 kB \n   LUCENE-1257-WordListLoader.patch 2009-10-17 12:11 AM Kay Kay 3 kB \n   LUCENE-1257-BooleanScorer_2.patch 2009-10-17 01:39 AM Kay Kay 4 kB \n   LUCENE-1257-BooleanQuery.patch 2009-10-17 01:31 AM Kay Kay 5 kB \n   LUCENE-1257_BooleanFilter_Generics.patch 2009-10-16 11:52 PM Kay Kay 4 kB \n\nI also made BooleanQuery Iterable<BooleanClause> for easy usage in advanced for loops. Also added some @Override there.\n\nRevision: 826213 - Thanks Kay Kay!",
            "date": "2009-10-17T09:54:46.080+0000",
            "id": 43
        },
        {
            "author": "Karthik K",
            "body": "Thanks Uwe for helping with the patches. ",
            "date": "2009-10-17T15:39:15.839+0000",
            "id": 44
        },
        {
            "author": "Uwe Schindler",
            "body": "Committed:\n   LUCENE-1257-DocFieldProcessorPerThread.patch 2009-10-17 09:40 AM Kay Kay 4 kB \n   LUCENE-1257-DirectoryReader.patch 2009-10-17 09:12 AM Kay Kay 8 kB \n   LUCENE-1257-ConcurrentMergeScheduler.patch 2009-10-17 08:56 AM Kay Kay 2 kB \n   LUCENE-1257-CompoundFileReaderWriter.patch 2009-10-17 08:52 AM Kay Kay 3 kB \n   LUCENE-1257-CheckIndex.patch 2009-10-17 08:48 AM Kay Kay 6 kB \n\nI also added some more generics to FilterIndexReader, MultiReader, ParallelReader (commitUserData, getFieldNames).\n\nRevision: 826290 - Thanks Kay Kay.",
            "date": "2009-10-17T19:15:37.910+0000",
            "id": 45
        },
        {
            "author": "Uwe Schindler",
            "body": "Kay Kay: You can also provide only one combined patch instead of separate ones.",
            "date": "2009-10-17T19:16:13.812+0000",
            "id": 46
        },
        {
            "author": "Karthik K",
            "body": "Patch across a good number of files in org.apache.lucene.index ( generify ) ",
            "date": "2009-10-18T05:04:38.587+0000",
            "id": 47
        },
        {
            "author": "Uwe Schindler",
            "body": "Whitespace-cleanup of your patch. See also [http://www.lucidimagination.com/search/document/62fe00098351dbe3/whitespace_inside_generics_parameters] for how Lucene should format generics parameters.\n\nI will apply when all tests are run. Thank you for the hard work, that not really fun to convert all this :-(",
            "date": "2009-10-18T09:28:11.546+0000",
            "id": 48
        },
        {
            "author": "Uwe Schindler",
            "body": "Committed LUCENE-1257_org_apache_lucene_index.patch\nAt revision: 826389",
            "date": "2009-10-18T09:51:54.388+0000",
            "id": 49
        },
        {
            "author": "Karthik K",
            "body": "More set of patches in org.apache.lucene.document . ",
            "date": "2009-10-18T14:55:32.924+0000",
            "id": 50
        },
        {
            "author": "Uwe Schindler",
            "body": "bq. More set of patches in org.apache.lucene.document\n\nYou mean not only document?\n\nI looked through it: The o.a.l.util.cache is not ideal: The whole classes should take a <K,V> parameter for the cache and not be fixed to <Object,Object>. This was on my list to fix, so I would leave out the whole cache package in this patch and fix it myself.",
            "date": "2009-10-18T15:13:57.363+0000",
            "id": 51
        },
        {
            "author": "Karthik K",
            "body": "* Mostly with IndexWriter",
            "date": "2009-10-18T15:49:50.441+0000",
            "id": 52
        },
        {
            "author": "Uwe Schindler",
            "body": "Attached is a new patch with a correct generified o.a.l.util.cache package. Now only the usage of this SimpleLRUCache should also be generified.\n\nKay Kay: Do you want to do this or should I do it?",
            "date": "2009-10-18T16:19:43.386+0000",
            "id": 53
        },
        {
            "author": "Karthik K",
            "body": "Uwe: Please feel free to go ahead and do it and commit it, that I can pick up the diff. ",
            "date": "2009-10-18T16:21:00.247+0000",
            "id": 54
        },
        {
            "author": "Karthik K",
            "body": "IndexDelete (Policy) and stuff",
            "date": "2009-10-18T16:21:53.727+0000",
            "id": 55
        },
        {
            "author": "Karthik K",
            "body": "o.a.l.search package - generified",
            "date": "2009-10-18T17:39:05.299+0000",
            "id": 56
        },
        {
            "author": "Karthik K",
            "body": "o.a.l.search.spans - generics added",
            "date": "2009-10-18T17:52:28.813+0000",
            "id": 57
        },
        {
            "author": "Karthik K",
            "body": "{quote} Attached is a new patch with a correct generified o.a.l.util.cache package. Now only the usage of this SimpleLRUCache should also be generified.\n\nKay Kay: Do you want to do this or should I do it?\n{quote}\n\nRevised patch attached that address issue with SimpleLRUCache as well ",
            "date": "2009-10-18T19:42:13.789+0000",
            "id": 58
        },
        {
            "author": "Karthik K",
            "body": "* MapOfSets\n* FieldCacheSanityChecker\n",
            "date": "2009-10-18T20:15:28.286+0000",
            "id": 59
        },
        {
            "author": "Uwe Schindler",
            "body": "Looks good!\n\nCommitted (with some modifications and additions from my last patch):\n   LUCENE-1257-o.a.l.util.patch 2009-10-18 01:15 PM Kay Kay 10 kB \n   LUCENE-1257-org_apache_lucene_document.patch 2009-10-18 12:42 PM Kay Kay 29 kB \n   LUCENE-1257_o.a.l.store.patch 2009-10-18 11:04 AM Kay Kay 12 kB \n   LUCENE-1257_o_a_l_search_spans.patch 2009-10-18 10:52 AM Kay Kay 16 kB \n   LUCENE-1257_o_a_l_search.patch 2009-10-18 10:39 AM Kay Kay 28 kB \n   LUCENE-1257-IndexDeleter.patch 2009-10-18 09:21 AM Kay Kay 13 kB \n   LUCENE-1257-iw.patch 2009-10-18 08:49 AM Kay Kay 19 kB \n\nThanks Kay Kay!\n\nAt revision: 826527",
            "date": "2009-10-18T21:11:45.141+0000",
            "id": 60
        },
        {
            "author": "Karthik K",
            "body": "o.a.lucene.index in src/test ",
            "date": "2009-10-18T21:19:08.949+0000",
            "id": 61
        },
        {
            "author": "Karthik K",
            "body": "Patch resubmitted confirming to generics code guidelines ",
            "date": "2009-10-18T21:22:46.587+0000",
            "id": 62
        },
        {
            "author": "Uwe Schindler",
            "body": "I think test code rewrite is not so important now. I think first I have to remove the rest of the deprecations and fix the test bug (see java-dev mail).\n\nI ran the compilation with unchecked warnings turned on, only 38 warnings for core. I think the rest in core should be doable now :-) JUHU!",
            "date": "2009-10-18T21:36:04.742+0000",
            "id": 63
        },
        {
            "author": "Karthik K",
            "body": "IndexFileDeleter\nIndexDeletePolicy \n\n",
            "date": "2009-10-18T21:37:30.605+0000",
            "id": 64
        },
        {
            "author": "Karthik K",
            "body": "{quote} I think test code rewrite is not so important now. I think first I have to remove the rest of the deprecations and fix the test bug (see java-dev mail).\n\nI ran the compilation with unchecked warnings turned on, only 38 warnings for core. I think the rest in core should be doable now JUHU!\n\n{quote}\n\nOk - Makes sense. It would be nice to get it down to 0 soon..",
            "date": "2009-10-18T21:38:46.455+0000",
            "id": 65
        },
        {
            "author": "Uwe Schindler",
            "body": "bq. IndexFileDeleter, IndexDeletePolicy \n\nLast patch makes sense, its better to use abstract base class! Committed.\n\nWith generified ThreadLocal I get now 73 warnings, some more :(",
            "date": "2009-10-18T21:54:38.906+0000",
            "id": 66
        },
        {
            "author": "Karthik K",
            "body": "o.a.l.queryParser ",
            "date": "2009-10-18T21:57:54.929+0000",
            "id": 67
        },
        {
            "author": "Karthik K",
            "body": "Analyzer  (generified ) \n\nOther Analyzers. \n\nFirst cut version of the patch. If Analyzer<T> is ok - then other analyzers can be ported soon to this as well. ",
            "date": "2009-10-18T22:21:51.031+0000",
            "id": 68
        },
        {
            "author": "Uwe Schindler",
            "body": "bq. First cut version of the patch. If Analyzer<T> is ok - then other analyzers can be ported soon to this as well.\n\nThat's unneeded. Analyzer always return a TokenStream and Tokenizer is a subclass of TokenStream. This makes no sense.\n\nFrom your patch, it seems that you want to generify the setPreviousTokenStream method. This shoudl not take Object, it should take TokenStream as param. But this has nothing to do with Java 5.\n\nRobert Muir knows more, he implemented this caching.",
            "date": "2009-10-18T22:28:05.795+0000",
            "id": 69
        },
        {
            "author": "Uwe Schindler",
            "body": "bq. LUCENE-1257_o.a.l.queryParser.patch\n\nThis is hard to generify, because parts of the API are provided by javacc. You can only patch the .jj file but only parts not automatically generated by javacc.\n\nI would keep this classes as they are and maybe update javacc's param to generate 1.5 code. I will look into this.",
            "date": "2009-10-18T23:00:45.157+0000",
            "id": 70
        },
        {
            "author": "Uwe Schindler",
            "body": "{quote}\nbq. LUCENE-1257_o.a.l.queryParser.patch\n\nThis is hard to generify, because parts of the API are provided by javacc. You can only patch the .jj file but only parts not automatically generated by javacc.\n\nI would keep this classes as they are and maybe update javacc's param to generate 1.5 code. I will look into this.\n{quote}\n\nI updated the parser generator task to use Java 1.5. If you want to generify the other parts of QueryParser, update the .jj file and regenerate the java files. I will do this tomorrow. Will go to bed now.",
            "date": "2009-10-18T23:23:28.903+0000",
            "id": 71
        },
        {
            "author": "Robert Muir",
            "body": "{quote}\nFrom your patch, it seems that you want to generify the setPreviousTokenStream method. This shoudl not take Object, it should take TokenStream as param. But this has nothing to do with Java 5.\n{quote}\n\ncheck out LUCENE-1794 for some related discussion.\n\nThere are a few things that come to mind:\n* for reusable token streams, an analyzer needs to reset the chain: .reset(), but it also needs to call reset(Reader) which is only applicable to Tokenizer. This is why you see private classes like SavedStreams being used.\n* because .tokenStream() takes a fieldname as an argument, some analyzers have special field-specific behavior. To reuse for these analyzers can be more complex, for example QueryAutoStopWordAnalyzer sets/gets a map. \n",
            "date": "2009-10-18T23:23:29.927+0000",
            "id": 72
        },
        {
            "author": "Uwe Schindler",
            "body": "Robert: Thanks!\n\nBut we should not generify the wole analyzer class just because we have some internal helper API that may be generified. We are OK with casts from Object downto the actual type here. A type param in Analyzer is strange and confusing for outstanding developers.",
            "date": "2009-10-18T23:27:20.569+0000",
            "id": 73
        },
        {
            "author": "Robert Muir",
            "body": "Uwe, I agree. I think if we want to improve this reusability in the future, we should look at doing something similar to what Shai Erera proposed, a subclass of Analyzer that does the common SavedStreams behavior.\n\nBut I think Analyzer should still have Object, so the special cases like QueryAutoStopWord can be implemented.",
            "date": "2009-10-18T23:30:06.905+0000",
            "id": 74
        },
        {
            "author": "Uwe Schindler",
            "body": "So we just generify the ThreadLocal to <Object> or <?> and finito. I had that in mind.\n\nAs noted before: the generic type param Kay Kay added has nothing to do with the Analyzer itsself, only with its internal impl. So do not make it public! The Object returning save/get method is just a very special helper. And this down-cast is not \"unsafe\" as long as you do not reuse the method from somewhere outside of Analyzer.",
            "date": "2009-10-18T23:33:35.349+0000",
            "id": 75
        },
        {
            "author": "Robert Muir",
            "body": "updated analysis patch. \nI did not touch StopFilter or StopAnalyzer due to some mixed CharArraySet / Set<String> usage... any ideas on this one Uwe?\n",
            "date": "2009-10-19T00:41:38.157+0000",
            "id": 76
        },
        {
            "author": "Karthik K",
            "body": "Classes affected: \n\n* TermInfosReader\n* SegmentReader\n* FieldsReader\n\n",
            "date": "2009-10-19T01:31:51.720+0000",
            "id": 77
        },
        {
            "author": "Uwe Schindler",
            "body": "bq. I did not touch StopFilter or StopAnalyzer due to some mixed CharArraySet / Set<String> usage... any ideas on this one Uwe? \n\nI am hanging on that, too. See also LUCENE-1987 and LUCENE-1989. As this set needs no type safety (when it is implemented by CharArraySet) it does not matter if the contains methods uses char[] or String or even Object. It always compares the string representation of the tested value. As CharArraySet is defined as Set<Object>, we should define all these as Set<Object> in StopFilter. Or declare them as CharArraySet and convert the anonyous Set<?> to CharArraySet in the ctor (I would prefer this).",
            "date": "2009-10-19T06:33:54.344+0000",
            "id": 78
        },
        {
            "author": "Uwe Schindler",
            "body": "I removed some unneeded patches.",
            "date": "2009-10-19T08:08:00.053+0000",
            "id": 79
        },
        {
            "author": "Uwe Schindler",
            "body": "Comitted:\n   LUCENE-1257-CloseableThreadLocal.patch 2009-10-18 06:31 PM Kay Kay 4 kB \n   LUCENE-1257_analysis.patch 2009-10-18 05:41 PM Robert Muir 8 kB \n\nAt revision: 826601",
            "date": "2009-10-19T08:14:59.211+0000",
            "id": 80
        },
        {
            "author": "Uwe Schindler",
            "body": "One note: I do not want to apply any test-related generics patches, as it makes it harder to port patches to the backwards branch currently.\nAs soon as all deprecations are removed, we could start with fixing the tests. Before removing all deprecations it may often be needed to also apply changes to the backwards branch, which is Java 1.4 for backwards testing with 2.9.",
            "date": "2009-10-19T08:20:54.597+0000",
            "id": 81
        },
        {
            "author": "Karthik K",
            "body": "* FieldValueHitQueue\n* TopDocsCollector\n* TopScoreDocsCollector\n* TopFieldHitsCollector\n",
            "date": "2009-10-19T20:47:13.850+0000",
            "id": 82
        },
        {
            "author": "Uwe Schindler",
            "body": "better generification of MultiTermQueryWrapperFilter (no more casts in sub-classes).",
            "date": "2009-10-19T22:55:42.100+0000",
            "id": 83
        },
        {
            "author": "Uwe Schindler",
            "body": "Committed:\n   LUCENE-1257-MTQWF.patch 2009-10-19 10:55 PM Uwe Schindler 5 kB \n   LUCENE-1257-TopDocsCollector.patch 2009-10-19 08:47 PM Kay Kay 8 kB \n   LUCENE-1257-FieldCacheImpl.patch 2009-10-19 08:23 PM Kay Kay 8 kB \n\n(with some modifications in FieldCacheImpl, where Class was not generified to Class<?>).\n\nAt revision: 826857",
            "date": "2009-10-19T22:59:21.117+0000",
            "id": 84
        },
        {
            "author": "Karthik K",
            "body": "| I updated the parser generator task to use Java 1.5. If you want to generify the other parts of QueryParser, update the .jj file and regenerate the java files. I will do this tomorrow. Will go to bed now.\n\nWhat's the version of javacc being used/suggested currently ( the latest release seems to be 5.0 ) .",
            "date": "2009-10-19T23:27:06.621+0000",
            "id": 85
        },
        {
            "author": "Uwe Schindler",
            "body": "FieldCacheRangeFilter generified + type safe accessor methods.\n\nCommitted revision: 826883",
            "date": "2009-10-19T23:41:32.900+0000",
            "id": 86
        },
        {
            "author": "Uwe Schindler",
            "body": "bq. What's the version of javacc being used/suggested currently ( the latest release seems to be 5.0 ) .\n\n*From BUILD.txt* (I suggest to use this version 4.1, e.g. 4.2 has a bug that corrupts the parser somehow):\n\nStep 3) Install JavaCC\n\nBuilding the Lucene distribution from the source does not require the JavaCC\nparser generator, but if you wish to regenerate any of the pre-generated\nparser pieces, you will need to install JavaCC. Version 4.1 is tested to\nwork correctly.\n\n  http://javacc.dev.java.net\n\nFollow the download links and download the zip file to a temporary\nlocation on your file system.\n\nAfter JavaCC is installed, create a build.properties file\n(as in step 2), and add the line\n\n  javacc.home=/javacc\n\nwhere this points to the root directory of your javacc installation\n(the directory that contains bin/lib/javacc.jar).\n",
            "date": "2009-10-19T23:43:44.700+0000",
            "id": 87
        },
        {
            "author": "Karthik K",
            "body": "QueryParser.jj patch separately for generics ",
            "date": "2009-10-19T23:45:32.288+0000",
            "id": 88
        },
        {
            "author": "Karthik K",
            "body": "MultiFieldQueryParser ",
            "date": "2009-10-19T23:50:30.585+0000",
            "id": 89
        },
        {
            "author": "Karthik K",
            "body": "common-build.xml , build comments match those in build.txt ",
            "date": "2009-10-20T00:06:20.126+0000",
            "id": 90
        },
        {
            "author": "Uwe Schindler",
            "body": "Committed:\n   LUCENE-1257_javacc_upgrade.patch 2009-10-20 12:06 AM Kay Kay 0.8 kB \n   LUCENE-1257_MultiFieldQueryParser.patch 2009-10-19 11:50 PM Kay Kay 3 kB \n   LUCENE-1257_queryParser_jj.patch 2009-10-19 11:45 PM Kay Kay 6 kB \n\nAlso removed deprecated API from QueryParser.\n\nAt revision: 827717",
            "date": "2009-10-20T16:07:19.450+0000",
            "id": 91
        },
        {
            "author": "Karthik K",
            "body": "Remove unnecessary cast across the codebase (as a result of generification) ",
            "date": "2009-10-20T20:34:36.706+0000",
            "id": 92
        },
        {
            "author": "Uwe Schindler",
            "body": "Thanks! Much cleaner code. -- Committed revision: 827811",
            "date": "2009-10-20T21:45:30.954+0000",
            "id": 93
        },
        {
            "author": "DM Smith",
            "body": "Migrates to Java 5 enums in core and contrib. All tests pass.\nDeprecates o.a.l.util.Parameter. It probably can be removed.",
            "date": "2009-10-20T22:02:41.749+0000",
            "id": 94
        },
        {
            "author": "Uwe Schindler",
            "body": "DM Smith: Can you open a new issue. This is more complicated because of backwards compatibility, so a separate issue would be great.\n\nI like your code rewrite (it could even be done with Parameter in the same way). By the way: Java5's Enum is also Serializable, so no problem.",
            "date": "2009-10-20T22:17:15.328+0000",
            "id": 95
        },
        {
            "author": "DM Smith",
            "body": "I've moved the patch for Java 5 enums to its own issue: LUCENE-1998",
            "date": "2009-10-20T22:31:25.097+0000",
            "id": 96
        },
        {
            "author": "Uwe Schindler",
            "body": "Created a new issue out of clone invariance patch: LUCENE-2000",
            "date": "2009-10-21T08:48:54.334+0000",
            "id": 97
        },
        {
            "author": "Uwe Schindler",
            "body": "Committed:\n- LUCENE-1257_more_unnecessary_casts.patch\n- Remove the rest of unchecked warnings. I added a TODO, where I do not understand the code and not for sure know, whats inside the collections. This could be fixed some time later. But the core code now compiles without any unchecked warning.\n\nRevision: 828011\n",
            "date": "2009-10-21T13:39:47.094+0000",
            "id": 98
        },
        {
            "author": "Uwe Schindler",
            "body": "Committed:\n   LUCENE-1257_contrib_benchmark.patch 2009-10-22 05:53 PM Kay Kay 56 kB \n   LUCENE-1257_unnnecessary_casts_2.patch 2009-10-22 08:16 PM Kay Kay 22 kB \n\nRevision: 829013\n\nWith the highlighter patch I will wait until LUCENE-2003 is done to not break the patch of Mark.",
            "date": "2009-10-23T11:54:36.837+0000",
            "id": 99
        },
        {
            "author": "Uwe Schindler",
            "body": "Committed:\n   LUCENE-1257_contrib_benchmark_2.patch 2009-10-23 03:36 PM Kay Kay 22 kB \n   LUCENE-1257_contrib_highlighting.patch \n\nKay Kay, if you want usage of Class.forName() correct generics without casts, you have to do it that way:\n\n{code}\nMyClass instance = Class.forName(nameOfClassToInstantiate).asSubclass(MyClass.class).newInstance()\n{code}\n\nSame applies to other usages of Class<?>. I modified your benchmark changes to do this pattern.\n\nRevision: 829524",
            "date": "2009-10-25T10:16:50.880+0000",
            "id": 100
        },
        {
            "author": "Karthik K",
            "body": "{quote}\nI modified your benchmark changes to do this pattern.\n{quote}\n\nThanks for the heads up. Future patches take care of the same. ",
            "date": "2009-10-25T14:25:29.569+0000",
            "id": 101
        },
        {
            "author": "Uwe Schindler",
            "body": "Committed:\n   LUCENE-1257_precendence_parser.patch 2009-10-25 02:35 PM Kay Kay 9 kB \n   LUCENE-1257_contrib_misc.patch 2009-10-25 02:24 PM Kay Kay 18 kB \n   LUCENE-1257_contrib_memory.patch 2009-10-25 02:02 PM Kay Kay 26 kB \n\nI had to fix some small things (one extended for-loop removed, because loop variable had to be global). Also moved the AnalyzerUtil/SynonyMap to wordnet contrib (see LUCENE-1904). Also converted the stop words in PatternAnalyzer to CharArraySet/Set<?> like in other analyzers.\n\nAt revision: 830790",
            "date": "2009-10-28T23:24:00.833+0000",
            "id": 102
        },
        {
            "author": "Robert Muir",
            "body": "generics patch for smartcn. \n\ntype safety is useful here, it found a problem in the javadocs :)",
            "date": "2009-10-29T15:51:14.500+0000",
            "id": 103
        },
        {
            "author": "Uwe Schindler",
            "body": "Robert: I think you can commit it yourself, I am away now :-) Looks good on a diagonal view... Even you have the stopwords set with <?> - like everywhere else. I trust you!",
            "date": "2009-10-29T21:50:44.870+0000",
            "id": 104
        },
        {
            "author": "Robert Muir",
            "body": "Uwe, thanks for taking a look. i think theres some complex hashmaps mapping Integer to ArrayList where i could have used ? extends List instead of ArrayList, but its internally used anyway, so I didn't bother.\n\nI'll commit the patch shortly.",
            "date": "2009-10-29T21:55:01.461+0000",
            "id": 105
        },
        {
            "author": "Robert Muir",
            "body": "Committed LUCENE-1257_contrib_smartcn.patch, revision 831121.",
            "date": "2009-10-29T22:30:49.573+0000",
            "id": 106
        },
        {
            "author": "Karthik K",
            "body": "generics patch for a couple of files ",
            "date": "2009-11-09T18:57:29.563+0000",
            "id": 107
        },
        {
            "author": "Robert Muir",
            "body": "contrib/swing,contrib/wikipedia,contrib/wordnet,contrib/xml-query-parser",
            "date": "2009-11-10T02:11:26.506+0000",
            "id": 108
        },
        {
            "author": "Uwe Schindler",
            "body": "Committed:\n   LUCENE-1257_swing_wikipedia_wordnet_xmlqp.patch 2009-11-10 02:11 AM Robert Muir 24 kB \n   LUCENE-1257_o_a_l_demo.patch 2009-11-09 06:57 PM Kay Kay 1 kB \n\nAt revision: 834414",
            "date": "2009-11-10T10:18:41.784+0000",
            "id": 109
        },
        {
            "author": "Karthik K",
            "body": "lucli  generics ",
            "date": "2009-11-10T22:33:17.088+0000",
            "id": 110
        },
        {
            "author": "Simon Willnauer",
            "body": "I revised this patch and did some minor cleanups in lucil. \n- Changed while(iterator.hasNext()) to java 5 loops.\n- added suppress warnings \n- changed some sysouts to messag()",
            "date": "2009-11-10T23:09:29.955+0000",
            "id": 111
        },
        {
            "author": "Robert Muir",
            "body": "simon, cool, I think it would be good if we were consistent with generics formatting tho:\n\n{noformat}\npublic static <K, V extends Comparable<V>> Map.Entry<K,V>[]\n{noformat}\n\nI think it should be K,V with no space?",
            "date": "2009-11-10T23:17:59.065+0000",
            "id": 112
        },
        {
            "author": "Uwe Schindler",
            "body": "I think for such complex thing, sometimes spaces may be good :-) But for the typical <K,V>, <String,String> and so on it is hard. There are already some in AttributeSource like this.\n\nBy the way, I uploaded a new Eclipse code style during ApacheCon to wiki.",
            "date": "2009-11-10T23:23:15.708+0000",
            "id": 113
        },
        {
            "author": "Uwe Schindler",
            "body": "Oh god:\n{code}\n+  @SuppressWarnings(\"unchecked\")\n+  public static <K, V extends Comparable<V>> Map.Entry<K,V>[]\n+    getSortedMapEntries(Map<K,V> m) {\n+    Set<Map.Entry<K, V>> set = m.entrySet();\n+    Map.Entry<K,V>[] entries =\n+       set.toArray(new Map.Entry[set.size()]);\n+    Arrays.sort(entries, new Comparator<Map.Entry<K,V>>() {\n+      public int compare(Map.Entry<K, V> o1, Map.Entry<K, V> o2) {\n+        V v1 = o1.getValue();\n+        V v2 = o2.getValue();\n+        return v2.compareTo(v1); //descending order\n{code}\n\nWhat's that *g*. It needs suppress warnings because of the array creation?",
            "date": "2009-11-10T23:25:27.610+0000",
            "id": 114
        },
        {
            "author": "Robert Muir",
            "body": "bq. I think for such complex thing, sometimes spaces may be good But for the typical <K,V>, <String,String> and so on it is hard. There are already some in AttributeSource like this. \n\nSimon/Uwe I wasn't trying to be picky, more for my own knowledge.\nContrib formatting is insanity anyway, so I don't object to any patch that introduces type safety :)",
            "date": "2009-11-10T23:27:49.053+0000",
            "id": 115
        },
        {
            "author": "Karthik K",
            "body": "I am not sure what the consensus w.r.t warnings are - but as much as possible leaving out SuppressWarnings would be better so that it is transparent in the future to address should the dependent library change. \n\n",
            "date": "2009-11-11T00:02:16.172+0000",
            "id": 116
        },
        {
            "author": "Uwe Schindler",
            "body": "Committed:\n   LUCENE-1257_lucil.patch 2009-11-10 11:09 PM Simon Willnauer 11 kB \n\nAt revision: 834720 - Thanks Simon & Kay",
            "date": "2009-11-11T00:05:58.614+0000",
            "id": 117
        },
        {
            "author": "Uwe Schindler",
            "body": "Kay Kay: We only have SuppressWarnings at some places in core, marked with a big TODO (will be done when flex indeixng comes). The \"wanted\" @SuppressWarnings are only at places, where generic Arrays are created. There is no way to fix this (see Sun Generics Howto).",
            "date": "2009-11-11T00:08:21.150+0000",
            "id": 118
        },
        {
            "author": "Karthik K",
            "body": "contrib ant",
            "date": "2009-11-11T02:04:38.249+0000",
            "id": 119
        },
        {
            "author": "Robert Muir",
            "body": "generics in benchmark, spellcheck, spatial, snowball, and queries.\ni didn't finish MoreLikeThis in contrib/queries so it still needs to be done.\n",
            "date": "2009-11-11T02:15:28.305+0000",
            "id": 120
        },
        {
            "author": "Robert Muir",
            "body": "I replace my previous patch with this much larger patch.\n\nsome of it is autogen but I reviewed/corrected",
            "date": "2009-11-11T08:33:10.949+0000",
            "id": 121
        },
        {
            "author": "Uwe Schindler",
            "body": "I removed also the suppresswarnings and generified TermsHash code. I also added more generics to the changes you already did (because Eclipse is not able to automatically add generics inside generics, e.g. Map<X,Collection<Y>>).\n\nThis patch also contains the ant task.\n\nWill commit, when all tests finished.",
            "date": "2009-11-11T12:14:36.688+0000",
            "id": 122
        },
        {
            "author": "Uwe Schindler",
            "body": "Committed:\n   LUCENE-1257_heavy.patch 2009-11-11 12:14 PM Uwe Schindler 69 kB (contains LUCENE-1257_contrib_ant.patch)\n\nAt revision: 834847 - Thanks Robert, Kay, me",
            "date": "2009-11-11T12:20:01.149+0000",
            "id": 123
        },
        {
            "author": "Uwe Schindler",
            "body": "Robert: Is there anything else in contrib to convert? If no, I would close this issue for now.\n\nIf we find further Java5 conversions after release of 3.0, we can open new issues.",
            "date": "2009-11-13T08:24:47.688+0000",
            "id": 124
        },
        {
            "author": "Robert Muir",
            "body": "bq. If we find further Java5 conversions after release of 3.0, we can open new issues.\nUwe, I agree, I think you should close the issue.",
            "date": "2009-11-13T11:01:25.088+0000",
            "id": 125
        },
        {
            "author": "Simon Willnauer",
            "body": "We gonna reopen it in 3.0 anyway so just go ahead and close for now!",
            "date": "2009-11-13T11:12:21.147+0000",
            "id": 126
        },
        {
            "author": "Uwe Schindler",
            "body": "Closed for 3.0. Further updates of tests and internal APIs may follow for 3.1 in a new issue.",
            "date": "2009-11-13T11:39:29.204+0000",
            "id": 127
        },
        {
            "author": "Karthik K",
            "body": "|  Further updates of tests and internal APIs may follow for 3.1 in a new issue\n\n \t LUCENE-2065 in place for 3.1 to address remaining changes.  ",
            "date": "2009-11-13T23:16:21.972+0000",
            "id": 128
        }
    ],
    "component": "core/index, core/other, core/query/scoring, core/queryparser, core/search, core/store, core/termvectors, modules/analysis, modules/examples",
    "description": "For my needs I've updated Lucene so that it uses Java 5 constructs. I know Java 5 migration had been planned for 2.1 someday in the past, but don't know when it is planned now. This patch against the trunk includes :\n\n- most obvious generics usage (there are tons of usages of sets, ... Those which are commonly used have been generified)\n- PriorityQueue generification\n- replacement of indexed for loops with for each constructs\n- removal of unnececessary unboxing\n\nThe code is to my opinion much more readable with those features (you actually *know* what is stored in collections reading the code, without the need to lookup for field definitions everytime) and it simplifies many algorithms.\n\nNote that this patch also includes an interface for the Query class. This has been done for my company's needs for building custom Query classes which add some behaviour to the base Lucene queries. It prevents multiple unnnecessary casts. I know this introduction is not wanted by the team, but it really makes our developments easier to maintain. If you don't want to use this, replace all /Queriable/ calls with standard /Query/.\n\n",
    "hasPatch": true,
    "hasScreenshot": false,
    "id": "LUCENE-1257",
    "issuetypeClassified": "OTHER",
    "issuetypeTracker": "IMPROVEMENT",
    "priority": "Minor",
    "product": "LUCENE",
    "project": "LUCENE",
    "summary": "Port to Java5",
    "systemSpecification": true,
    "version": "3.0"
}